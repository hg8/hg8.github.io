<!DOCTYPE html>
<html lang=en>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="This week I decided to tackle a subject I’ve had difficulties with in the past. Reverse Engineering and binary exploitation have been a weak point of mine for a while now and I have been looking for">
<meta property="og:type" content="article">
<meta property="og:title" content="Buffer Overflow: Introduction">
<meta property="og:url" content="https://hg8.sh/posts/binary-exploitation/buffer-overflow-introduction/index.html">
<meta property="og:site_name" content="hg8&#39;s Notes — My notes about infosec world. Pentest&#x2F;Bug Bounty&#x2F;CTF Writeups.">
<meta property="og:description" content="This week I decided to tackle a subject I’ve had difficulties with in the past. Reverse Engineering and binary exploitation have been a weak point of mine for a while now and I have been looking for">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://user-images.githubusercontent.com/9076747/203412163-e8f180a6-5d96-4878-944b-8db1db3f0d25.jpg">
<meta property="og:image" content="https://user-images.githubusercontent.com/9076747/197627713-085f9767-4c6f-4b72-8859-4826c2cabc3c.svg">
<meta property="og:image" content="https://user-images.githubusercontent.com/9076747/203407940-0a7bf715-9296-43a7-9280-a0783d44b576.png">
<meta property="article:published_time" content="2022-11-21T23:00:00.000Z">
<meta property="article:modified_time" content="2023-10-28T18:10:05.718Z">
<meta property="article:author" content="hg8">
<meta property="article:tag" content="linux">
<meta property="article:tag" content="binary exploitation">
<meta property="article:tag" content="buffer overflow">
<meta property="article:tag" content="c">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://user-images.githubusercontent.com/9076747/203412163-e8f180a6-5d96-4878-944b-8db1db3f0d25.jpg">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
     
    <title>Buffer Overflow: Introduction :: hg8&#39;s Notes — My notes about infosec world. Pentest/Bug Bounty/CTF Writeups.</title>
    
<link rel="stylesheet" href="/css/style.css">

    
    
<meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="hg8's Notes — My notes about infosec world. Pentest/Bug Bounty/CTF Writeups." type="application/atom+xml">
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/posts/binary-exploitation/buffer-overflow-reversing-assembly/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/posts/talkative/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
    </span>
    <br/>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Buffer"><span class="toc-number">1.</span> <span class="toc-text">Buffer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Memory-Segmentation"><span class="toc-number">2.</span> <span class="toc-text">Memory Segmentation</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#What-is-a-buffer-overflow"><span class="toc-number">3.</span> <span class="toc-text">What is a buffer overflow?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Identifying-buffer-overflow-vulnerability"><span class="toc-number">4.</span> <span class="toc-text">Identifying buffer overflow vulnerability</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#References"><span class="toc-number">5.</span> <span class="toc-text">References</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        <header id="header">
  <a href="/">
  
      <div id="logo" style="background-image: url(/images/logo.webp);"></div>
  
    <span class="logo__mark"></span>
    <span class="logo__text">./hg8.sh</span>
    <span class="logo__cursor"></span>
  </a>
  <div id="nav">
    <ul>
      <li class="icon">
        <a href="#"><i class="fas fa-bars fa-2x"></i></a>
      </li>
       
        <li><a href="/">Home</a></li>
       
        <li><a href="/about/">About</a></li>
       
        <li><a href="/archives/">Posts</a></li>
       
        <li><a href="/search/">Search</a></li>
      
    </ul>
  </div>
</header>

        
          <br>
          <br>
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Buffer Overflow: Introduction
    </h1>



    <div class="meta"> 
      
    <div class="postdate">
      
        <time datetime="2022-11-21T23:00:00.000Z" itemprop="datePublished">22-11-2022</time>
        
      
    </div>


      — Written by 
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">hg8</span>
      </span>
      —
      4 min read
    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p><img src="https://user-images.githubusercontent.com/9076747/203412163-e8f180a6-5d96-4878-944b-8db1db3f0d25.jpg" alt="buffer overflow banner"></p>
<p>This week I decided to tackle a subject I’ve had difficulties with in the past. Reverse Engineering and binary exploitation have been a weak point of mine for a while now and I have been looking for an opportunity to get better at them.</p>
<p>In this article series we are going to study a simple buffer overflow attack and learn how it can lead to code execution via shellcode injection. Later on we will practice with CTF challenges in additional articles.</p>
<p>That being said, let’s go!</p>
<h2 id="Buffer"><a href="#Buffer" class="headerlink" title="Buffer"></a>Buffer</h2><p>Let’s start with the beginning: what is a buffer ? </p>
<p>A buffer is an area of computer memory used to store data, often while moving it from one section of a program to another, or between programs.</p>
<p>To illustrate we are going to take this very simple code example written in C:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>** argv)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">char</span> buffer [<span class="number">500</span>];</span><br><span class="line">  <span class="built_in">strcpy</span>(buffer, argv[<span class="number">1</span>]);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Let’s break it down:</p>
<p><code>int main (int argc, char** argv)</code>: main function, taking command lines arguments as parameters.</p>
<p><code>char buffer [500];</code>: create a 500 bytes buffer to hold data.</p>
<p><code>strcpy(buffer, argv[1]);</code>: copy the first command line argument into our buffer variable.</p>
<p><code>return 0;</code>: exit the program with status code 0.</p>
<p>We can now compile and test the program:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[hg8@archbook ~]$ gcc vuln.c -o vuln</span><br><span class="line">[hg8@archbook ~]$ ./vuln hello</span><br><span class="line">[hg8@archbook ~]$</span><br></pre></td></tr></table></figure>

<p>Aand nothing happens.. but that’s expected. In order to have a simple as possible example, our program doesn’t have any print statement.</p>
<p>Now we have an easy and working example, before diving into the depth of buffer overflow let’s quickly review what an application memory looks like.</p>
<h2 id="Memory-Segmentation"><a href="#Memory-Segmentation" class="headerlink" title="Memory Segmentation"></a>Memory Segmentation</h2><p><em>Note: As of today the memory layout of a running application is more complex because of numerous security proactive measures. For learning purposes and this article’s examples, the security, such as Address Space Layout Randomization (<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Address_space_layout_randomization">ASLR</a>) have been disabled to not interfere with the demonstration of the buffer overflow issue.</em></p>
<p>When you run a program, the processor is going to run several calculations depending on your program source code. To make the calculations as fast and efficient as possible it needs to store data in places that can be accessed very quickly. This will be either:</p>
<ul>
<li><strong>Processor registry</strong>: On x86 (32 bits) we can note the common <code>EAX</code>, <code>EBX</code>, <code>EIP</code>, <code>ESP</code>, <code>EBP</code>… Those are small memory spaces within the processor used for various purposes.</li>
<li><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>Random Access Memory (RAM)</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong>: This is where the majority of information needed by your program is being stored: variables, pointers, stack, heap, etc.</li>
</ul>
<p>Let’s take a look at a memory segmentation representation:</p>
<p><img src="https://user-images.githubusercontent.com/9076747/197627713-085f9767-4c6f-4b72-8859-4826c2cabc3c.svg" alt="memory segmentation representation"></p>
<p>Explanations:</p>
<ul>
<li>The top area at the lowest address is called the <code>text</code> segment and contains the actual program code in machine instructions (<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Assembly_language">asm</a>). This area is read-only, which makes sense because you don’t want another process or a malicious person to change the program code on the run.</li>
<li>Below we have two <code>data</code> segments, one for the global initialized variables (ex: <code>int global1 = 8;</code>) and another one for global uninitialized variables (ex: <code>int global2;</code>).</li>
<li>Under the <code>data</code> we have the <code>heap</code> segment. This area is used for large variable initialization (it can be images, files, <code>malloc()</code>, etc.) The growth of <code>heap</code> moves downward higher address depending on its need during program run.</li>
<li>The <code>stack</code> segment also has variable size and is used to temporarily store local function variables and context during function calls. The stack segment is an <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Stack_(abstract_data_type)">abstract data structure</a> with LIFO ordering. The growth of <code>stack</code> moves upward lower address depending on its need during program run.</li>
</ul>
<h2 id="What-is-a-buffer-overflow"><a href="#What-is-a-buffer-overflow" class="headerlink" title="What is a buffer overflow?"></a>What is a buffer overflow?</h2><p>We have now learned what a buffer is and understood the memory segmentation of a program. You may have started to guess what a buffer overflow is and how it can happen. </p>
<p>A buffer overflow occurs when data written to a buffer corrupts data values in <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Memory_address"></a>memory addresses adjacent to the destination buffer. This can occur when copying data from one buffer to another without first checking that the data fits within the destination buffer.</p>
<p>Here is a visualization of a buffer overflow. Data is written into buffer A, but is too large to fit within A, so it overflows into buffer B.</p>
<img src="https://user-images.githubusercontent.com/9076747/203407940-0a7bf715-9296-43a7-9280-a0783d44b576.png" alt="buffer overflow visualization" width="500"/>


<h2 id="Identifying-buffer-overflow-vulnerability"><a href="#Identifying-buffer-overflow-vulnerability" class="headerlink" title="Identifying buffer overflow vulnerability"></a>Identifying buffer overflow vulnerability</h2><p>If you read our example code, you can notice where our buffer overflow will happen. </p>
<p>Indeed during the <code>strcopy()</code> of the command line argument into <code>buffer[500]</code>, no length checks are being made. This means no matter the size of our argument, it will be copied into <code>buffer</code> variable. </p>
<p>So then, how would our program behave if we pass an argument longer than 500 bytes ? Let’s give it a try using python to generate a 501 bytes long string:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[hg8@archbook ~]$ ./vuln AAA</span><br><span class="line">[hg8@archbook ~]$ ./vuln $(python -c <span class="string">&#x27;print(&quot;A&quot;*501)&#x27;</span>)</span><br><span class="line">[hg8@archbook ~]$</span><br></pre></td></tr></table></figure>

<p>Interestingly we get no errors, but if we continue to add more data:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[hg8@archbook ~]$ ./vuln $(python -c <span class="string">&#x27;print(&quot;A&quot;*508)&#x27;</span>)</span><br><span class="line">[1]    4753 segmentation fault (core dumped)  ./vuln $(python -c <span class="string">&#x27;print(&quot;A&quot;*508)&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>This time we get a segmentation fault at 508 bytes. Why 508 and not 501 ? Because of <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Data_structure_alignment">memory alignment</a>. But we will talk about this later on.</p>
<p>A segmentation fault occurs when a program attempts to access a memory location that it is not allowed to access, or attempts to access a memory location in a way that is not allowed. This leads, in most cases, to a program crash.</p>
<blockquote>
<p>Ok that’s great, it makes the program crash but how can we exploit this ?</p>
</blockquote>
<p>The techniques to exploit a buffer overflow varies greatly depending on the architecture, OS and memory region. In this blog series, in order to keep it simple, we are going to focus on stack based buffer overflow on x86 architecture. </p>
<p>Our exploitation will consist in injecting malicious code (called shellcode) into our buffer and overwriting the return address of the stack segment to point to this injected shellcode.</p>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Buffer_overflow">Buffer Overflow - Wikipedia</a></li>
<li>Niagara Photo by <a target="_blank" rel="noopener" href="https://unsplash.com/@claybanks">Clay Banks</a></li>
</ul>

  </div>
</article>
<br>
<br>


    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/Binary-Exploitation/">Binary Exploitation</a>
    </div>



    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/binary-exploitation/" rel="tag">binary exploitation</a>, <a class="tag-link-link" href="/tags/buffer-overflow/" rel="tag">buffer overflow</a>, <a class="tag-link-link" href="/tags/c/" rel="tag">c</a>, <a class="tag-link-link" href="/tags/linux/" rel="tag">linux</a>
    </div>





        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Posts</a></li>
         
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Buffer"><span class="toc-number">1.</span> <span class="toc-text">Buffer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Memory-Segmentation"><span class="toc-number">2.</span> <span class="toc-text">Memory Segmentation</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#What-is-a-buffer-overflow"><span class="toc-number">3.</span> <span class="toc-text">What is a buffer overflow?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Identifying-buffer-overflow-vulnerability"><span class="toc-number">4.</span> <span class="toc-text">Identifying buffer overflow vulnerability</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#References"><span class="toc-number">5.</span> <span class="toc-text">References</span></a></li></ol>
    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2023
    <a href="https://hg8.sh">hg8.sh</a>
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Archives</a></li>
         
          <li><a href="/categories/">Category</a></li>
         
          <li><a href="/tags/">Tags</a></li>
         
          <li><a href="/atom.xml">RSS</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">


    
<script src="/lib/jquery/jquery.min.js"></script>


<script src="/js/main.js"></script>




</body>
</html>
