<!DOCTYPE html>
<html lang=en>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="Welcome to the second part of the Buffer Overflow series. In this post, we will explore the basics of Assembly. Today we won’t delve too deeply into assembly language, as it can quickly become overw">
<meta property="og:type" content="article">
<meta property="og:title" content="Buffer Overflow: Reversing Assembly">
<meta property="og:url" content="https://hg8.sh/posts/binary-exploitation/buffer-overflow-reversing-assembly/index.html">
<meta property="og:site_name" content="hg8&#39;s Notes — My notes about infosec world. Pentest&#x2F;Bug Bounty&#x2F;CTF Writeups.">
<meta property="og:description" content="Welcome to the second part of the Buffer Overflow series. In this post, we will explore the basics of Assembly. Today we won’t delve too deeply into assembly language, as it can quickly become overw">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://github.com/hg8/hg8.github.io/assets/9076747/ee65be39-04a5-49e2-b21a-b934ef44f696">
<meta property="article:published_time" content="2023-09-11T22:00:00.000Z">
<meta property="article:modified_time" content="2023-10-28T19:32:21.613Z">
<meta property="article:author" content="hg8">
<meta property="article:tag" content="linux">
<meta property="article:tag" content="binary exploitation">
<meta property="article:tag" content="buffer overflow">
<meta property="article:tag" content="c">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://github.com/hg8/hg8.github.io/assets/9076747/ee65be39-04a5-49e2-b21a-b934ef44f696">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
     
    <title>Buffer Overflow: Reversing Assembly :: hg8&#39;s Notes — My notes about infosec world. Pentest/Bug Bounty/CTF Writeups.</title>
    
<link rel="stylesheet" href="/css/style.css">

    
    
<meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="hg8's Notes — My notes about infosec world. Pentest/Bug Bounty/CTF Writeups." type="application/atom+xml">
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/posts/binary-exploitation/buffer-overflow-code-execution-by-shellcode-injection/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/posts/binary-exploitation/buffer-overflow-introduction/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
    </span>
    <br/>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Example-code"><span class="toc-number">1.</span> <span class="toc-text">Example code</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Assembly"><span class="toc-number">2.</span> <span class="toc-text">Assembly</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Prologue"><span class="toc-number">2.1.</span> <span class="toc-text">Prologue</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Command-line-argument-handling"><span class="toc-number">2.2.</span> <span class="toc-text">Command line argument handling</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Main-function-exit"><span class="toc-number">2.3.</span> <span class="toc-text">Main function exit</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Epilogue"><span class="toc-number">3.</span> <span class="toc-text">Epilogue</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#References"><span class="toc-number">4.</span> <span class="toc-text">References</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        <header id="header">
  <a href="/">
  
      <div id="logo" style="background-image: url(/images/logo.webp);"></div>
  
    <span class="logo__mark"></span>
    <span class="logo__text">./hg8.sh</span>
    <span class="logo__cursor"></span>
  </a>
  <div id="nav">
    <ul>
      <li class="icon">
        <a href="#"><i class="fas fa-bars fa-2x"></i></a>
      </li>
       
        <li><a href="/">Home</a></li>
       
        <li><a href="/about/">About</a></li>
       
        <li><a href="/archives/">Posts</a></li>
       
        <li><a href="/search/">Search</a></li>
      
    </ul>
  </div>
</header>

        
          <br>
          <br>
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Buffer Overflow: Reversing Assembly
    </h1>



    <div class="meta"> 
      
    <div class="postdate">
      
        <time datetime="2023-09-11T22:00:00.000Z" itemprop="datePublished">12-09-2023</time>
        
      
    </div>


      — Written by 
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">hg8</span>
      </span>
      —
      6 min read
    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p><img src="https://github.com/hg8/hg8.github.io/assets/9076747/ee65be39-04a5-49e2-b21a-b934ef44f696" alt="buffer overflow banner"></p>
<p> Welcome to the second part of the Buffer Overflow series. In this post, we will explore the basics of Assembly.</p>
<p>Today we won’t delve too deeply into assembly language, as it can quickly become overwhelming. However, we’ll provide here enough insight to understand what is happening when we run our example program. If you want a more comprehensive understanding of assembly, we encourage you to explore further through various resources and blog posts already available online on the subject :)</p>
<p><em>So, to begin, what exactly is Assembly language?</em></p>
<p>Assembly language is a low-level programming language that exhibits a strong correspondence between its instructions and the machine code instructions of the computer’s architecture. It serves as the intermediary between software programs (as demonstrated in our example using C) and the underlying hardware of your computer (components such as RAM and the CPU for our example).</p>
<p><em>Why do I need to know assembly language?</em></p>
<p>Most of the time, you won’t have access to the binary source code you’re analyzing or exploiting. Assembly language provides a means to decipher what a program is executing, regardless of the high-level programming language used to generate the binary. Alongside tools like GDB, it stands as one of the most effective approaches for reverse engineering any given program.</p>
<p>With that in mind, let’s delve into the subject.</p>
<h2 id="Example-code"><a href="#Example-code" class="headerlink" title="Example code"></a>Example code</h2><p>As a reminder, here our code example in C:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>** argv)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">char</span> buffer [<span class="number">500</span>];</span><br><span class="line">  <span class="built_in">strcpy</span>(buffer, argv[<span class="number">1</span>]);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Assembly"><a href="#Assembly" class="headerlink" title="Assembly"></a>Assembly</h2><p>We can use GDB to disassemble the code, here I am using the <a target="_blank" rel="noopener" href="https://visualgdb.com/gdbreference/commands/set_disassembly-flavor">Intel flavor</a>: </p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[hg8@archbook ~]$ gdb vuln</span><br><span class="line">Reading symbols from vuln...</span><br><span class="line">(gdb) disassemble main</span><br><span class="line">Dump of assembler code for function main:</span><br><span class="line">   <span class="number">0x08049176</span> &lt;+<span class="number">0</span>&gt;:     <span class="keyword">push</span>   <span class="built_in">ebp</span></span><br><span class="line">   <span class="number">0x08049177</span> &lt;+<span class="number">1</span>&gt;:     <span class="keyword">mov</span>    <span class="built_in">ebp</span>,<span class="built_in">esp</span></span><br><span class="line">   <span class="number">0x08049179</span> &lt;+<span class="number">3</span>&gt;:     <span class="keyword">push</span>   <span class="built_in">ebx</span></span><br><span class="line">   <span class="number">0x0804917a</span> &lt;+<span class="number">4</span>&gt;:     <span class="keyword">sub</span>    <span class="built_in">esp</span>,<span class="number">0x1f4</span></span><br><span class="line">   <span class="number">0x08049180</span> &lt;+<span class="number">10</span>&gt;:    <span class="keyword">call</span>   <span class="number">0x80491ae</span> &lt;__x86<span class="number">.</span>get_pc_thunk<span class="number">.</span><span class="built_in">ax</span>&gt;</span><br><span class="line">   <span class="number">0x08049185</span> &lt;+<span class="number">15</span>&gt;:    <span class="keyword">add</span>    <span class="built_in">eax</span>,<span class="number">0x2053</span></span><br><span class="line">   <span class="number">0x0804918a</span> &lt;+<span class="number">20</span>&gt;:    <span class="keyword">mov</span>    <span class="built_in">edx</span>,<span class="built_in">DWORD</span> <span class="built_in">PTR</span> [<span class="built_in">ebp</span>+<span class="number">0xc</span>]</span><br><span class="line">   <span class="number">0x0804918d</span> &lt;+<span class="number">23</span>&gt;:    <span class="keyword">add</span>    <span class="built_in">edx</span>,<span class="number">0x4</span></span><br><span class="line">   <span class="number">0x08049190</span> &lt;+<span class="number">26</span>&gt;:    <span class="keyword">mov</span>    <span class="built_in">edx</span>,<span class="built_in">DWORD</span> <span class="built_in">PTR</span> [<span class="built_in">edx</span>]</span><br><span class="line">   <span class="number">0x08049192</span> &lt;+<span class="number">28</span>&gt;:    <span class="keyword">push</span>   <span class="built_in">edx</span></span><br><span class="line">   <span class="number">0x08049193</span> &lt;+<span class="number">29</span>&gt;:    <span class="keyword">lea</span>    <span class="built_in">edx</span>,[<span class="built_in">ebp</span>-<span class="number">0x1f8</span>]</span><br><span class="line">   <span class="number">0x08049199</span> &lt;+<span class="number">35</span>&gt;:    <span class="keyword">push</span>   <span class="built_in">edx</span></span><br><span class="line">   <span class="number">0x0804919a</span> &lt;+<span class="number">36</span>&gt;:    <span class="keyword">mov</span>    <span class="built_in">ebx</span>,<span class="built_in">eax</span></span><br><span class="line">   <span class="number">0x0804919c</span> &lt;+<span class="number">38</span>&gt;:    <span class="keyword">call</span>   <span class="number">0x8049050</span> &lt;strcpy@plt&gt;</span><br><span class="line">   <span class="number">0x080491a1</span> &lt;+<span class="number">43</span>&gt;:    <span class="keyword">add</span>    <span class="built_in">esp</span>,<span class="number">0x8</span></span><br><span class="line">   <span class="number">0x080491a4</span> &lt;+<span class="number">46</span>&gt;:    <span class="keyword">mov</span>    <span class="built_in">eax</span>,<span class="number">0x0</span></span><br><span class="line">   <span class="number">0x080491a9</span> &lt;+<span class="number">51</span>&gt;:    <span class="keyword">mov</span>    <span class="built_in">ebx</span>,<span class="built_in">DWORD</span> <span class="built_in">PTR</span> [<span class="built_in">ebp</span>-<span class="number">0x4</span>]</span><br><span class="line">   <span class="number">0x080491ac</span> &lt;+<span class="number">54</span>&gt;:    <span class="keyword">leave</span></span><br><span class="line">   <span class="number">0x080491ad</span> &lt;+<span class="number">55</span>&gt;:    <span class="keyword">ret</span></span><br><span class="line">End of assembler dump.</span><br></pre></td></tr></table></figure>

<p>Well, it doesn’t appear really fun to understand. Let’s break down what every lines does to get a better understanding of the program:</p>
<h3 id="Prologue"><a href="#Prologue" class="headerlink" title="Prologue"></a>Prologue</h3><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x08049176</span> &lt;+<span class="number">0</span>&gt;:     <span class="keyword">push</span>   <span class="built_in">ebp</span></span><br><span class="line"><span class="number">0x08049177</span> &lt;+<span class="number">1</span>&gt;:     <span class="keyword">mov</span>    <span class="built_in">ebp</span>,<span class="built_in">esp</span></span><br><span class="line"><span class="number">0x08049179</span> &lt;+<span class="number">3</span>&gt;:     <span class="keyword">push</span>   <span class="built_in">ebx</span></span><br><span class="line"><span class="number">0x0804917a</span> &lt;+<span class="number">4</span>&gt;:     <span class="keyword">sub</span>    <span class="built_in">esp</span>,<span class="number">0x1f4</span></span><br></pre></td></tr></table></figure>

<ol>
<li>This section is the prologue of our program. In assembly language, a prologue is a sequence of instructions that is executed at the beginning of a function to set up a new stack frame.</li>
</ol>
<p>The function starts with a <code>push</code> instruction, which pushes the value of the base pointer onto the stack. The base pointer, <code>ebp</code>, is a register that points to the base of the current stack frame.</p>
<p>This is followed by a <code>mov ebp, esp</code> instruction, which copies the current value of the stack pointer (<code>esp</code>) into the base pointer (<code>ebp</code>). The stack pointer is used to point to the currently used stack, since most programs will have multiple stack (for each function).  </p>
<p>The next instruction, <code>push</code>, saves the value of the <code>ebx</code> register on the stack. The <code>ebx</code> register is a general-purpose register that is often used to hold intermediate results and to pass function arguments.</p>
<p>The instruction <code>sub</code> subtracts a value from the stack pointer. This effectively reserves 0x1f4 (500 in decimal) bytes of space on the stack for local variables and function arguments. This corresponds to the space reserve for our <code>buffer</code> variable (<code>char buffer [500];</code>)</p>
<p>Remember, the stack grows from higher memory address to lower memory address, hence the subtraction operation.</p>
<h3 id="Command-line-argument-handling"><a href="#Command-line-argument-handling" class="headerlink" title="Command line argument handling"></a>Command line argument handling</h3><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x08049180</span> &lt;+<span class="number">10</span>&gt;:    <span class="keyword">call</span>   <span class="number">0x80491ae</span> &lt;__x86<span class="number">.</span>get_pc_thunk<span class="number">.</span><span class="built_in">ax</span>&gt;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>The instruction <code>call 0x80491ae</code> transfers control to the function at the specified address. This function is likely a helper function that returns the address of the instruction following the call in the <code>eax</code> register.</li>
</ol>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x08049185</span> &lt;+<span class="number">15</span>&gt;:    <span class="keyword">add</span>    <span class="built_in">eax</span>,<span class="number">0x2053</span></span><br><span class="line"><span class="number">0x0804918a</span> &lt;+<span class="number">20</span>&gt;:    <span class="keyword">mov</span>    <span class="built_in">edx</span>,<span class="built_in">DWORD</span> <span class="built_in">PTR</span> [<span class="built_in">ebp</span>+<span class="number">0xc</span>]</span><br><span class="line"><span class="number">0x0804918d</span> &lt;+<span class="number">23</span>&gt;:    <span class="keyword">add</span>    <span class="built_in">edx</span>,<span class="number">0x4</span></span><br><span class="line"><span class="number">0x08049190</span> &lt;+<span class="number">26</span>&gt;:    <span class="keyword">mov</span>    <span class="built_in">edx</span>,<span class="built_in">DWORD</span> <span class="built_in">PTR</span> [<span class="built_in">edx</span>]</span><br><span class="line"><span class="number">0x08049192</span> &lt;+<span class="number">28</span>&gt;:    <span class="keyword">push</span>   <span class="built_in">edx</span></span><br><span class="line"><span class="number">0x08049193</span> &lt;+<span class="number">29</span>&gt;:    <span class="keyword">lea</span>    <span class="built_in">edx</span>,[<span class="built_in">ebp</span>-<span class="number">0x1f8</span>]</span><br><span class="line"><span class="number">0x08049199</span> &lt;+<span class="number">35</span>&gt;:    <span class="keyword">push</span>   <span class="built_in">edx</span></span><br><span class="line"><span class="number">0x0804919a</span> &lt;+<span class="number">36</span>&gt;:    <span class="keyword">mov</span>    <span class="built_in">ebx</span>,<span class="built_in">eax</span></span><br><span class="line"><span class="number">0x0804919c</span> &lt;+<span class="number">38</span>&gt;:    <span class="keyword">call</span>   <span class="number">0x8049050</span> &lt;strcpy@plt&gt;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><p>This set of instructions prepares and handles the command line argument to be copied into our buffer variable.</p>
<p>The instruction <code>add</code> adds the value 0x2053 (8275 in decimal) to the <code>eax</code> register. This adjusts the return value of the helper function to the address of the instruction following the <code>add</code> instruction.</p>
<p><code>mov edx,[ebp+0xc]</code>,  loads a value from memory into the <code>edx</code> register. The value is stored at an offset of 0xc (12 in decimal) bytes from the base pointer.</p>
<p><code>add edx,0x4</code> adds a value to the <code>edx</code> register. This adjusts the value in the <code>edx</code> register to point to the next memory location.</p>
<p><code>mov edx, [edx]</code> loads a value from the memory location pointed to by the <code>edx</code> register into the <code>edx</code> register. This is where our command line argument is being stored (<code>argv[1]</code>).</p>
<p><code>push edx</code> pushes the value of the <code>edx</code> register onto the stack. Our <code>argv[1]</code> variable is now stored in the stack (this is where the buffer overflow will occur).</p>
<p><code>lea edx, [ebp-0x1f8]</code> calculates the address of the operand <code>[ebp-0x1f8]</code> and stores the result in the <code>edx</code> register. This operand represents the memory location 0x1f8 (504 in decimal) bytes below the base pointer. <code>edx</code> should now hold the last address of the stack. </p>
<p><code>push edx</code> pushes the value of the <code>edx</code> register (the calculated address) onto the stack.</p>
<p><code>mov ebx, eax</code> moves the value in the <code>eax</code> register into the <code>ebx</code> register.</p>
<p><code>call 0x8049050</code> transfers control to the function at the specified address. This function is the <code>strcpy</code> function, which copies a null-terminated string from one location to another. This is where our command line argument (<code>argv[1]</code> gets copied into the <code>buffer[500]</code> variable.</p>
</li>
</ol>
<h3 id="Main-function-exit"><a href="#Main-function-exit" class="headerlink" title="Main function exit"></a>Main function exit</h3><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x080491a1</span> &lt;+<span class="number">43</span>&gt;:    <span class="keyword">add</span>    <span class="built_in">esp</span>,<span class="number">0x8</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>The instruction <code>add</code> adjusts the stack pointer by adding 8 to it. This pops the two values that were pushed onto the stack in the previous instructions.</li>
</ol>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x080491a4</span> &lt;+<span class="number">46</span>&gt;:    <span class="keyword">mov</span>    <span class="built_in">eax</span>,<span class="number">0x0</span></span><br></pre></td></tr></table></figure>

<ol start="5">
<li>The instruction <code>mov</code> copies the value 0x0 (0 in decimal) into the <code>%eax</code> register. This value is  the return value of the <code>main</code> function, which is set to zero.</li>
</ol>
<h2 id="Epilogue"><a href="#Epilogue" class="headerlink" title="Epilogue"></a>Epilogue</h2><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x080491a9</span> &lt;+<span class="number">51</span>&gt;:    <span class="keyword">mov</span>    <span class="built_in">ebx</span>,<span class="built_in">DWORD</span> <span class="built_in">PTR</span> [<span class="built_in">ebp</span>-<span class="number">0x4</span>]</span><br><span class="line"><span class="number">0x080491ac</span> &lt;+<span class="number">54</span>&gt;:    <span class="keyword">leave</span></span><br><span class="line"><span class="number">0x080491ad</span> &lt;+<span class="number">55</span>&gt;:    <span class="keyword">ret</span></span><br></pre></td></tr></table></figure>

<ol start="6">
<li><p>This section is the epilogue of our program. In assembly language sequence an epilogue is a sequence of instructions executed at the end of a function to restore the state of the previous stack frame and return control to the calling function.</p>
<p>The instruction <code>mov</code> loads a value from memory into the <code>ebx</code> register. The value is stored at an offset of -0x4 (-4 in decimal) bytes from the base pointer. This restores the original value of the <code>ebx</code> register that was saved on the stack earlier in the function.</p>
<p><code>leave</code> restores the stack frame by copying the value of the base pointer (saved on the stack) into the stack pointer and then popping the value of the base pointer off the stack. This effectively undoes the setup of the stack frame at the beginning of the function.<br>The instruction <code>ret</code> returns control to the caller of the function by popping the return address off the stack and transferring control to that address.</p>
</li>
</ol>
<p>Alright, that was quite a journey!… Well done if you’ve managed to stay with us thus far! Don’t worry if you haven’t understood every detail yet. In our next post we will use the knowledge learned from the disassembly to exploit the buffer overflow. As you progress, you might find it easier to comprehend the process and can always revisit this post to review the functionality of a particular assembly line.</p>
<p>Now it’s time for the fun part: exploitation, see you there! <a href="https://hg8.sh/posts/binary-exploitation/buffer-overflow-code-execution-by-shellcode-injection/">Buffer Overflow: Command Execution By Shellcode Injection</a>.</p>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/a/15020825/3265284">What is the difference between ESP and EBP?</a></li>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/a/1665570">What’s the purpose of the LEA instruction?</a></li>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/a/4584131">What is the function of the push / pop instructions used on registers?</a></li>
</ul>
<p>If you want to go deeper on learning Assembly language:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.tutorialspoint.com/assembly_programming/index.htm">Assembly Programming Tutorial</a></li>
<li><a target="_blank" rel="noopener" href="https://dojo.pwn.college/cse466/asm">Assembly Crash Course - pwn.college</a></li>
<li><a target="_blank" rel="noopener" href="https://wiki.skullsecurity.org/index.php?title=Registers">Registers - Skullsecurity</a> </li>
</ul>

  </div>
</article>
<br>
<br>


    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/Binary-Exploitation/">Binary Exploitation</a>
    </div>



    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/binary-exploitation/" rel="tag">binary exploitation</a>, <a class="tag-link-link" href="/tags/buffer-overflow/" rel="tag">buffer overflow</a>, <a class="tag-link-link" href="/tags/c/" rel="tag">c</a>, <a class="tag-link-link" href="/tags/linux/" rel="tag">linux</a>
    </div>





        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Posts</a></li>
         
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Example-code"><span class="toc-number">1.</span> <span class="toc-text">Example code</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Assembly"><span class="toc-number">2.</span> <span class="toc-text">Assembly</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Prologue"><span class="toc-number">2.1.</span> <span class="toc-text">Prologue</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Command-line-argument-handling"><span class="toc-number">2.2.</span> <span class="toc-text">Command line argument handling</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Main-function-exit"><span class="toc-number">2.3.</span> <span class="toc-text">Main function exit</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Epilogue"><span class="toc-number">3.</span> <span class="toc-text">Epilogue</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#References"><span class="toc-number">4.</span> <span class="toc-text">References</span></a></li></ol>
    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2025
    <a href="https://hg8.sh">hg8.sh</a>
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Archives</a></li>
         
          <li><a href="/categories/">Category</a></li>
         
          <li><a href="/tags/">Tags</a></li>
         
          <li><a href="/atom.xml">RSS</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">


    
<script src="/lib/jquery/jquery.min.js"></script>


<script src="/js/main.js"></script>




</body>
</html>
